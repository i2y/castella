{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>Castella is a pure Python cross-platform UI framework made for us Pythonista.</p>"},{"location":"#why","title":"Why","text":"<p>Dart has Flutter and Kotlin has Compose Multiplatform as cross-platform declarative UI frameworks. These frameworks describe the core parts of the framework in that language itself. They also make programmers to be able to define UI declaratively in that language, not XML, HTML, or something like their own languages. Probably, those would be very us programmer friendly and enhance our productivity. Unfortunately, at this moment (May 2022), at least as far as I know, there doesn't seem to be such a framework in Python. Castella is an attempt to see if such a thing can be made for us Pythonista in Python.</p>"},{"location":"#goals","title":"Goals","text":"<p>The primary final goal of Castella is to provide features for Python programmers easy to create a UI application for several OS platforms and web browsers in a single most same code as possible as. The second goal is to provide a UI framework that Python programmers can easily understand, modify, and extend as needed.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>The core part as a UI framework of Castella is written in only Python. It's not a wrapper for existing something written in other programing languages. \"pure Python cross-platform UI framework\" specifies things like the above.</li> <li>Castella allows pythonista to define UI declaratively in Python.</li> <li>Castella provides hot-reloading or hot-restarting on development.</li> <li>Comprehensive theme system with design tokens (colors, typography, spacing).</li> <li>Built-in themes: Tokyo Night (default), Cupertino, Material Design 3, and classic Castella themes.</li> <li>Dark/light mode with automatic system detection and runtime switching.</li> <li>Rich markdown rendering with syntax highlighting and LaTeX math support.</li> <li>Native interactive charts (Bar, Line, Pie, Scatter, Area, Stacked Bar, Gauge) with tooltips, hover, and click events.</li> <li>Animation system - Smooth property animations with ValueTween, AnimatedState, and easing functions.</li> <li>Castella utilizes GPU via dependent libraries.</li> <li>Z-index support enables layered UIs with modals, popups, and overlays.</li> <li>A2A Protocol support - Connect to AI agents via Google's Agent-to-Agent protocol with <code>A2AClient</code>.</li> <li>A2UI Protocol support - Render agent-generated UIs with 17 standard components, tested with Google's sample agents.</li> <li>MCP (Model Context Protocol) support - AI agents can introspect and control UIs programmatically via MCP.</li> <li>AgentChat - Build chat interfaces with AI agents in just 3 lines of code.</li> </ul>"},{"location":"#dependencies","title":"Dependencies","text":"<ul> <li>For desktop platforms, Castella is standing on existing excellent python bindings for window management library (GLFW or SDL2) and 2D graphics library (Skia).</li> <li>For web browsers, Castella is standing on awesome Pyodide/PyScript and CanvasKit (Wasm version of Skia).</li> <li>For terminals, Castella is standing on prompt_toolkit.</li> </ul>"},{"location":"#supported-platforms","title":"Supported Platforms","text":"<p>Castella supports the following platforms:</p> <ul> <li>Windows 10/11</li> <li>Mac OS X</li> <li>Linux</li> <li>iOS (Simulator and Device) - via castella-skia Metal backend</li> <li>Web browsers</li> <li>Terminals</li> </ul>"},{"location":"agent/","title":"Agent UI","text":"<p>Castella provides comprehensive support for building AI agent interfaces with A2A (Agent-to-Agent) and A2UI (Agent-to-User Interface) protocols.</p> <p>MCP Support</p> <p>Castella also supports MCP (Model Context Protocol) for AI agents to introspect and control UIs programmatically. See the MCP documentation for details.</p>"},{"location":"agent/#quick-start","title":"Quick Start","text":"<p>The simplest way to create a chat UI for an AI agent:</p> <pre><code>from castella.agent import AgentChat\n\n# Connect to an A2A-compatible agent\nchat = AgentChat.from_a2a(\"http://localhost:8080\")\nchat.run()\n</code></pre> <p>Or with a custom handler:</p> <pre><code>from castella.agent import AgentChat\n\nchat = AgentChat(\n    handler=lambda msg: f\"You said: {msg}\",\n    title=\"My Bot\",\n    system_message=\"Welcome! How can I help you?\",\n)\nchat.run()\n</code></pre>"},{"location":"agent/#installation","title":"Installation","text":"<p>Agent features require the <code>agent</code> extra:</p> <pre><code>uv add \"castella[agent,glfw]\"\n# or\npip install \"castella[agent,glfw]\"\n</code></pre>"},{"location":"agent/#agentchat","title":"AgentChat","text":"<p><code>AgentChat</code> is a high-level component that provides a complete chat interface with minimal setup.</p>"},{"location":"agent/#constructor-options","title":"Constructor Options","text":"<pre><code>AgentChat(\n    # Backend options (provide one)\n    a2a_client: A2AClient | None = None,  # A2A client for remote agent\n    handler: Callable[[str], str] | None = None,  # Custom message handler\n\n    # UI options\n    title: str | None = None,  # Window title\n    placeholder: str = \"Type a message...\",  # Input placeholder\n    system_message: str | None = None,  # Initial system message\n    show_agent_card: bool = True,  # Show agent card for A2A agents\n    a2ui_renderer: A2UIRenderer | None = None,  # Optional A2UI renderer\n\n    # Window options (for run())\n    width: int = 700,\n    height: int = 550,\n)\n</code></pre>"},{"location":"agent/#factory-methods","title":"Factory Methods","text":"<pre><code># Create from A2A agent URL\nchat = AgentChat.from_a2a(\"http://localhost:8080\")\n</code></pre>"},{"location":"agent/#running-the-chat","title":"Running the Chat","text":"<pre><code>chat.run()  # Opens a window and runs the chat\n</code></pre>"},{"location":"agent/#a2a-client","title":"A2A Client","text":"<p>The <code>A2AClient</code> class connects to A2A-compatible agents.</p> <pre><code>from castella.a2a import A2AClient\n\n# Connect to an agent\nclient = A2AClient(\"http://localhost:8080\")\n\n# Access agent metadata\nprint(f\"Name: {client.name}\")\nprint(f\"Description: {client.description}\")\nprint(f\"Skills: {[s.name for s in client.skills]}\")\n\n# Send messages\nresponse = client.ask(\"What's the weather in Tokyo?\")\nprint(response)\n\n# Async support\nasync def main():\n    response = await client.ask_async(\"Hello!\")\n</code></pre>"},{"location":"agent/#agent-card","title":"Agent Card","text":"<pre><code>from castella.a2a import A2AClient\n\nclient = A2AClient(\"http://agent.example.com\")\n\n# Access the agent card\ncard = client.agent_card\nprint(f\"Name: {card.name}\")\nprint(f\"Description: {card.description}\")\nprint(f\"Version: {card.version}\")\nprint(f\"URL: {card.url}\")\n\n# Skills\nfor skill in card.skills:\n    print(f\"  - {skill.name}: {skill.description}\")\n</code></pre>"},{"location":"agent/#a2ui-client","title":"A2UI Client","text":"<p>The <code>A2UIClient</code> class connects to A2A agents that support the A2UI extension, automatically handling protocol negotiation and UI generation.</p> <pre><code>from castella import App\nfrom castella.a2ui import A2UIClient, A2UIComponent, UserAction\nfrom castella.frame import Frame\n\n# Create client with action handler\ndef on_action(action: UserAction):\n    print(f\"Action: {action.name}\")\n    print(f\"Source: {action.source_component_id}\")\n    print(f\"Context: {action.context}\")\n\nclient = A2UIClient(\"http://localhost:10002\", on_action=on_action)\n\n# Send message and get A2UI surface\nsurface = client.send(\"Find me restaurants in Tokyo\")\n\nif surface:\n    # Render in Castella app\n    App(Frame(\"Demo\", 800, 600), A2UIComponent(surface)).run()\n</code></pre>"},{"location":"agent/#async-usage","title":"Async Usage","text":"<pre><code>async def main():\n    client = A2UIClient(\"http://localhost:10002\")\n    surface = await client.send_async(\"Hello!\")\n\n    # Send user actions back to agent\n    if surface:\n        action = UserAction(\n            name=\"book_restaurant\",\n            source_component_id=\"book-button\",\n            context={\"restaurant\": \"Sushi Place\"}\n        )\n        await client.send_action_async(action)\n</code></pre>"},{"location":"agent/#features","title":"Features","text":"<ul> <li>Connects to A2A Protocol agents with A2UI extension</li> <li>Handles A2UI extension negotiation automatically</li> <li>Extracts A2UI messages from A2A responses</li> <li>Integrates with <code>A2UIRenderer</code> for widget generation</li> <li>Supports both sync and async operations</li> <li>Maintains conversation context across messages</li> </ul>"},{"location":"agent/#displaying-agent-card","title":"Displaying Agent Card","text":"<pre><code>from castella.agent import AgentCardView, AgentListView\nfrom castella.a2a import A2AClient\n\nclient = A2AClient(\"http://agent.example.com\")\n\n# Single agent card\ncard_view = AgentCardView(\n    client.agent_card,\n    show_skills=True,\n    compact=False,\n)\n\n# List of agents\nagents = [\n    A2AClient(\"http://agent1.example.com\").agent_card,\n    A2AClient(\"http://agent2.example.com\").agent_card,\n]\nlist_view = AgentListView(agents)\n</code></pre>"},{"location":"agent/#a2ui-renderer","title":"A2UI Renderer","text":"<p>The <code>A2UIRenderer</code> converts A2UI JSON specifications into native Castella widgets.</p> <pre><code>from castella.a2ui import A2UIRenderer, UserAction\n\n# Create renderer with action handler\ndef on_action(action: UserAction):\n    print(f\"Action: {action.name}\")\n    print(f\"Source: {action.source_component_id}\")\n    print(f\"Context: {action.context}\")\n\nrenderer = A2UIRenderer(on_action=on_action)\n\n# Render A2UI JSON\nwidget = renderer.render_json({\n    \"components\": [\n        {\"id\": \"root\", \"component\": \"Column\", \"children\": {\"explicitList\": [\"title\", \"btn\"]}},\n        {\"id\": \"title\", \"component\": \"Text\", \"text\": {\"literalString\": \"Hello A2UI!\"}},\n        {\"id\": \"btn\", \"component\": \"Button\", \"text\": {\"literalString\": \"Click Me\"},\n         \"action\": {\"name\": \"clicked\", \"context\": []}}\n    ],\n    \"rootId\": \"root\"\n})\n</code></pre>"},{"location":"agent/#supported-a2ui-components","title":"Supported A2UI Components","text":"<p>Castella supports 17 standard A2UI components:</p> A2UI Component Castella Widget Notes Text Text Supports usageHint (h1-h5, body, caption) Button Button Supports action with context TextField Input/MultilineInput usageHint: password (masked), multiline CheckBox CheckBox Two-way data binding Slider Slider Range input with min/max DateTimeInput DateTimeInput Date/time picker ChoicePicker RadioButtons/Column Single or multiple selection Image NetImage URL-based images with aspect ratio preservation Icon Text Material Icons mapped to emoji/symbols Divider Spacer Horizontal/vertical Row Row Horizontal layout Column Column Vertical layout Card Column Container with styling List Column (scrollable) Dynamic list with TemplateChildren Tabs Tabs Tabbed navigation Modal Modal Overlay dialog Markdown Markdown Castella extension"},{"location":"agent/#a2ui-09-specification-compatibility","title":"A2UI 0.9 Specification Compatibility","text":"<p>Castella supports both the official A2UI 0.9 spec format and its internal format. The <code>castella.a2ui.compat</code> module automatically normalizes messages:</p> <pre><code># A2UI 0.9 spec format (plain values - used by Google's sample agents)\n{\"text\": \"Hello\", \"children\": [\"a\", \"b\"], \"usageHint\": \"shortText\"}\n\n# Castella internal format (wrapped values)\n{\"text\": {\"literalString\": \"Hello\"}, \"children\": {\"explicitList\": [\"a\", \"b\"]}}\n\n# Both formats are accepted - normalization is automatic\n</code></pre> <p>Key format differences handled:</p> <ul> <li><code>text: \"Hello\"</code> \u2192 <code>text: {literalString: \"Hello\"}</code></li> <li><code>children: [\"a\", \"b\"]</code> \u2192 <code>children: {explicitList: [\"a\", \"b\"]}</code></li> <li><code>child: \"id\"</code> \u2192 <code>children: {explicitList: [\"id\"]}</code></li> <li><code>usageHint: \"shortText\"</code> \u2192 <code>usageHint: \"text\"</code></li> <li><code>usageHint: \"obscured\"</code> \u2192 <code>usageHint: \"password\"</code></li> <li><code>updateDataModel: {path, op, value}</code> \u2192 <code>updateDataModel: {data: {path: value}}</code></li> </ul>"},{"location":"agent/#custom-components","title":"Custom Components","text":"<pre><code>from castella.a2ui import ComponentCatalog, A2UIRenderer\n\ndef create_custom_chart(component, data_model, action_handler):\n    # Return a Castella widget\n    return MyCustomChart(...)\n\ncatalog = ComponentCatalog()\ncatalog.register(\"CustomChart\", create_custom_chart)\n\nrenderer = A2UIRenderer(catalog=catalog)\n</code></pre>"},{"location":"agent/#a2ui-streaming","title":"A2UI Streaming","text":"<p>A2UI supports progressive rendering via JSONL (newline-delimited JSON) streams. This enables real-time UI updates as components arrive from AI agents.</p>"},{"location":"agent/#jsonl-parsing","title":"JSONL Parsing","text":"<pre><code>from castella.a2ui import A2UIRenderer\n\nrenderer = A2UIRenderer()\n\n# Parse JSONL string directly\njsonl = '''\n{\"beginRendering\": {\"surfaceId\": \"main\", \"root\": \"root\"}}\n{\"updateComponents\": {\"surfaceId\": \"main\", \"components\": [{\"id\": \"root\", \"component\": \"Column\", \"children\": {\"explicitList\": [\"text1\"]}}]}}\n{\"updateComponents\": {\"surfaceId\": \"main\", \"components\": [{\"id\": \"text1\", \"component\": \"Text\", \"text\": {\"literalString\": \"Hello!\"}}]}}\n'''\nsurface = renderer.handle_jsonl(jsonl)\nif surface:\n    widget = surface.root_widget\n</code></pre>"},{"location":"agent/#streaming-from-files","title":"Streaming from Files","text":"<pre><code>with open(\"ui.jsonl\") as f:\n    surface = renderer.handle_stream(f, on_update=lambda s: app.redraw())\n</code></pre>"},{"location":"agent/#sse-server-sent-events","title":"SSE (Server-Sent Events)","text":"<pre><code>from castella.a2ui.transports import sse_stream\n\n# Requires httpx: pip install httpx\nasync def connect_sse():\n    surface = await renderer.handle_stream_async(\n        await sse_stream(\"http://agent.example.com/ui\")\n    )\n    return surface.root_widget\n</code></pre>"},{"location":"agent/#websocket","title":"WebSocket","text":"<pre><code>from castella.a2ui.transports import websocket_stream\n\n# Requires websockets: pip install websockets\nasync def connect_websocket():\n    surface = await renderer.handle_stream_async(\n        await websocket_stream(\"ws://agent.example.com/ui\")\n    )\n    return surface.root_widget\n</code></pre>"},{"location":"agent/#a2ui-message-types","title":"A2UI Message Types","text":"Message Purpose <code>beginRendering</code> Signal start of progressive rendering, specify root ID <code>updateComponents</code> Add/update components incrementally <code>createSurface</code> Create complete surface at once <code>updateDataModel</code> Update data binding values <code>deleteSurface</code> Remove a surface"},{"location":"agent/#a2uicomponent-reactive-updates","title":"A2UIComponent (Reactive Updates)","text":"<p>Use <code>A2UIComponent</code> to automatically rebuild the UI when <code>updateDataModel</code> is received:</p> <pre><code>from castella import App\nfrom castella.a2ui import A2UIComponent, A2UIRenderer, UserAction\nfrom castella.frame import Frame\n\nrenderer = A2UIRenderer()\n\ndef on_action(action: UserAction):\n    if action.name == \"increment\":\n        # Send updateDataModel to update the UI\n        renderer.handle_message({\n            \"updateDataModel\": {\n                \"surfaceId\": \"default\",\n                \"data\": {\"/counter\": \"Counter: 1\"},\n            }\n        })\n\nrenderer._on_action = on_action\n\n# Render initial UI\nrenderer.render_json(a2ui_json, initial_data={\"/counter\": \"Counter: 0\"})\n\n# Wrap surface in A2UIComponent for auto-update\nsurface = renderer.get_surface(\"default\")\ncomponent = A2UIComponent(surface)\n\nApp(Frame(\"App\", 800, 600), component).run()\n</code></pre>"},{"location":"agent/#textfield-usagehint","title":"TextField usageHint","text":"<p>TextField supports special input types via <code>usageHint</code>:</p> <pre><code># Password field (masked input \u25cf\u25cf\u25cf\u25cf)\n{\"id\": \"password\", \"component\": \"TextField\",\n \"text\": {\"literalString\": \"\"},\n \"usageHint\": \"password\"}\n\n# Multiline field (uses MultilineInput)\n{\"id\": \"comments\", \"component\": \"TextField\",\n \"text\": {\"literalString\": \"\"},\n \"usageHint\": \"multiline\"}\n\n# Other hints (text, email, number, phone, url) use standard Input\n{\"id\": \"email\", \"component\": \"TextField\",\n \"text\": {\"literalString\": \"\"},\n \"usageHint\": \"email\"}\n</code></pre>"},{"location":"agent/#chat-components","title":"Chat Components","text":"<p>For building custom chat UIs, Castella provides lower-level components.</p>"},{"location":"agent/#chatmessage","title":"ChatMessage","text":"<pre><code>from castella.agent import ChatMessage\n\n# Create message widget\nwidget = ChatMessage(\n    role=\"assistant\",\n    content=\"Hello! How can I help you?\",\n)\n\n# With optional parameters\nwidget = ChatMessage(\n    role=\"assistant\",\n    content=\"Hello!\",\n    show_timestamp=True,\n    show_role_label=True,\n)\n</code></pre>"},{"location":"agent/#chatinput","title":"ChatInput","text":"<pre><code>from castella.agent import ChatInput\n\ndef handle_send(text: str):\n    print(f\"User sent: {text}\")\n\n# Basic usage\ninput_widget = ChatInput(on_submit=handle_send)\n\n# With all options\ninput_widget = ChatInput(\n    on_submit=handle_send,\n    placeholder=\"Type a message...\",\n    send_label=\"Send\",\n    min_height=40,\n    max_height=120,\n)\n</code></pre>"},{"location":"agent/#chatview","title":"ChatView","text":"<pre><code>from castella.agent import ChatView, ChatMessageData\nfrom castella.core import ListState\n\nmessages = ListState([\n    ChatMessageData(role=\"system\", content=\"Welcome!\"),\n])\n\n# Basic usage\nview = ChatView(messages)\n\n# With all options\nview = ChatView(\n    messages,\n    show_timestamps=False,\n    auto_scroll=True,\n)\n</code></pre>"},{"location":"agent/#chatcontainer","title":"ChatContainer","text":"<p>A complete chat UI combining ChatView and ChatInput:</p> <pre><code>from castella.agent import ChatContainer, ChatMessageData\nfrom castella.core import ListState\n\nmessages = ListState([\n    ChatMessageData(role=\"system\", content=\"Welcome!\"),\n])\n\ndef on_send(text: str):\n    messages.append(ChatMessageData(role=\"user\", content=text))\n    # Get response from agent...\n    messages.append(ChatMessageData(role=\"assistant\", content=\"Hello!\"))\n\nchat = ChatContainer(messages, on_send=on_send, title=\"Chat\")\n</code></pre>"},{"location":"agent/#tool-call-visualization","title":"Tool Call Visualization","text":"<p>Display tool/function calls from AI agents:</p> <pre><code>from castella.agent import ToolCallView, ToolCallData\n\n# Create tool call data\ntool = ToolCallData(\n    id=\"call_123\",\n    name=\"get_weather\",\n    arguments={\"location\": \"Tokyo\"},\n    result=\"Sunny, 22C\",\n)\n\n# Display tool call (collapsible)\nview = ToolCallView(\n    name=tool.name,\n    arguments=tool.arguments,\n    result=tool.result,\n)\n</code></pre>"},{"location":"agent/#tool-history-panel","title":"Tool History Panel","text":"<pre><code>from castella.agent import ToolHistoryPanel\nfrom castella.core import ListState\n\ntool_calls = ListState([\n    ToolCallData(id=\"1\", name=\"search\", arguments={\"q\": \"Python\"}, result=\"...\"),\n    ToolCallData(id=\"2\", name=\"calculate\", arguments={\"expr\": \"2+2\"}, result=\"4\"),\n])\n\npanel = ToolHistoryPanel(tool_calls)\n</code></pre>"},{"location":"agent/#creating-an-a2a-server","title":"Creating an A2A Server","text":"<p>Use <code>python-a2a</code> directly to create A2A-compatible servers:</p> <pre><code>from python_a2a import A2AServer, skill, run_server, TaskState, TaskStatus\n\nclass WeatherAgent(A2AServer):\n    @skill(name=\"get_weather\", description=\"Get current weather\")\n    def get_weather(self, location: str) -&gt; str:\n        return f\"Weather in {location}: Sunny, 22C\"\n\n    def handle_task(self, task):\n        # Extract message from task\n        message = task.message[\"parts\"][0][\"text\"]\n\n        # Route to appropriate skill\n        response = self.get_weather(\"Tokyo\")\n\n        # Return response\n        task.artifacts = [{\"parts\": [{\"type\": \"text\", \"text\": response}]}]\n        task.status = TaskStatus(state=TaskState.COMPLETED)\n        return task\n\nagent = WeatherAgent(\n    name=\"Weather Agent\",\n    description=\"Provides weather information\",\n    version=\"1.0.0\",\n    url=\"http://localhost:8080\",\n)\nrun_server(agent, port=8080)\n</code></pre>"},{"location":"agent/#examples","title":"Examples","text":"<p>See the examples directory for working demos:</p> <ul> <li><code>examples/agent_chat_demo.py</code> - Basic chat demo with custom responses</li> <li><code>examples/agent_chat_a2a_demo.py</code> - A2A agent connection demo</li> <li><code>examples/a2ui_demo.py</code> - A2UI rendering examples (all components)</li> <li><code>examples/a2ui_streaming_demo.py</code> - A2UI streaming/progressive rendering demo</li> <li><code>examples/a2ui_mock_server.py</code> - Mock A2UI server with SSE streaming</li> <li><code>examples/a2ui_sse_client_demo.py</code> - SSE client that connects to A2UI server</li> <li><code>examples/a2a_demo.py</code> - A2A client/server demo</li> <li><code>examples/a2ui_mock_test.py</code> - Mock tests for all A2UI components</li> <li><code>examples/a2ui_google_agent_demo.py</code> - Connect to Google's A2UI sample agents</li> </ul>"},{"location":"agent/#testing-with-googles-sample-agents","title":"Testing with Google's Sample Agents","text":"<p>Castella has been tested with Google's official A2UI sample agents:</p> <pre><code># Clone Google's A2UI repository\ngit clone https://github.com/google/A2UI /tmp/a2ui\n\n# Run the restaurant_finder agent (requires GEMINI_API_KEY)\ncd /tmp/a2ui/samples/agent/adk/restaurant_finder\nexport GEMINI_API_KEY=\"your-key\"\nuv run .\n\n# In another terminal, connect with Castella\nuv run python examples/a2ui_google_agent_demo.py\n</code></pre> <p>Mock tests are available for all components:</p> <pre><code>uv run python examples/a2ui_mock_test.py restaurant  # Restaurant list with images\nuv run python examples/a2ui_mock_test.py form        # Form with TextField, DateTimeInput\nuv run python examples/a2ui_mock_test.py tabs        # Tabs navigation\nuv run python examples/a2ui_mock_test.py icon        # Icon component (emoji mapping)\nuv run python examples/a2ui_mock_test.py modal       # Modal dialog\nuv run python examples/a2ui_mock_test.py choice      # ChoicePicker (radio/checkbox)\n</code></pre>"},{"location":"agent/#references","title":"References","text":"<ul> <li>A2A Protocol - Google's Agent-to-Agent protocol</li> <li>A2UI Specification - Agent-to-User Interface specification</li> <li>python-a2a - Python A2A library</li> </ul>"},{"location":"animation/","title":"Animation","text":"<p>Castella provides a built-in animation system for smooth property animations with easing functions.</p>"},{"location":"animation/#overview","title":"Overview","text":"<p>The animation system consists of:</p> <ul> <li>AnimationScheduler - Background thread ticker (60 FPS for desktop, 10 FPS for TUI)</li> <li>ValueTween - Animate numeric values over time</li> <li>AnimatedState - State wrapper that automatically animates value changes</li> <li>EasingFunction - Built-in easing functions (linear, ease-out, bounce, etc.)</li> </ul>"},{"location":"animation/#valuetween","title":"ValueTween","text":"<p><code>ValueTween</code> animates a value from one number to another over a specified duration.</p> <pre><code>from castella.animation import ValueTween, AnimationScheduler, EasingFunction\n\n# Animate from 0 to 100 over 1 second\nAnimationScheduler.get().add(\n    ValueTween(\n        from_value=0,\n        to_value=100,\n        duration_ms=1000,\n        easing=EasingFunction.EASE_OUT_CUBIC,\n        on_update=lambda v: print(f\"Value: {v}\"),\n        on_complete=lambda: print(\"Done!\"),\n    )\n)\n</code></pre>"},{"location":"animation/#parameters","title":"Parameters","text":"Parameter Type Description <code>from_value</code> float Starting value <code>to_value</code> float Target value <code>duration_ms</code> int Animation duration in milliseconds <code>easing</code> EasingFunction Easing function (default: LINEAR) <code>on_update</code> Callable[[float], None] Callback for each frame <code>on_complete</code> Callable[[], None] Callback when animation completes"},{"location":"animation/#animatedstate","title":"AnimatedState","text":"<p><code>AnimatedState</code> is a state wrapper that automatically animates when values change.</p> <pre><code>from castella import AnimatedState, StatefulComponent, Text, Button, Column\n\nclass Counter(StatefulComponent):\n    def __init__(self):\n        # Values animate automatically when set\n        self._value = AnimatedState(0, duration_ms=300)\n        super().__init__(self._value)\n\n    def view(self):\n        return Column(\n            Text(f\"Value: {self._value()}\"),\n            Button(\"+10\").on_click(lambda _: self._value.set(self._value() + 10)),\n        )\n</code></pre>"},{"location":"animation/#parameters_1","title":"Parameters","text":"Parameter Type Default Description <code>initial</code> T required Initial value <code>duration_ms</code> int 300 Animation duration <code>easing</code> EasingFunction EASE_OUT_CUBIC Easing function"},{"location":"animation/#methods","title":"Methods","text":"Method Description <code>set(value, animate=True)</code> Set value with optional animation <code>set_immediate(value)</code> Set value without animation <code>__call__()</code> Get current (animated) value"},{"location":"animation/#easing-functions","title":"Easing Functions","text":"<p>Available easing functions in <code>EasingFunction</code>:</p> Function Description <code>LINEAR</code> Constant speed <code>EASE_IN_QUAD</code> Accelerate from zero <code>EASE_OUT_QUAD</code> Decelerate to zero <code>EASE_IN_OUT_QUAD</code> Accelerate then decelerate <code>EASE_IN_CUBIC</code> Cubic acceleration <code>EASE_OUT_CUBIC</code> Cubic deceleration <code>EASE_IN_OUT_CUBIC</code> Cubic acceleration/deceleration <code>BOUNCE</code> Bounce effect"},{"location":"animation/#widget-animation-methods","title":"Widget Animation Methods","text":"<p>Widgets have built-in animation methods for position and size:</p> <pre><code># Animate to position/size\nwidget.animate_to(x=200, y=100, duration_ms=400)\n\n# Slide in from off-screen\nwidget.slide_in(\"left\", distance=200, duration_ms=300)\n\n# Slide out to off-screen\nwidget.slide_out(\"right\", distance=200, duration_ms=300)\n</code></pre>"},{"location":"animation/#animate_to","title":"animate_to()","text":"<pre><code>widget.animate_to(\n    x=200,           # Target x position\n    y=100,           # Target y position\n    width=300,       # Target width\n    height=150,      # Target height\n    duration_ms=400, # Duration\n    easing=EasingFunction.EASE_OUT_CUBIC,\n    on_complete=lambda: print(\"Done\"),\n)\n</code></pre>"},{"location":"animation/#slide_in-slide_out","title":"slide_in() / slide_out()","text":"<pre><code># Directions: \"left\", \"right\", \"top\", \"bottom\"\nwidget.slide_in(\"left\", distance=200)\nwidget.slide_out(\"right\", distance=200, on_complete=lambda: print(\"Hidden\"))\n</code></pre>"},{"location":"animation/#complete-example","title":"Complete Example","text":"<pre><code>from castella import (\n    App, Component, Column, Button, Text,\n    ProgressBar, ProgressBarState, AnimatedState,\n)\nfrom castella.animation import ValueTween, AnimationScheduler, EasingFunction\nfrom castella.frame import Frame\n\n\nclass AnimationDemo(Component):\n    def __init__(self):\n        super().__init__()\n        # ProgressBar for ValueTween demo\n        self._progress = ProgressBarState(0, min_val=0, max_val=100)\n        self._progress.attach(self)\n\n        # AnimatedState for automatic animation\n        self._counter = AnimatedState(0, duration_ms=300)\n        self._counter.attach(self)\n\n    def view(self):\n        return Column(\n            Text(\"ValueTween Demo\"),\n            ProgressBar(self._progress).fixed_height(24),\n            Button(\"Animate\").on_click(self._animate),\n\n            Text(f\"Counter: {self._counter()}\"),\n            Button(\"+10\").on_click(lambda _: self._counter.set(self._counter() + 10)),\n        )\n\n    def _animate(self, _):\n        self._progress.set(0)\n        AnimationScheduler.get().add(\n            ValueTween(\n                from_value=0,\n                to_value=100,\n                duration_ms=1500,\n                easing=EasingFunction.BOUNCE,\n                on_update=lambda v: self._progress.set(v),\n            )\n        )\n\n\nApp(Frame(\"Animation Demo\", 400, 300), AnimationDemo()).run()\n</code></pre>"},{"location":"animation/#tui-support","title":"TUI Support","text":"<p>In terminal mode, animations run at a lower frame rate (10 FPS) for better performance. The animation system automatically detects terminal mode via the <code>CASTELLA_IS_TERMINAL_MODE</code> environment variable.</p>"},{"location":"audio/","title":"Audio Playback","text":"<p>Castella provides cross-platform audio playback support through the <code>AudioPlayer</code> widget and <code>AudioManager</code> API. This enables playing music, sound effects, and other audio content in your applications.</p>"},{"location":"audio/#installation","title":"Installation","text":"<p>Audio support requires the SDL_mixer backend, which is included with the SDL backends:</p> <pre><code># Option 1: Audio-only (minimal)\nuv add \"castella[audio]\"\n\n# Option 2: Full SDL2 backend (includes audio)\nuv add \"castella[sdl]\"\n\n# Option 3: Full SDL3 backend (includes audio)\nuv add \"castella[sdl3]\"\n</code></pre>"},{"location":"audio/#supported-formats","title":"Supported Formats","text":"<p>The SDL_mixer backend supports:</p> <ul> <li>MP3 - MPEG Audio Layer 3</li> <li>OGG - Ogg Vorbis</li> <li>WAV - Waveform Audio</li> <li>FLAC - Free Lossless Audio Codec</li> <li>MIDI - Musical Instrument Digital Interface</li> <li>MOD - Module formats (MOD, XM, IT, S3M)</li> </ul>"},{"location":"audio/#audioplayer-widget","title":"AudioPlayer Widget","text":"<p>The <code>AudioPlayer</code> widget provides a complete audio player UI with built-in controls:</p> <pre><code>from castella import App\nfrom castella.audio import AudioPlayer\nfrom castella.frame import Frame\n\n# Create player with audio file\nplayer = AudioPlayer(\"music.mp3\")\n\n# Optional: callback when playback ends\nplayer.on_ended(lambda: print(\"Playback finished!\"))\n\nApp(Frame(\"Audio Player\", 500, 200), player).run()\n</code></pre>"},{"location":"audio/#audioplayer-features","title":"AudioPlayer Features","text":"<ul> <li>Play/Pause button - Toggle playback</li> <li>Stop button - Stop and reset to beginning</li> <li>Seek slider - Scrub through the audio</li> <li>Volume slider - Adjust volume (0-100%)</li> <li>Loop toggle - Enable/disable loop playback</li> <li>Time display - Shows current position and duration</li> </ul>"},{"location":"audio/#audioplayer-options","title":"AudioPlayer Options","text":"<pre><code>player = AudioPlayer(\n    source=\"music.mp3\",    # Audio file path (optional, can load later)\n    show_volume=True,      # Show volume slider (default: True)\n    show_loop=True,        # Show loop toggle (default: True)\n    show_time=True,        # Show time display (default: True)\n)\n</code></pre>"},{"location":"audio/#loading-audio-later","title":"Loading Audio Later","text":"<pre><code>player = AudioPlayer()  # Create without source\nplayer.load(\"music.mp3\")  # Load later\nplayer.play()\n</code></pre>"},{"location":"audio/#using-audioplayer-in-components","title":"Using AudioPlayer in Components","text":"<p>When using <code>AudioPlayer</code> in a <code>Component</code>, use <code>freeze()</code> to preserve the player across view rebuilds:</p> <pre><code>from castella import Component, Column, Text\nfrom castella.audio import AudioPlayer\nfrom castella.core import State\n\n\nclass MusicPlayerComponent(Component):\n    def __init__(self, audio_file: str):\n        super().__init__()\n        self._status = State(\"Ready\")\n        self._status.attach(self)\n\n        # Create and freeze the player\n        self._player = AudioPlayer(audio_file)\n        self._player.on_ended(self._on_ended)\n        self._player.freeze()  # Prevents audio unload on view rebuild\n\n    def _on_ended(self):\n        self._status.set(\"Playback finished!\")\n\n    def view(self):\n        return Column(\n            Text(f\"Status: {self._status()}\"),\n            self._player,\n        )\n</code></pre>"},{"location":"audio/#audiomanager-api","title":"AudioManager API","text":"<p>For more control over audio playback, use the low-level <code>AudioManager</code> API:</p> <pre><code>from castella.audio import AudioManager\n\n# Get the singleton manager\nmanager = AudioManager.get()\n\n# Load an audio file\nhandle, state = manager.load(\"music.mp3\")\n\n# Control playback\nmanager.play(handle)\nmanager.pause(handle)\nmanager.stop(handle)\n\n# Adjust settings\nmanager.set_volume(handle, 0.5)  # 50% volume (0.0 to 1.0)\nmanager.seek(handle, 30000)      # Seek to 30 seconds (milliseconds)\nmanager.set_loop(handle, True)   # Enable loop\n\n# Cleanup when done\nmanager.unload(handle)\n</code></pre>"},{"location":"audio/#audiomanager-methods","title":"AudioManager Methods","text":"Method Description <code>load(source)</code> Load audio file, returns <code>(handle, AudioState)</code> <code>play(handle, loop=False)</code> Start playback <code>pause(handle)</code> Pause playback <code>stop(handle)</code> Stop and reset position <code>seek(handle, position_ms)</code> Seek to position in milliseconds <code>set_volume(handle, volume)</code> Set volume (0.0 to 1.0) <code>set_loop(handle, loop)</code> Enable/disable loop <code>get_state(handle)</code> Get <code>AudioState</code> for a handle <code>unload(handle)</code> Unload audio and free resources <code>set_on_ended(handle, callback)</code> Set callback for playback end"},{"location":"audio/#reactive-audiostate","title":"Reactive AudioState","text":"<p><code>AudioState</code> is observable and can be attached to components for automatic UI updates:</p> <pre><code>from castella.audio import AudioManager, PlaybackState\nfrom castella import StatefulComponent, Column, Text, Button\n\n\nclass CustomPlayer(StatefulComponent):\n    def __init__(self, audio_file: str):\n        manager = AudioManager.get()\n        self._handle, self._state = manager.load(audio_file)\n        super().__init__(self._state)  # Trigger view() on state change\n\n    def view(self):\n        return Column(\n            Text(f\"State: {self._state.state.value}\"),\n            Text(f\"Position: {self._state.format_progress()}\"),\n            Text(f\"Volume: {int(self._state.volume * 100)}%\"),\n            Button(\"Play\").on_click(lambda _: AudioManager.get().play(self._handle)),\n            Button(\"Pause\").on_click(lambda _: AudioManager.get().pause(self._handle)),\n        )\n</code></pre>"},{"location":"audio/#audiostate-properties","title":"AudioState Properties","text":"Property Type Description <code>state</code> <code>PlaybackState</code> Current state (STOPPED, PLAYING, PAUSED, LOADING, ERROR) <code>position_ms</code> <code>int</code> Current position in milliseconds <code>duration_ms</code> <code>int</code> Total duration in milliseconds <code>volume</code> <code>float</code> Volume level (0.0 to 1.0) <code>loop</code> <code>bool</code> Loop setting <code>progress</code> <code>float</code> Playback progress (0.0 to 1.0) <code>error_message</code> <code>str \\| None</code> Error message if state is ERROR"},{"location":"audio/#audiostate-methods","title":"AudioState Methods","text":"Method Description <code>is_playing()</code> Check if currently playing <code>is_paused()</code> Check if paused <code>is_stopped()</code> Check if stopped <code>format_time(ms)</code> Format milliseconds as \"M:SS\" or \"H:MM:SS\" <code>format_duration()</code> Format total duration <code>format_progress()</code> Format as \"position / duration\""},{"location":"audio/#playbackstate-enum","title":"PlaybackState Enum","text":"<pre><code>from castella.audio import PlaybackState\n\nPlaybackState.STOPPED   # Audio is stopped\nPlaybackState.PLAYING   # Audio is playing\nPlaybackState.PAUSED    # Audio is paused\nPlaybackState.LOADING   # Audio is loading\nPlaybackState.ERROR     # An error occurred\n</code></pre>"},{"location":"audio/#playback-end-callback","title":"Playback End Callback","text":"<p>Get notified when playback ends:</p> <pre><code># With AudioPlayer\nplayer = AudioPlayer(\"music.mp3\")\nplayer.on_ended(lambda: print(\"Done!\"))\n\n# With AudioManager\nmanager = AudioManager.get()\nhandle, state = manager.load(\"music.mp3\")\nmanager.set_on_ended(handle, lambda: print(\"Done!\"))\n</code></pre>"},{"location":"audio/#backend-information","title":"Backend Information","text":"<p>Check which audio backend is being used:</p> <pre><code>from castella.audio import AudioManager\n\nmanager = AudioManager.get()\nprint(f\"Backend: {manager.backend_name}\")  # e.g., \"SDL_mixer\"\n</code></pre>"},{"location":"audio/#terminal-mode-tui","title":"Terminal Mode (TUI)","text":"<p>In terminal mode, a silent \"noop\" backend is used. Audio methods work but produce no sound:</p> <pre><code>CASTELLA_FRAME=tui uv run python your_app.py\n</code></pre>"},{"location":"audio/#complete-example","title":"Complete Example","text":"<p>See examples/audio_player_demo.py for a complete example demonstrating both the <code>AudioPlayer</code> widget and low-level <code>AudioManager</code> API.</p> <pre><code>uv run python examples/audio_player_demo.py path/to/audio.mp3\n</code></pre>"},{"location":"castella-skia/","title":"castella-skia - Unified Rust Skia Backend","text":"<p>castella-skia is a Rust-based Skia rendering backend that provides GPU-accelerated graphics for Castella on Desktop and iOS platforms.</p>"},{"location":"castella-skia/#overview","title":"Overview","text":"<ul> <li>Single codebase for Desktop (OpenGL) and iOS (Metal)</li> <li>High performance GPU-accelerated rendering via skia-safe</li> <li>Automatic font fallback for emoji, CJK, and mixed scripts using Skia Paragraph API</li> <li>Thread-local caching for FontCollection and DirectContext</li> </ul>"},{"location":"castella-skia/#why-castella-skia","title":"Why castella-skia?","text":"Benefit Description Unified rendering Same Skia version and behavior across platforms Simplified dependencies No need for skia-python on Desktop iOS support Metal backend enables native iOS rendering Full control Owned crate with version management Maintainability Bug fixes apply to all platforms"},{"location":"castella-skia/#platform-backends","title":"Platform Backends","text":"Platform Graphics API Notes Desktop macOS OpenGL 3.2 Core Core Profile for shader compatibility Desktop Linux OpenGL / Vulkan Environment dependent Desktop Windows OpenGL / Vulkan Environment dependent iOS Metal Native iOS GPU API Android Vulkan Planned"},{"location":"castella-skia/#usage","title":"Usage","text":""},{"location":"castella-skia/#desktop","title":"Desktop","text":"<p>castella-skia is the rendering backend for Desktop (GLFW/SDL). No configuration needed:</p> <pre><code>uv run python examples/counter.py\n</code></pre>"},{"location":"castella-skia/#ios","title":"iOS","text":"<p>iOS always uses castella-skia with the Metal backend. No configuration needed.</p>"},{"location":"castella-skia/#building-from-source","title":"Building from Source","text":""},{"location":"castella-skia/#prerequisites","title":"Prerequisites","text":"<ul> <li>Rust toolchain (stable)</li> <li>Python 3.10+</li> <li>maturin (<code>pip install maturin</code>)</li> </ul>"},{"location":"castella-skia/#development-build","title":"Development Build","text":"<pre><code>cd bindings/python\nsource ../../.venv/bin/activate  # If using venv\nmaturin develop --release\n</code></pre>"},{"location":"castella-skia/#ios-cross-compilation","title":"iOS Cross-Compilation","text":"<pre><code># Add iOS targets\nrustup target add aarch64-apple-ios-sim  # M1/M2 Simulator\nrustup target add aarch64-apple-ios      # Physical device\n\n# Build for iOS Simulator\ncd bindings/python\n./build_ios.sh\n</code></pre>"},{"location":"castella-skia/#architecture","title":"Architecture","text":"<pre><code>castella/\n\u251c\u2500\u2500 Cargo.toml                    # Workspace configuration\n\u251c\u2500\u2500 castella-skia-core/           # Pure Rust core library\n\u2502   \u251c\u2500\u2500 Cargo.toml\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 lib.rs                # Public API\n\u2502       \u251c\u2500\u2500 painter.rs            # SkiaPainter implementation\n\u2502       \u251c\u2500\u2500 surface.rs            # GPU surface management\n\u2502       \u251c\u2500\u2500 font.rs               # Font management and fallback\n\u2502       \u251c\u2500\u2500 image.rs              # Image loading and caching\n\u2502       \u2514\u2500\u2500 types.rs              # Type definitions\n\u2514\u2500\u2500 bindings/python/              # Python bindings (PyO3)\n    \u251c\u2500\u2500 Cargo.toml\n    \u251c\u2500\u2500 pyproject.toml\n    \u251c\u2500\u2500 src/lib.rs                # PyO3 wrapper\n    \u2514\u2500\u2500 python/castella_skia/     # Python package\n</code></pre>"},{"location":"castella-skia/#key-components","title":"Key Components","text":""},{"location":"castella-skia/#surface","title":"Surface","text":"<p>Manages GPU context and rendering surface:</p> <pre><code>from castella_skia import Surface\n\n# Desktop (OpenGL)\nsurface = Surface(width, height)\n\n# iOS (Metal)\nsurface = Surface.from_metal(device, queue, width, height)\n</code></pre>"},{"location":"castella-skia/#skiapainter","title":"SkiaPainter","text":"<p>Implements BasePainter protocol:</p> <pre><code>from castella_skia import Surface, SkiaPainter\n\nsurface = Surface(800, 600)\npainter = SkiaPainter(surface)\n\n# Drawing operations\npainter.fill_rect(0, 0, 100, 50, style)\npainter.fill_text(\"Hello\", 10, 30, style)\npainter.fill_circle(50, 50, 25, style)\n</code></pre>"},{"location":"castella-skia/#supported-operations","title":"Supported Operations","text":"Method Description <code>fill_rect</code> Fill a rectangle <code>stroke_rect</code> Stroke a rectangle outline <code>fill_circle</code> Fill a circle <code>stroke_circle</code> Stroke a circle outline <code>fill_rounded_rect</code> Fill a rounded rectangle <code>stroke_rounded_rect</code> Stroke a rounded rectangle outline <code>fill_text</code> Draw filled text <code>measure_text</code> Measure text dimensions <code>clip</code> Set clipping rectangle <code>translate</code> Translate coordinate system <code>save</code> / <code>restore</code> Save/restore canvas state <code>draw_image</code> Draw an image"},{"location":"castella-skia/#font-fallback","title":"Font Fallback","text":"<p>castella-skia uses Skia's Paragraph API for automatic font fallback:</p> <ul> <li>Emoji: Automatically uses system emoji font</li> <li>CJK: Falls back to appropriate CJK fonts (Hiragino, PingFang, etc.)</li> <li>Mixed scripts: Seamlessly handles mixed language text</li> </ul> <pre><code># This \"just works\" - emoji and Japanese rendered correctly\npainter.fill_text(\"Hello \ud83d\udc4b \u3053\u3093\u306b\u3061\u306f\", 10, 30, style)\n</code></pre>"},{"location":"castella-skia/#integration-with-castella","title":"Integration with Castella","text":"<p>castella-skia integrates via <code>rust_skia_painter.py</code>:</p> <pre><code># castella/rust_skia_painter.py\nfrom castella_skia import Surface, SkiaPainter\n\nclass RustSkiaPainter(BasePainter):\n    def __init__(self, frame):\n        self._surface = Surface(frame.width, frame.height)\n        self._painter = SkiaPainter(self._surface)\n\n    def fill_rect(self, x, y, w, h, style):\n        self._painter.fill_rect(x, y, w, h, self._convert_style(style))\n</code></pre>"},{"location":"castella-skia/#performance","title":"Performance","text":""},{"location":"castella-skia/#caching","title":"Caching","text":"<ul> <li>FontCollection: Thread-local caching avoids recreation</li> <li>DirectContext: GPU context cached per thread</li> <li>Typeface: Font faces cached by family name</li> </ul>"},{"location":"castella-skia/#best-practices","title":"Best Practices","text":"<ol> <li>Reuse Surface objects when possible</li> <li>Batch drawing operations</li> <li>Use <code>save()</code>/<code>restore()</code> instead of recreating painters</li> </ol>"},{"location":"castella-skia/#troubleshooting","title":"Troubleshooting","text":""},{"location":"castella-skia/#opengl-context-issues-desktop","title":"OpenGL Context Issues (Desktop)","text":"<p>If you see OpenGL errors on macOS:</p> <pre><code># Ensure OpenGL 3.2 Core Profile is available\n# Check system_profiler for GPU capabilities\nsystem_profiler SPDisplaysDataType\n</code></pre>"},{"location":"castella-skia/#metal-not-available-ios-simulator","title":"Metal Not Available (iOS Simulator)","text":"<p>Ensure you're using an M1/M2 Mac or a compatible Simulator version.</p>"},{"location":"castella-skia/#font-rendering-issues","title":"Font Rendering Issues","text":"<p>If fonts appear incorrect:</p> <ol> <li>Check that system fonts are available</li> <li>Verify the font family name is correct</li> <li>Test with a known-good font like \"Arial\" or \"Helvetica\"</li> </ol>"},{"location":"castella-skia/#see-also","title":"See Also","text":"<ul> <li>iOS Documentation - iOS-specific usage</li> <li>Environment Variables - Configuration options</li> </ul>"},{"location":"chart/","title":"Charts","text":"<p>Castella provides native interactive chart widgets with GPU rendering via Skia (desktop) and CanvasKit (web). No external dependencies like Matplotlib required.</p>"},{"location":"chart/#features","title":"Features","text":"<ul> <li>8 Chart Types: Bar, Line, Pie, Scatter, Area, Stacked Bar, Gauge, Heatmap</li> <li>Full Interactivity: Tooltips, hover effects, click events</li> <li>Drill-Down Navigation: Click to explore hierarchical data (Region \u2192 Country \u2192 City)</li> <li>Scientific Colormaps: Viridis, Plasma, Inferno, Magma (colorblind-friendly)</li> <li>Pydantic v2 Models: Type-safe, validated data models</li> <li>Theme Integration: Automatically uses current Castella theme</li> <li>Observable Pattern: Charts auto-update when data changes</li> </ul>"},{"location":"chart/#quick-start","title":"Quick Start","text":"<pre><code>from castella.chart import BarChart, CategoricalChartData, CategoricalSeries, SeriesStyle\n\n# Create data\ndata = CategoricalChartData(title=\"Sales by Quarter\")\ndata.add_series(CategoricalSeries.from_values(\n    name=\"2024\",\n    categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n    values=[100, 120, 90, 150],\n    style=SeriesStyle(color=\"#3b82f6\"),\n))\n\n# Create chart\nchart = BarChart(data, show_values=True)\n</code></pre>"},{"location":"chart/#data-models","title":"Data Models","text":""},{"location":"chart/#categoricalchartdata","title":"CategoricalChartData","text":"<p>For charts with category labels (Bar, Pie, Stacked Bar):</p> <pre><code>from castella.chart import CategoricalChartData, CategoricalSeries, SeriesStyle\n\ndata = CategoricalChartData(title=\"Monthly Sales\")\ndata.add_series(CategoricalSeries.from_values(\n    name=\"Product A\",\n    categories=[\"Jan\", \"Feb\", \"Mar\", \"Apr\"],\n    values=[50, 75, 60, 90],\n    style=SeriesStyle(color=\"#3b82f6\"),\n))\ndata.add_series(CategoricalSeries.from_values(\n    name=\"Product B\",\n    categories=[\"Jan\", \"Feb\", \"Mar\", \"Apr\"],\n    values=[40, 55, 70, 65],\n    style=SeriesStyle(color=\"#22c55e\"),\n))\n</code></pre>"},{"location":"chart/#numericchartdata","title":"NumericChartData","text":"<p>For charts with numeric X/Y data (Line, Scatter, Area):</p> <pre><code>from castella.chart import NumericChartData, NumericSeries, SeriesStyle\n\ndata = NumericChartData(title=\"Temperature Over Time\")\n\n# Y values only (X auto-generated as 0, 1, 2, ...)\ndata.add_series(NumericSeries.from_y_values(\n    name=\"Sensor A\",\n    y_values=[20, 22, 21, 25, 24, 23],\n    style=SeriesStyle(color=\"#3b82f6\"),\n))\n\n# Explicit X and Y values\ndata.add_series(NumericSeries.from_values(\n    name=\"Sensor B\",\n    x_values=[0, 1, 2, 3, 4, 5],\n    y_values=[18, 19, 20, 22, 21, 20],\n    style=SeriesStyle(color=\"#22c55e\"),\n))\n</code></pre>"},{"location":"chart/#gaugechartdata","title":"GaugeChartData","text":"<p>For gauge/meter charts:</p> <pre><code>from castella.chart import GaugeChartData\n\ndata = GaugeChartData(\n    title=\"CPU Usage\",\n    value=67,\n    min_value=0,\n    max_value=100,\n    value_format=\"{:.0f}%\",\n    thresholds=[\n        (0.0, \"#22c55e\"),   # Green for 0-50%\n        (0.5, \"#f59e0b\"),   # Yellow for 50-80%\n        (0.8, \"#ef4444\"),   # Red for 80-100%\n    ],\n)\n</code></pre>"},{"location":"chart/#heatmapchartdata","title":"HeatmapChartData","text":"<p>For heatmap charts with 2D matrix data:</p> <pre><code>from castella.chart import HeatmapChartData\n\n# Create from 2D array\ndata = HeatmapChartData.from_2d_array(\n    values=[\n        [1.0, 0.8, 0.3],\n        [0.8, 1.0, 0.5],\n        [0.3, 0.5, 1.0],\n    ],\n    row_labels=[\"A\", \"B\", \"C\"],\n    column_labels=[\"X\", \"Y\", \"Z\"],\n    title=\"Correlation Matrix\",\n)\n\n# Set value range for color normalization\ndata.set_range(min_value=-1.0, max_value=1.0)\n\n# Update single cell\ndata.set_cell(row=0, col=1, value=0.9)\n\n# Update entire matrix\ndata.set_values([[1.0, 0.9], [0.9, 1.0]])\n</code></pre>"},{"location":"chart/#chart-types","title":"Chart Types","text":""},{"location":"chart/#barchart","title":"BarChart","text":"<p>Vertical bar chart for categorical data:</p> <pre><code>from castella.chart import BarChart, CategoricalChartData, CategoricalSeries\n\ndata = CategoricalChartData(title=\"Sales\")\ndata.add_series(CategoricalSeries.from_values(\n    name=\"Revenue\",\n    categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n    values=[100, 150, 120, 180],\n))\n\nchart = BarChart(\n    data,\n    show_values=True,      # Show value labels on bars\n    bar_width_ratio=0.7,   # Bar width as ratio of available space\n    enable_tooltip=True,   # Show tooltips on hover\n)\n</code></pre>"},{"location":"chart/#linechart","title":"LineChart","text":"<p>Line chart with optional points:</p> <pre><code>from castella.chart import LineChart, NumericChartData, NumericSeries\n\ndata = NumericChartData(title=\"Stock Price\")\ndata.add_series(NumericSeries.from_y_values(\n    name=\"AAPL\",\n    y_values=[150, 155, 148, 160, 158, 165],\n))\n\nchart = LineChart(\n    data,\n    show_points=True,     # Show data points\n    point_radius=4.0,     # Point size\n    line_width=2.0,       # Line thickness\n    smooth=False,         # Use straight lines (True for Catmull-Rom splines)\n)\n\n# Smooth curves using Catmull-Rom spline interpolation\nsmooth_chart = LineChart(data, smooth=True)\n</code></pre>"},{"location":"chart/#piechart","title":"PieChart","text":"<p>Pie and donut charts:</p> <pre><code>from castella.chart import PieChart, CategoricalChartData, CategoricalSeries\n\ndata = CategoricalChartData(title=\"Market Share\")\ndata.add_series(CategoricalSeries.from_values(\n    name=\"Companies\",\n    categories=[\"Company A\", \"Company B\", \"Company C\", \"Others\"],\n    values=[35, 28, 22, 15],\n))\n\nchart = PieChart(\n    data,\n    inner_radius_ratio=0.0,  # 0.0 for pie, 0.5+ for donut\n    show_labels=True,        # Show category labels\n    show_percentages=True,   # Show percentage values\n)\n</code></pre>"},{"location":"chart/#scatterchart","title":"ScatterChart","text":"<p>Scatter plot with customizable point shapes:</p> <pre><code>from castella.chart import ScatterChart, PointShape, NumericChartData, NumericSeries\n\ndata = NumericChartData(title=\"Height vs Weight\")\ndata.add_series(NumericSeries.from_values(\n    name=\"Male\",\n    x_values=[170, 175, 180, 185],\n    y_values=[70, 75, 80, 85],\n))\n\nchart = ScatterChart(\n    data,\n    point_radius=6,\n    point_shape=PointShape.CIRCLE,  # CIRCLE, SQUARE, DIAMOND, TRIANGLE\n    show_grid=True,\n)\n</code></pre>"},{"location":"chart/#areachart","title":"AreaChart","text":"<p>Filled area chart:</p> <pre><code>from castella.chart import AreaChart, NumericChartData, NumericSeries\n\ndata = NumericChartData(title=\"Website Traffic\")\ndata.add_series(NumericSeries.from_y_values(\n    name=\"Visitors\",\n    y_values=[1200, 1500, 1300, 1800, 2100],\n))\n\nchart = AreaChart(\n    data,\n    fill_opacity=0.3,    # Area fill transparency\n    show_points=True,    # Show data points\n    stacked=False,       # Stack multiple series\n)\n</code></pre>"},{"location":"chart/#stackedbarchart","title":"StackedBarChart","text":"<p>Stacked bar chart for comparing parts of a whole:</p> <pre><code>from castella.chart import StackedBarChart, CategoricalChartData, CategoricalSeries\n\ndata = CategoricalChartData(title=\"Revenue by Region\")\ndata.add_series(CategoricalSeries.from_values(\n    name=\"North\", categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"], values=[100, 120, 90, 150],\n))\ndata.add_series(CategoricalSeries.from_values(\n    name=\"South\", categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"], values=[80, 100, 110, 95],\n))\ndata.add_series(CategoricalSeries.from_values(\n    name=\"East\", categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"], values=[60, 75, 85, 70],\n))\n\nchart = StackedBarChart(\n    data,\n    normalized=False,    # True for 100% stacked chart\n    show_values=False,\n)\n</code></pre>"},{"location":"chart/#gaugechart","title":"GaugeChart","text":"<p>Gauge/meter chart with threshold colors:</p> <pre><code>from castella.chart import GaugeChart, GaugeStyle, GaugeChartData\n\ndata = GaugeChartData(\n    title=\"CPU Usage\",\n    value=67,\n    min_value=0,\n    max_value=100,\n    value_format=\"{:.0f}%\",\n    thresholds=[\n        (0.0, \"#22c55e\"),   # Green\n        (0.5, \"#f59e0b\"),   # Yellow\n        (0.8, \"#ef4444\"),   # Red\n    ],\n)\n\nchart = GaugeChart(\n    data,\n    style=GaugeStyle.HALF_CIRCLE,  # HALF_CIRCLE, THREE_QUARTER, FULL_CIRCLE\n    show_ticks=True,\n    arc_width=25,\n)\n</code></pre>"},{"location":"chart/#heatmapchart","title":"HeatmapChart","text":"<p>Heatmap for 2D matrix data visualization:</p> <pre><code>from castella.chart import HeatmapChart, HeatmapChartData, ColormapType\n\n# Create correlation matrix data\ndata = HeatmapChartData.from_2d_array(\n    values=[\n        [1.00, 0.85, 0.42, -0.15],\n        [0.85, 1.00, 0.55, 0.08],\n        [0.42, 0.55, 1.00, 0.67],\n        [-0.15, 0.08, 0.67, 1.00],\n    ],\n    row_labels=[\"Price\", \"Volume\", \"Volatility\", \"Beta\"],\n    column_labels=[\"Price\", \"Volume\", \"Volatility\", \"Beta\"],\n    title=\"Correlation Matrix\",\n)\n\n# Set fixed value range for color normalization\ndata.set_range(-1.0, 1.0)\n\nchart = HeatmapChart(\n    data,\n    colormap=ColormapType.VIRIDIS,  # VIRIDIS, PLASMA, INFERNO, MAGMA\n    show_values=True,       # Show value annotations in cells\n    show_colorbar=True,     # Show color bar legend\n    cell_gap=2.0,           # Gap between cells in pixels\n)\n</code></pre>"},{"location":"chart/#colormaps","title":"Colormaps","text":"<p>Castella provides scientific colormaps that are perceptually uniform and colorblind-friendly:</p> <pre><code>from castella.chart import viridis, plasma, inferno, magma, get_colormap\n\n# Get colormap by type\ncmap = get_colormap(ColormapType.VIRIDIS)\n\n# Get color for a normalized value (0.0 to 1.0)\ncolor = cmap(0.5)  # Returns \"#26828e\"\n\n# Get N evenly spaced colors\ncolors = cmap.get_colors(5)  # [\"#440154\", \"#3e4a89\", \"#26828e\", \"#35b779\", \"#fde725\"]\n\n# Reversed colormap\nreversed_cmap = cmap.reversed()\n</code></pre>"},{"location":"chart/#heatmap-with-datatable","title":"Heatmap with DataTable","text":"<p>You can also apply heatmap coloring to DataTable cells using <code>HeatmapConfig</code>:</p> <pre><code>from castella import DataTable, DataTableState, ColumnConfig, HeatmapConfig\nfrom castella.chart import ColormapType\n\n# Create table data\nstate = DataTableState(\n    columns=[\n        ColumnConfig(name=\"Region\", width=120),\n        ColumnConfig(name=\"Q1\", width=80),\n        ColumnConfig(name=\"Q2\", width=80),\n        ColumnConfig(name=\"Q3\", width=80),\n        ColumnConfig(name=\"Q4\", width=80),\n    ],\n    rows=[\n        [\"North America\", 145, 162, 178, 195],\n        [\"Europe\", 122, 138, 155, 168],\n        [\"Asia Pacific\", 198, 215, 242, 267],\n    ],\n)\n\n# Apply heatmap coloring to numeric columns\nheatmap = HeatmapConfig(colormap=ColormapType.VIRIDIS)\nfor i in range(1, 5):\n    state.columns[i].cell_bg_color = heatmap.create_color_fn(col_idx=i, state=state)\n\ntable = DataTable(state)\n</code></pre> <p>Features: - Auto-contrast text: Text color automatically adjusts for readability - Per-column ranges: Each column can have its own value range - Custom colormaps: Pass any <code>Colormap</code> instance</p>"},{"location":"chart/#interactivity","title":"Interactivity","text":""},{"location":"chart/#event-handlers","title":"Event Handlers","text":"<p>All charts support hover and click events:</p> <pre><code>chart = BarChart(data).on_click(on_bar_click).on_hover(on_bar_hover)\n\ndef on_bar_click(event):\n    print(f\"Clicked: {event.label} = {event.value}\")\n    print(f\"Series: {event.series_index}, Data: {event.data_index}\")\n\ndef on_bar_hover(event):\n    print(f\"Hovering: {event.label}\")\n</code></pre>"},{"location":"chart/#tooltips","title":"Tooltips","text":"<p>Tooltips are enabled by default and show on hover:</p> <pre><code>chart = LineChart(data, enable_tooltip=True)  # Default\nchart = LineChart(data, enable_tooltip=False)  # Disable\n</code></pre>"},{"location":"chart/#series-visibility","title":"Series Visibility","text":"<p>Toggle series visibility (useful with legends):</p> <pre><code># Hide/show series\ndata.set_series_visibility(series_index=1, visible=False)\ndata.toggle_series_visibility(series_index=0)\n\n# Check visibility\nif data.is_series_visible(0):\n    print(\"Series 0 is visible\")\n</code></pre>"},{"location":"chart/#reactive-updates","title":"Reactive Updates","text":"<p>Charts automatically re-render when their data changes:</p> <pre><code>class LiveChart(Component):\n    def __init__(self):\n        super().__init__()\n        self._data = GaugeChartData(title=\"CPU\", value=50, max_value=100)\n        self._data.attach(self)  # Re-render on data change\n\n    def view(self):\n        return Column(\n            GaugeChart(self._data, style=GaugeStyle.HALF_CIRCLE),\n            Button(\"Update\").on_click(self._update),\n        )\n\n    def _update(self, _):\n        import random\n        self._data.set_value(random.randint(0, 100))  # Triggers re-render\n</code></pre>"},{"location":"chart/#seriesstyle","title":"SeriesStyle","text":"<p>Customize series appearance:</p> <pre><code>from castella.chart import SeriesStyle\n\nstyle = SeriesStyle(\n    color=\"#3b82f6\",       # Primary color\n    fill_opacity=0.3,      # Fill transparency (for area charts)\n    line_width=2.0,        # Line thickness\n    point_radius=4.0,      # Point size\n)\n\nseries = CategoricalSeries.from_values(\n    name=\"Sales\",\n    categories=[\"A\", \"B\", \"C\"],\n    values=[10, 20, 30],\n    style=style,\n)\n</code></pre>"},{"location":"chart/#complete-example","title":"Complete Example","text":"<pre><code>from castella import App, Component, Column, Row, Button\nfrom castella.frame import Frame\nfrom castella.chart import (\n    BarChart, LineChart, PieChart, GaugeChart, GaugeStyle,\n    CategoricalChartData, NumericChartData, GaugeChartData,\n    CategoricalSeries, NumericSeries, SeriesStyle,\n)\n\n\nclass ChartDemo(Component):\n    def __init__(self):\n        super().__init__()\n\n        # Bar chart data\n        self._bar_data = CategoricalChartData(title=\"Quarterly Sales\")\n        self._bar_data.add_series(CategoricalSeries.from_values(\n            name=\"2024\",\n            categories=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n            values=[120, 150, 130, 180],\n            style=SeriesStyle(color=\"#3b82f6\"),\n        ))\n        self._bar_data.attach(self)\n\n        # Line chart data\n        self._line_data = NumericChartData(title=\"Daily Views\")\n        self._line_data.add_series(NumericSeries.from_y_values(\n            name=\"Page Views\",\n            y_values=[100, 120, 90, 150, 180, 160, 200],\n            style=SeriesStyle(color=\"#22c55e\"),\n        ))\n        self._line_data.attach(self)\n\n        # Gauge data\n        self._gauge_data = GaugeChartData(\n            title=\"Performance\",\n            value=75,\n            max_value=100,\n            value_format=\"{:.0f}%\",\n        )\n        self._gauge_data.attach(self)\n\n    def view(self):\n        return Column(\n            Row(\n                BarChart(self._bar_data, show_values=True)\n                    .on_click(lambda e: print(f\"Bar: {e.label}\")),\n                LineChart(self._line_data, show_points=True)\n                    .on_hover(lambda e: print(f\"Line: {e.value}\")),\n            ),\n            Row(\n                GaugeChart(self._gauge_data, style=GaugeStyle.HALF_CIRCLE),\n                Button(\"Randomize\").on_click(self._randomize),\n            ).fixed_height(200),\n        )\n\n    def _randomize(self, _):\n        import random\n        self._gauge_data.set_value(random.randint(0, 100))\n\n\nApp(Frame(\"Chart Demo\", 1000, 700), ChartDemo()).run()\n</code></pre>"},{"location":"chart/#drill-down-charts","title":"Drill-Down Charts","text":"<p>Drill-down charts allow users to navigate through hierarchical data by clicking on data points to see more detailed breakdowns.</p>"},{"location":"chart/#supported-chart-types","title":"Supported Chart Types","text":"<ul> <li>BarChart: Click bars to drill down</li> <li>PieChart: Click slices to drill down</li> <li>StackedBarChart: Click stacked segments to drill down</li> <li>HeatmapChart: Click cells (row-based) to drill down</li> </ul>"},{"location":"chart/#basic-usage","title":"Basic Usage","text":"<pre><code>from castella.chart import (\n    DrillDownChart, HierarchicalChartData, HierarchicalNode,\n    DataPoint, BarChart,\n)\n\n# Create hierarchical data: Region -&gt; Country -&gt; City\ndata = HierarchicalChartData(\n    title=\"Global Sales\",\n    root=HierarchicalNode(\n        id=\"world\",\n        label=\"World\",\n        level_name=\"Region\",\n        data=[\n            DataPoint(category=\"North America\", value=1500, label=\"North America\"),\n            DataPoint(category=\"Europe\", value=1200, label=\"Europe\"),\n            DataPoint(category=\"Asia\", value=1800, label=\"Asia\"),\n        ],\n    ),\n)\n\n# Add child data for North America\nna_node = HierarchicalNode(\n    id=\"na\",\n    label=\"North America\",\n    level_name=\"Country\",\n    data=[\n        DataPoint(category=\"USA\", value=900, label=\"USA\"),\n        DataPoint(category=\"Canada\", value=400, label=\"Canada\"),\n        DataPoint(category=\"Mexico\", value=200, label=\"Mexico\"),\n    ],\n)\ndata.root.add_child(\"North America\", na_node)\n\n# Create drill-down chart\nchart = (\n    DrillDownChart(data, chart_type=BarChart, show_values=True)\n    .on_drill_down(lambda ev: print(f\"Drilled into: {ev.clicked_key}\"))\n    .on_drill_up(lambda ev: print(f\"Drilled up to: {ev.to_node_id}\"))\n)\n</code></pre>"},{"location":"chart/#navigation-controls","title":"Navigation Controls","text":"<ul> <li>Click on data: Drill down into child data</li> <li>Back button: Go up one level</li> <li>Breadcrumb: Navigate to any ancestor level</li> </ul>"},{"location":"chart/#multi-series-data-stackedbarchart-heatmapchart","title":"Multi-Series Data (StackedBarChart / HeatmapChart)","text":"<p>For StackedBarChart and HeatmapChart, use <code>series_data</code> instead of <code>data</code>:</p> <pre><code>from castella.chart import (\n    DrillDownChart, HierarchicalChartData, HierarchicalNode,\n    DataPoint, StackedBarChart, HeatmapChart,\n)\n\ndef make_quarterly_data(categories, base_values):\n    \"\"\"Create quarterly breakdown for each category.\"\"\"\n    quarters = [\"Q1\", \"Q2\", \"Q3\", \"Q4\"]\n    ratios = [0.2, 0.25, 0.25, 0.3]\n    result = {}\n    for q_idx, quarter in enumerate(quarters):\n        points = []\n        for cat, base in zip(categories, base_values):\n            value = base * ratios[q_idx]\n            points.append(DataPoint(category=cat, value=value, label=cat))\n        result[quarter] = points\n    return result\n\n# Root level with quarterly breakdown\ndata = HierarchicalChartData(\n    title=\"Quarterly Sales by Region\",\n    root=HierarchicalNode(\n        id=\"world\",\n        label=\"World\",\n        level_name=\"Region\",\n        series_data=make_quarterly_data(\n            [\"North America\", \"Europe\", \"Asia\"],\n            [1500, 1200, 1800],\n        ),\n    ),\n)\n\n# StackedBarChart shows stacked bars with Q1-Q4 colors\nstacked_chart = DrillDownChart(data, chart_type=StackedBarChart, show_values=True)\n\n# HeatmapChart shows 2D matrix (rows=categories, columns=quarters)\nheatmap_chart = DrillDownChart(data, chart_type=HeatmapChart, show_values=True)\n</code></pre>"},{"location":"chart/#time-series-drill-down","title":"Time-Series Drill-Down","text":"<p>Helper function for Year \u2192 Month \u2192 Day hierarchy:</p> <pre><code>from datetime import date\nfrom castella.chart import (\n    DrillDownChart, hierarchical_from_timeseries, BarChart,\n)\n\n# Sample data: (date, value) tuples\ndaily_sales = [\n    (date(2023, 1, 1), 120.0),\n    (date(2023, 1, 2), 145.0),\n    # ... more data\n]\n\n# Create hierarchical structure automatically\ndata = hierarchical_from_timeseries(\n    daily_sales,\n    title=\"Daily Sales\",\n    aggregation=\"sum\",      # sum, avg, count, min, max\n    depth=\"day\",            # year, month, or day\n    short_month_names=True, # \"Jan\" vs \"January\"\n    value_format=lambda v: f\"${v:,.0f}\",\n)\n\nchart = DrillDownChart(data, chart_type=BarChart, show_values=True)\n</code></pre>"},{"location":"chart/#programmatic-navigation","title":"Programmatic Navigation","text":"<pre><code>chart = DrillDownChart(data, chart_type=BarChart)\n\n# Access the drill-down state\nstate = chart.state\n\n# Navigate programmatically\nstate.drill_down(\"North America\")\nstate.drill_up()\nstate.navigate_to(\"world\")  # Jump to specific node\nstate.reset()               # Reset to root\n\n# Check navigation state\nprint(state.current_depth)   # 0 = root\nprint(state.can_drill_up)    # True if not at root\nprint(state.breadcrumbs)     # [(node_id, label), ...]\n</code></pre>"},{"location":"chart/#visual-indicators","title":"Visual Indicators","text":"<p>Drillable data points show a small white dot indicator:</p> <ul> <li>BarChart: Bottom-right corner of the bar</li> <li>PieChart: Inside the slice at 60% radius</li> <li>StackedBarChart: Bottom-right of each segment</li> <li>HeatmapChart: Left edge of the first cell in each drillable row</li> </ul>"},{"location":"chart/#example-application","title":"Example Application","text":"<pre><code>from castella import App, Column, Text\nfrom castella.core import Component, Widget\nfrom castella.frame import Frame\nfrom castella.chart import (\n    DrillDownChart, HierarchicalChartData, HierarchicalNode,\n    DataPoint, BarChart,\n)\n\n\nclass SalesDashboard(Component):\n    def __init__(self):\n        super().__init__()\n        self._data = self._create_sales_data()\n\n    def _create_sales_data(self):\n        data = HierarchicalChartData(\n            title=\"Sales by Region\",\n            root=HierarchicalNode(\n                id=\"world\",\n                label=\"World\",\n                level_name=\"Region\",\n                data=[\n                    DataPoint(category=\"Americas\", value=2500),\n                    DataPoint(category=\"EMEA\", value=1800),\n                    DataPoint(category=\"APAC\", value=2200),\n                ],\n            ),\n        )\n        # Add children for Americas\n        data.root.add_child(\"Americas\", HierarchicalNode(\n            id=\"americas\",\n            label=\"Americas\",\n            level_name=\"Country\",\n            data=[\n                DataPoint(category=\"USA\", value=1500),\n                DataPoint(category=\"Canada\", value=600),\n                DataPoint(category=\"Brazil\", value=400),\n            ],\n        ))\n        return data\n\n    def view(self) -&gt; Widget:\n        return Column(\n            Text(\"Sales Dashboard\", font_size=20).fixed_height(40),\n            DrillDownChart(\n                self._data,\n                chart_type=BarChart,\n                show_values=True,\n            ),\n        )\n\n\nApp(Frame(\"Sales Dashboard\", 800, 600), SalesDashboard()).run()\n</code></pre>"},{"location":"chart/#ascii-charts-terminal","title":"ASCII Charts (Terminal)","text":"<p>For terminal environments, Castella provides ASCII chart widgets that render using Unicode characters.</p>"},{"location":"chart/#asciibarchart","title":"ASCIIBarChart","text":"<pre><code>from castella.chart import ASCIIBarChart, ASCIIBarData\n\ndata = ASCIIBarData(\n    title=\"Quarterly Sales\",\n    labels=[\"Q1\", \"Q2\", \"Q3\", \"Q4\"],\n    values=[120, 180, 150, 200],\n)\n\nchart = ASCIIBarChart(data, width=30, show_values=True)\n</code></pre> <p>Output: <pre><code>Quarterly Sales\n\nQ1 \u2502\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588            \u2502 120.0\nQ2 \u2502\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588   \u2502 180.0\nQ3 \u2502\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c       \u2502 150.0\nQ4 \u2502\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2502 200.0\n</code></pre></p>"},{"location":"chart/#asciipiechart","title":"ASCIIPieChart","text":"<pre><code>from castella.chart import ASCIIPieChart, ASCIIPieData\n\ndata = ASCIIPieData(\n    title=\"Market Share\",\n    labels=[\"Product A\", \"Product B\", \"Others\"],\n    values=[50, 30, 20],\n)\n\nchart = ASCIIPieChart(data)\n</code></pre> <p>Output: <pre><code>Market Share\n\n\u25cf Product A \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588           50.0%\n\u25cb Product B \u2588\u2588\u2588\u2588\u2588\u2588               30.0%\n\u25d0 Others    \u2588\u2588\u2588\u2588                 20.0%\n</code></pre></p>"},{"location":"chart/#asciilinechart","title":"ASCIILineChart","text":"<pre><code>from castella.chart import ASCIILineChart\n\nchart = ASCIILineChart(\n    values=[10, 25, 15, 30, 20, 35],\n    width=40,\n    height=8,\n    title=\"Trend\",\n)\n</code></pre>"},{"location":"chart/#asciigaugechart","title":"ASCIIGaugeChart","text":"<pre><code>from castella.chart import ASCIIGaugeChart\n\nchart = ASCIIGaugeChart(\n    value=67.5,\n    max_value=100,\n    width=25,\n    title=\"CPU Usage\",\n)\n</code></pre> <p>Output: <pre><code>CPU Usage\n[\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258a        ] 67.5/100\n</code></pre></p>"},{"location":"chart/#running-in-terminal-mode","title":"Running in Terminal Mode","text":"<p>To run your app in terminal mode:</p> <pre><code>CASTELLA_IS_TERMINAL_MODE=true uv run python your_app.py\n</code></pre>"},{"location":"custom-widgets/","title":"Custom Widgets","text":"<p>You can combine built-in widgets to create a custom widget. It is defined as a subclass of Component or a subclass of Stateful Component. (You can also define custom widgets without combining existing widgets, but that's another story.)</p>"},{"location":"custom-widgets/#component","title":"Component","text":"<p>Component is a custom widget that doesn\u2019t have the state of the component as a whole.</p> <p>This is an example code for counter component.</p> <pre><code>class Counter(Component):\n    def __init__(self):\n        super().__init__()\n        self._count = State(0)\n\n    def view(self):\n        return Column(\n            Text(self._count),\n            Row(\n                Button(\"Up\", font_size=50).on_click(self.up),\n                Button(\"Down\", font_size=50).on_click(self.down),\n            ),\n        )\n\n    def up(self, _):\n        self._count += 1\n\n    def down(self, _):\n        self._count -= 1\n</code></pre> <p>This counter component has count state as an instance variable. However, it is bound only to the child text widget, not to the state of this component. Therefore, there is no need to even make it an instance variable if the encapsulation of the count state is unnecessary.</p> <p>When this state is changed, only the child text widget is re-rendered, and the entire component is not re-rendered. On the other hand, a stateful component binds specific states to components. When that state changes, the entire component is re-rendered according to the content of the view method. If you need to re-render the entire component when something changes, you should use a StatefulComponent.</p> <p>Here is an example of the counter app written without instance variables. Either way of writing is fine.</p> <pre><code>class Counter(Component):\n\u00a0 \u00a0 def view(self):\n\u00a0 \u00a0 \u00a0 \u00a0 count = State(0)\n\u00a0 \u00a0 \u00a0 \u00a0 up = lambda _: count.set(count() + 1)\n\u00a0 \u00a0 \u00a0 \u00a0 down = lambda _: count.set(count() - 1)\n\u00a0 \u00a0 \u00a0 \u00a0 return Column(\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Text(count),\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Row(\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Button(\"+\", font_size=50).on_click(up),\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Button(\"-\", font_size=50).on_click(down),\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ),\n\u00a0 \u00a0 \u00a0 \u00a0 )\n</code></pre>"},{"location":"custom-widgets/#stateful-component","title":"Stateful Component","text":"<p>Stateful Component is a custom widget that has state as the component.</p> <p>Here is an example of a numeric list component. This component is a stateful component.</p> <pre><code>class NumList(StatefulComponent):\n\u00a0 \u00a0 def __init__(self, n: State[int]):\n\u00a0 \u00a0 \u00a0 \u00a0 super().__init__(n)\n\u00a0 \u00a0 \u00a0 \u00a0 self._num: State[int] = n\n\n  \u00a0 def view(self):\n\u00a0 \u00a0 \u00a0 \u00a0 return Column(\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Button(\u201cAdd\u201d).fixed_height(40).on_click(lambda _: self.num.set(self._num() + 1)),\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0*(Text(i + 1).fixed_height(40) for i in range(self._num())),\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0scrollable=True,\n\u00a0 \u00a0 \u00a0 \u00a0 )\n\nApp(Frame(\"NumList\"), NumList(State(1))).run()\n</code></pre> <p>This component adds a new text with number when the Add button is clicked. It has an underscore num instance variable as state. It must also be passed to the constructor of the state component class. In this way, the view of the entire NumList is updated when the value of <code>_num</code> instance variable is updated. In other words, it\u2019s like that the entire view method is reexecuted on updating the state of component.</p>"},{"location":"environment/","title":"Environment Variables","text":"<p>Castella can be configured using environment variables for platform selection, appearance, and locale settings.</p>"},{"location":"environment/#platform-selection","title":"Platform Selection","text":""},{"location":"environment/#castella_frame","title":"CASTELLA_FRAME","text":"<p>Select the desktop frame backend.</p> Value Description <code>glfw</code> Use GLFW backend <code>sdl</code> Use SDL2 backend <code>sdl3</code> Use SDL3 backend <code>tui</code> Use terminal UI mode <code>auto</code> Auto-detect (default): GLFW \u2192 SDL3 \u2192 SDL2 \u2192 TUI <pre><code># Use SDL3 backend\nCASTELLA_FRAME=sdl3 uv run python examples/counter.py\n\n# Use GLFW backend\nCASTELLA_FRAME=glfw uv run python examples/counter.py\n</code></pre>"},{"location":"environment/#castella_is_terminal_mode","title":"CASTELLA_IS_TERMINAL_MODE","text":"<p>Force terminal UI mode (using prompt-toolkit) instead of graphical mode. (Deprecated: use <code>CASTELLA_FRAME=tui</code> instead)</p> Value Description <code>true</code> Force terminal mode (unset) Auto-detect based on environment <pre><code>CASTELLA_IS_TERMINAL_MODE=true uv run python examples/counter.py\n</code></pre>"},{"location":"environment/#appearance","title":"Appearance","text":""},{"location":"environment/#castella_dark_mode","title":"CASTELLA_DARK_MODE","text":"<p>Force dark or light mode, overriding system detection.</p> Value Description <code>true</code> Force dark mode <code>false</code> Force light mode (unset) Auto-detect from system (default) <pre><code># Force dark mode\nCASTELLA_DARK_MODE=true uv run python examples/counter.py\n\n# Force light mode\nCASTELLA_DARK_MODE=false uv run python examples/counter.py\n</code></pre>"},{"location":"environment/#castella_font_size","title":"CASTELLA_FONT_SIZE","text":"<p>Override the default base font size.</p> Value Description Integer Font size in points (e.g., <code>14</code>, <code>16</code>) (unset) Use theme default <pre><code>CASTELLA_FONT_SIZE=16 uv run python examples/counter.py\n</code></pre>"},{"location":"environment/#internationalization","title":"Internationalization","text":""},{"location":"environment/#castella_locale","title":"CASTELLA_LOCALE","text":"<p>Force a specific locale, overriding system detection.</p> Value Description <code>en</code> English <code>ja</code> Japanese <code>zh</code> Chinese <code>fr</code> French <code>de</code> German <code>ru</code> Russian (unset) Auto-detect from system <pre><code>CASTELLA_LOCALE=ja uv run python examples/i18n_demo.py\n</code></pre>"},{"location":"environment/#platform-specific","title":"Platform-Specific","text":""},{"location":"environment/#pysdl2_dll_path-windows","title":"PYSDL2_DLL_PATH (Windows)","text":"<p>Path to SDL2 DLL files on Windows when using the SDL2 backend.</p> <pre><code># Windows PowerShell\n$env:PYSDL2_DLL_PATH = \"C:\\SDL2\\lib\\x64\"\npython examples/counter.py\n</code></pre>"},{"location":"environment/#castella_ios_deps","title":"CASTELLA_IOS_DEPS","text":"<p>Base directory for iOS pre-built dependencies (pydantic-core, castella-skia).</p> Value Description Path Directory containing iOS dependencies (unset) Defaults to <code>~/castella-ios-deps</code> <pre><code>CASTELLA_IOS_DEPS=/path/to/deps ./tools/build_ios.sh examples/ios_test_app\n</code></pre>"},{"location":"environment/#examples","title":"Examples","text":""},{"location":"environment/#development-setup","title":"Development Setup","text":"<pre><code># Dark mode with larger fonts\nexport CASTELLA_DARK_MODE=true\nexport CASTELLA_FONT_SIZE=16\nuv run python examples/counter.py\n</code></pre>"},{"location":"environment/#testing-different-backends","title":"Testing Different Backends","text":"<pre><code># SDL3 backend\nCASTELLA_FRAME=sdl3 uv run python examples/counter.py\n\n# SDL2 backend\nCASTELLA_FRAME=sdl uv run python examples/counter.py\n\n# GLFW backend\nCASTELLA_FRAME=glfw uv run python examples/counter.py\n\n# Terminal mode\nCASTELLA_FRAME=tui uv run python examples/counter.py\n</code></pre>"},{"location":"environment/#internationalization-testing","title":"Internationalization Testing","text":"<pre><code># Test Japanese locale\nCASTELLA_LOCALE=ja uv run python examples/i18n_demo.py\n\n# Test with Japanese locale and dark mode\nCASTELLA_LOCALE=ja CASTELLA_DARK_MODE=true uv run python examples/i18n_demo.py\n</code></pre>"},{"location":"environment/#see-also","title":"See Also","text":"<ul> <li>castella-skia - Rust Skia backend details</li> <li>Internationalization - I18n system documentation</li> <li>iOS - iOS platform configuration</li> </ul>"},{"location":"getting-started/","title":"Installation","text":""},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Castella requires Python &gt;= <code>3.11</code>.</p> <p>We recommend using uv for package management. uv is a fast Python package manager that simplifies dependency management.</p>"},{"location":"getting-started/#installing-uv","title":"Installing uv","text":"<p>If you don't have uv installed:</p> <pre><code># macOS / Linux\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Windows (PowerShell)\npowershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre>"},{"location":"getting-started/#for-desktop","title":"For Desktop","text":"<p>Castella for Desktop supports three backends: GLFW, SDL2, and SDL3. The recommended choice depends on your platform:</p> Platform Easy Setup Better Performance Windows <code>castella[sdl3]</code> or <code>castella[sdl]</code> <code>castella[glfw]</code> (requires GLFW install) Linux <code>castella[sdl3]</code> or <code>castella[sdl]</code> <code>castella[glfw]</code> (requires <code>apt install libglfw3-dev</code>) macOS All backends work without extra install <code>castella[glfw]</code> <p>All backends support IME (Japanese/Chinese/Korean input) on all platforms. On macOS, GLFW provides better IME integration via native Cocoa APIs.</p>"},{"location":"getting-started/#quick-start-with-uv","title":"Quick Start with uv","text":"<pre><code># Create a new project\nuv init my-castella-app\ncd my-castella-app\n\n# Add Castella (choose your backend)\nuv add \"castella[sdl3]\"  # For easy setup (all platforms, no extra install)\nuv add \"castella[sdl]\"   # For easy setup (SDL2 stable alternative)\nuv add \"castella[glfw]\"  # For better performance\n\n# Run your app\nuv run python your_app.py\n</code></pre>"},{"location":"getting-started/#using-glfw-backend","title":"Using GLFW Backend","text":""},{"location":"getting-started/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>uv add \"castella[glfw]\"\n</code></pre>"},{"location":"getting-started/#install-from-github-latest-source","title":"Install from GitHub (latest source)","text":"<pre><code>uv add \"castella[glfw] @ git+https://github.com/i2y/castella.git\"\n</code></pre>"},{"location":"getting-started/#development-from-source","title":"Development from Source","text":"<pre><code>git clone https://github.com/i2y/castella.git\ncd castella\nuv sync --extra glfw\nuv run python examples/counter.py\n</code></pre>"},{"location":"getting-started/#additional-glfw-installation-if-needed","title":"Additional GLFW Installation (if needed)","text":"<p>The GLFW shared library is typically installed automatically. If you encounter GLFW-related errors, you can install it manually:</p> <p>macOS: <pre><code>brew install glfw3\n</code></pre></p> <p>Linux (Debian/Ubuntu): <pre><code>sudo apt-get install -y libglfw3-dev\n</code></pre></p> <p>Linux (RHEL/CentOS): <pre><code>sudo yum install -y libglfw3-dev\n</code></pre></p> <p>Windows: Download from GLFW download page.</p>"},{"location":"getting-started/#using-sdl2-backend","title":"Using SDL2 Backend","text":"<p>The SDL2 backend includes all necessary binaries via the <code>pysdl2-dll</code> package. No additional installation is required on Windows, Linux, or macOS.</p>"},{"location":"getting-started/#install-from-pypi_1","title":"Install from PyPI","text":"<pre><code>uv add \"castella[sdl]\"\n</code></pre> <p>This automatically installs:</p> <ul> <li><code>pysdl2-dll</code> - Pre-built SDL2 binaries for Windows, Linux (x86_64, ARM64), and macOS</li> <li><code>castella-skia</code> - Pre-built Skia rendering engine for all platforms</li> <li><code>PySDL2</code> - Python bindings for SDL2</li> <li><code>PyOpenGL</code> - OpenGL bindings</li> </ul>"},{"location":"getting-started/#install-from-github-latest-source_1","title":"Install from GitHub (latest source)","text":"<pre><code>uv add \"castella[sdl] @ git+https://github.com/i2y/castella.git\"\n</code></pre>"},{"location":"getting-started/#development-from-source_1","title":"Development from Source","text":"<pre><code>git clone https://github.com/i2y/castella.git\ncd castella\nuv sync --extra sdl\nuv run python examples/counter.py\n</code></pre>"},{"location":"getting-started/#using-custom-sdl2-advanced","title":"Using Custom SDL2 (Advanced)","text":"<p>By default, the bundled SDL2 from <code>pysdl2-dll</code> is used automatically. If you need to use a custom SDL2 installation:</p> <pre><code># Use system SDL2 instead of bundled\nexport PYSDL2_DLL_PATH=system\n\n# Or specify a custom path\nexport PYSDL2_DLL_PATH=/path/to/sdl2/lib\n</code></pre> <p>For more details, see PySDL2 integration guide.</p>"},{"location":"getting-started/#using-sdl3-backend","title":"Using SDL3 Backend","text":"<p>The SDL3 backend uses PySDL3, the official Python bindings for SDL3. No additional installation is required - SDL3 binaries are automatically downloaded on first run.</p>"},{"location":"getting-started/#install-from-pypi_2","title":"Install from PyPI","text":"<pre><code>uv add \"castella[sdl3]\"\n</code></pre> <p>This automatically installs:</p> <ul> <li><code>PySDL3</code> - Python bindings for SDL3 (auto-downloads SDL3 binaries)</li> <li><code>castella-skia</code> - Pre-built Skia rendering engine for all platforms</li> <li><code>PyOpenGL</code> - OpenGL bindings</li> </ul>"},{"location":"getting-started/#install-from-github-latest-source_2","title":"Install from GitHub (latest source)","text":"<pre><code>uv add \"castella[sdl3] @ git+https://github.com/i2y/castella.git\"\n</code></pre>"},{"location":"getting-started/#development-from-source_2","title":"Development from Source","text":"<pre><code>git clone https://github.com/i2y/castella.git\ncd castella\nuv sync --extra sdl3\nuv run python examples/counter.py\n</code></pre>"},{"location":"getting-started/#alternative-using-pip","title":"Alternative: Using pip","text":"<p>If you prefer traditional pip:</p> <pre><code># With GLFW\npip install castella[glfw]\n\n# With SDL2\npip install castella[sdl]\n\n# With SDL3\npip install castella[sdl3]\n\n# From GitHub\npip install \"git+https://github.com/i2y/castella.git#egg=castella[glfw]\"\n</code></pre>"},{"location":"getting-started/#verify-installation","title":"Verify Installation","text":"<p>If installation was successful, the examples should work:</p> <pre><code># With uv\nuv run python examples/hello_world.py\n\n# With pip\npython examples/hello_world.py\n</code></pre> <p>See the examples folder for more sample applications.</p>"},{"location":"getting-started/#for-web-browsers","title":"For Web Browsers","text":"<p>Here we explain how to use Castella in a PyScript app.</p> <p>For more information on PyScript, see the official documentation.</p> <p>To use Castella on an HTML page:</p> <ul> <li>Load the PyScript JS file and CanvasKit JS file</li> <li>Specify Castella modules in the PyScript config file (<code>pyscript.toml</code>)</li> <li>Serve the HTML page with any web server</li> </ul>"},{"location":"getting-started/#example-setup","title":"Example Setup","text":""},{"location":"getting-started/#1-create-your-app-folder","title":"1. Create your app folder","text":"<pre><code>mkdir counter\ncd counter\n</code></pre>"},{"location":"getting-started/#2-create-your-app-files","title":"2. Create your app files","text":"<p>Create <code>counter.html</code>:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;title&gt;Counter&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://pyscript.net/releases/2025.11.2/core.css\"&gt;\n    &lt;script type=\"text/javascript\" src=\"https://unpkg.com/canvaskit-wasm@0.39.1/bin/canvaskit.js\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\"&gt;\n        const loadFont = fetch('https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxP.ttf')\n            .then((response) =&gt; response.arrayBuffer());\n\n        const ckLoaded = CanvasKitInit();\n        Promise.all([ckLoaded, loadFont]).then(([CanvasKit, robotoData]) =&gt; {\n            window.CK = CanvasKit;\n            window.fontMgr = CanvasKit.FontMgr.FromData([robotoData]);\n            window.typeface = CanvasKit.Typeface.MakeFreeTypeFaceFromData(robotoData);\n            // Load PyScript after CanvasKit is ready\n            const script = document.createElement('script');\n            script.type = 'module';\n            script.src = 'https://pyscript.net/releases/2025.11.2/core.js';\n            document.head.appendChild(script);\n        });\n    &lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;script type=\"py\" src=\"counter.py\" config=\"pyscript.toml\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Create <code>pyscript.toml</code>:</p> <pre><code>packages = [ \"pydantic\", \"castella\" ]\n</code></pre> <p>Create <code>counter.py</code>:</p> <pre><code>from castella import App, Button, Column, Component, Row, State, Text\nfrom castella.frame import Frame\n\n\nclass Counter(Component):\n    def __init__(self):\n        super().__init__()\n        self._count = State(0)\n\n    def view(self):\n        return Column(\n            Text(self._count),\n            Row(\n                Button(\"Up\", font_size=50).on_click(self.up),\n                Button(\"Down\", font_size=50).on_click(self.down),\n            ),\n        )\n\n    def up(self, _):\n        self._count += 1\n\n    def down(self, _):\n        self._count -= 1\n\n\nif __name__ == \"__main__\":\n    App(Frame(\"Counter\", 800, 600), Counter()).run()\n</code></pre>"},{"location":"getting-started/#3-serve-your-app","title":"3. Serve your app","text":"<pre><code># With uv\nuv run python -m http.server 3000\n\n# With Python directly\npython -m http.server 3000\n</code></pre> <p>Open http://127.0.0.1:3000/counter.html in your browser.</p> <p>The above counter app is embedded in an iframe.</p>"},{"location":"getting-started/#for-terminals","title":"For Terminals","text":""},{"location":"getting-started/#install-with-uv","title":"Install with uv","text":"<pre><code>uv add \"castella[tui]\"\n</code></pre>"},{"location":"getting-started/#alternative-using-pip_1","title":"Alternative: Using pip","text":"<pre><code>pip install castella[tui]\n</code></pre>"},{"location":"getting-started/#running-in-terminal-mode","title":"Running in Terminal Mode","text":"<p>If you have other platform-specific packages installed, set the environment variable:</p> <pre><code># macOS / Linux\nCASTELLA_IS_TERMINAL_MODE=true uv run python your_script.py\n\n# Windows (PowerShell)\n$env:CASTELLA_IS_TERMINAL_MODE=\"true\"; uv run python your_script.py\n</code></pre> <p>If you only have the TUI package installed, terminal mode is enabled automatically.</p>"},{"location":"getting-started/#optional-features","title":"Optional Features","text":"<p>Castella provides several optional extras for additional functionality:</p>"},{"location":"getting-started/#ai-agent-support","title":"AI Agent Support","text":"<p>For A2A (Agent-to-Agent) and A2UI (Agent-to-User Interface) protocols:</p> <pre><code>uv add \"castella[agent,glfw]\"\n</code></pre> <p>See the Agent UI documentation for details.</p>"},{"location":"getting-started/#mcp-model-context-protocol-support","title":"MCP (Model Context Protocol) Support","text":"<p>For AI agents to introspect and control UIs programmatically:</p> <pre><code>uv add \"castella[mcp,glfw]\"\n</code></pre> <p>See the MCP documentation for details.</p>"},{"location":"getting-started/#combined-installation","title":"Combined Installation","text":"<p>You can combine multiple extras:</p> <pre><code># Desktop with agent and MCP support\nuv add \"castella[glfw,agent,mcp]\"\n</code></pre>"},{"location":"hello-world/","title":"Hello World","text":""},{"location":"hello-world/#example-1","title":"Example 1","text":"<p>Here you will create a UI that just displays \"Hello World!\". For that, you need to use App, Frame and Text.</p> <ul> <li>App: Class that has the execution loop of an application</li> <li>Frame: Class representing the frame of the application window</li> <li>Text: Single-line text widget</li> </ul> <p>The code is as follows.</p> <pre><code>from castella import App, Text\nfrom castella.frame import Frame\n\nApp(Frame(\"Hello world\", 480, 300),\u3000  # (1)\n    Text(\"Hello World!\")).run()\u3000  # (2)\n</code></pre> <ol> <li>Set the title of the Frame=Window of this app to \"Hello world\" and the size to 480 wide and 300 high.</li> <li>Initialize App by passing a Frame instance and a top-level widget (in this case, Text) to App constructor as a top-level widget, then call the run method; to run the App, you must finally call run after setting up the screen and event handlers.</li> </ol> <p>You will see a screen similar to the one below with executing this.</p> <p>This is an screen shot of the result of running the above in dark mode.</p> <p>In Castella, each widgets are automatically scaled to fit the size of the parent (in this case, the frame) by default. Also, actual text inside of Text widget is rendered scaled to fit the size of the Text widget by default and is aligned to the center by default.</p>"},{"location":"hello-world/#example-2","title":"Example 2","text":"<p>This is an example of fixing the font size to a specified size, regardless of the size of the Text widget and Frame.</p> <pre><code>App(Frame(\"Hello world\", 480, 300),\n    Text(\"Hello World!\", font_size=20)).run()\n</code></pre> <p>In addition, here is an example that the alignment of the actual text is left side. You can specify that with <code>align=TextAlign.LEFT</code>.</p> <pre><code>App(Frame(\"Hello world\", 480, 300),\n    Text(\"Hello World!\", font_size=20, align=TextAlign.LEFT)).run()\n</code></pre> <p><code>TextAlign.RIGHT</code> can also be specified.</p>"},{"location":"hello-world/#example-3","title":"Example 3","text":"<p>This example makes a text widget itself a fixed size.</p> <pre><code>App(Frame(\"Hello world\", 480, 300),\n    Text(\"Hello World!\").fixed_size(100, 200)).run()\n</code></pre> <p>The next chapter describes Layout.</p>"},{"location":"hot-reloading/","title":"Hot Reloading","text":"<p>Experimental Feature</p> <p>Hot reloading is an experimental feature with limited support. For reliable development workflows, use Hot Restarting instead.</p>"},{"location":"hot-reloading/#overview","title":"Overview","text":"<p>Hot reloading updates running code without restarting the application, preserving application state. This provides faster iteration than hot restarting since only changed modules are reloaded.</p>"},{"location":"hot-reloading/#current-status","title":"Current Status","text":"<p>Hot reloading in Castella is currently limited due to the complexity of:</p> <ul> <li>Preserving widget tree state across reloads</li> <li>Updating event handlers that reference old class instances</li> <li>Managing component lifecycle during reload</li> </ul> <p>For most development workflows, Hot Restarting is recommended.</p>"},{"location":"hot-reloading/#web-development","title":"Web Development","text":"<p>For web applications using PyScript/Pyodide, you can use your browser's built-in development tools:</p> <ol> <li>Use your development server's live reload feature</li> <li>The browser will refresh when files change</li> <li>This is effectively hot restarting at the browser level</li> </ol>"},{"location":"hot-reloading/#alternatives","title":"Alternatives","text":""},{"location":"hot-reloading/#hot-restarting-recommended","title":"Hot Restarting (Recommended)","text":"<p>Use the hot restarter for reliable code updates:</p> <pre><code>uv run python tools/hot_restarter.py your_app.py\n</code></pre> <p>See Hot Restarting for details.</p>"},{"location":"hot-reloading/#manual-reload","title":"Manual Reload","text":"<p>For quick experiments, you can manually restart your application after making changes.</p>"},{"location":"hot-reloading/#future-plans","title":"Future Plans","text":"<p>Full hot reloading support for Component classes is planned for future releases. This would allow:</p> <ul> <li>Updating <code>view()</code> methods without restart</li> <li>Preserving <code>State</code> values across reloads</li> <li>Live style and layout adjustments</li> </ul>"},{"location":"hot-reloading/#technical-challenges","title":"Technical Challenges","text":"<p>Implementing hot reloading in a GUI framework requires solving:</p> <ol> <li> <p>Class identity: When a module is reloaded, classes are recreated with new identities. Existing instances still reference old classes.</p> </li> <li> <p>Event handlers: Lambda functions and method references capture the original class/instance.</p> </li> <li> <p>State preservation: Transferring state from old instances to new instances requires careful introspection.</p> </li> <li> <p>Widget tree: The component hierarchy must be updated while maintaining parent-child relationships.</p> </li> </ol> <p>These challenges make hot restarting the more practical choice for most development scenarios.</p>"},{"location":"hot-restarting/","title":"Hot Restarting","text":"<p>Hot restarting automatically restarts your Castella application whenever source files change, enabling rapid development iteration.</p>"},{"location":"hot-restarting/#usage","title":"Usage","text":"<p>Use the <code>hot_restarter.py</code> tool from the <code>tools/</code> directory:</p> <pre><code># With uv (recommended)\nuv run python tools/hot_restarter.py your_app.py\n\n# With regular Python\npython tools/hot_restarter.py examples/counter.py\n</code></pre>"},{"location":"hot-restarting/#how-it-works","title":"How It Works","text":"<ol> <li>The tool starts your application as a subprocess</li> <li>It watches all <code>.py</code> files in the current directory (recursively)</li> <li>When any <code>.py</code> file is modified:</li> <li>The current application process is killed</li> <li>A new instance is started immediately</li> <li>If the application crashes, it automatically restarts</li> </ol>"},{"location":"hot-restarting/#requirements","title":"Requirements","text":"<p>The hot restarter requires the <code>watchdog</code> library:</p> <pre><code># With uv (recommended)\nuv add watchdog\n\n# With pip\npip install watchdog\n</code></pre> <p>This is included in the development dependencies:</p> <pre><code># With uv\nuv sync --extra dev\n\n# With pip\npip install -e \".[dev]\"\n</code></pre>"},{"location":"hot-restarting/#example-workflow","title":"Example Workflow","text":"<ol> <li> <p>Start your app with hot restarting:    <pre><code>uv run python tools/hot_restarter.py examples/counter.py\n</code></pre></p> </li> <li> <p>Edit your code in your editor</p> </li> <li> <p>Save the file - the app automatically restarts with your changes</p> </li> <li> <p>Press <code>Ctrl+C</code> to stop the watcher and application</p> </li> </ol>"},{"location":"hot-restarting/#behavior-details","title":"Behavior Details","text":""},{"location":"hot-restarting/#watched-files","title":"Watched Files","text":"<ul> <li>All <code>.py</code> files in the current directory and subdirectories</li> <li>Changes to any Python file trigger a restart</li> </ul>"},{"location":"hot-restarting/#restart-triggers","title":"Restart Triggers","text":"<ul> <li>File modifications (saving a file)</li> <li>The previous process crashing or exiting</li> </ul>"},{"location":"hot-restarting/#process-management","title":"Process Management","text":"<ul> <li>Only one instance runs at a time</li> <li>The previous instance is killed before starting a new one</li> <li>Clean shutdown on <code>Ctrl+C</code></li> </ul>"},{"location":"hot-restarting/#limitations","title":"Limitations","text":"<ul> <li>Full restart: The entire application restarts, not just the modified module</li> <li>State loss: All application state is lost on restart</li> <li>Window position: Window position may reset on restart</li> <li>Startup time: Each restart incurs full application startup time</li> </ul>"},{"location":"hot-restarting/#tips","title":"Tips","text":"<ol> <li> <p>Keep initialization fast: Since the app restarts completely, fast startup improves your iteration speed</p> </li> <li> <p>Use for UI development: Hot restarting is ideal for tweaking layouts, styles, and widget properties</p> </li> <li> <p>Combine with logging: Add print statements or logging to debug issues between restarts</p> </li> </ol>"},{"location":"hot-restarting/#comparison-with-hot-reloading","title":"Comparison with Hot Reloading","text":"Feature Hot Restarting Hot Reloading State preserved No Yes Startup time Full restart Incremental Reliability High Experimental Implementation Simple subprocess Complex module reload <p>For most development workflows, hot restarting provides a reliable and predictable experience.</p>"},{"location":"i18n/","title":"Internationalization (i18n)","text":"<p>Castella provides a built-in internationalization system for multi-language support with runtime locale switching.</p>"},{"location":"i18n/#overview","title":"Overview","text":"<p>The i18n system consists of:</p> <ul> <li>I18nManager - Singleton manager for translations and locale switching</li> <li>LocaleString - Reactive string that auto-updates UI when locale changes</li> <li>t() / tn() - Convenience functions for translation</li> <li>Loaders - Load translations from YAML or JSON files</li> </ul>"},{"location":"i18n/#basic-usage","title":"Basic Usage","text":"<pre><code>from castella.i18n import I18nManager, load_yaml_catalog\n\n# Get the singleton manager\nmanager = I18nManager()\n\n# Load translation catalogs\nmanager.load_catalog(\"en\", load_yaml_catalog(\"locales/en.yaml\"))\nmanager.load_catalog(\"ja\", load_yaml_catalog(\"locales/ja.yaml\"))\n\n# Set the active locale\nmanager.set_locale(\"en\")\n\n# Translate a key\ntext = manager.t(\"greeting\")  # \"Hello!\"\n\n# With string interpolation\ntext = manager.t(\"welcome\", name=\"World\")  # \"Hello, World!\"\n</code></pre>"},{"location":"i18n/#i18nmanager-methods","title":"I18nManager Methods","text":"Method Description <code>load_catalog(locale, catalog)</code> Load a translation catalog for a locale <code>set_locale(locale)</code> Set the active locale <code>set_fallback_locale(locale)</code> Set fallback locale for missing translations <code>t(key, **kwargs)</code> Translate a key with optional interpolation <code>tn(key, count, **kwargs)</code> Translate with pluralization <code>locale</code> Property: current locale <code>available_locales</code> Property: list of loaded locales"},{"location":"i18n/#loading-translations","title":"Loading Translations","text":""},{"location":"i18n/#from-yaml-files","title":"From YAML Files","text":"<pre><code>from castella.i18n import load_yaml_catalog\n\ncatalog = load_yaml_catalog(\"locales/en.yaml\")\nmanager.load_catalog(\"en\", catalog)\n</code></pre>"},{"location":"i18n/#from-json-files","title":"From JSON Files","text":"<pre><code>from castella.i18n import load_json_catalog\n\ncatalog = load_json_catalog(\"locales/en.json\")\nmanager.load_catalog(\"en\", catalog)\n</code></pre>"},{"location":"i18n/#from-a-directory","title":"From a Directory","text":"<pre><code>from castella.i18n import load_catalogs_from_directory\n\n# Load all .yaml and .json files from a directory\ncatalogs = load_catalogs_from_directory(\"locales/\")\nfor locale, catalog in catalogs.items():\n    manager.load_catalog(locale, catalog)\n</code></pre>"},{"location":"i18n/#programmatically","title":"Programmatically","text":"<pre><code>from castella.i18n import create_catalog_from_dict\n\ncatalog = create_catalog_from_dict(\"en\", {\n    \"greeting\": \"Hello!\",\n    \"button\": {\n        \"save\": \"Save\",\n        \"cancel\": \"Cancel\",\n    },\n})\nmanager.load_catalog(\"en\", catalog)\n</code></pre>"},{"location":"i18n/#localestring-reactive","title":"LocaleString (Reactive)","text":"<p><code>LocaleString</code> automatically updates the UI when the locale changes. Use it with widgets for reactive translations.</p> <pre><code>from castella import Text\nfrom castella.i18n import LocaleString\n\n# UI automatically updates when locale changes\nText(LocaleString(\"dashboard.title\"))\n\n# With interpolation\nText(LocaleString(\"greeting\", name=\"World\"))\n</code></pre>"},{"location":"i18n/#how-it-works","title":"How It Works","text":"<ol> <li><code>LocaleString</code> observes the <code>I18nManager</code> for locale changes</li> <li>When locale changes, <code>LocaleString</code> notifies attached widgets</li> <li>Widgets re-render with the new translation</li> </ol>"},{"location":"i18n/#comparison-t-vs-localestring","title":"Comparison: t() vs LocaleString","text":"Use Case Function Static translation (one-time) <code>t(\"key\")</code> Reactive translation (auto-update UI) <code>LocaleString(\"key\")</code> <pre><code># Static - won't update when locale changes\nlabel = t(\"greeting\")\n\n# Reactive - updates automatically\nText(LocaleString(\"greeting\"))\n</code></pre>"},{"location":"i18n/#pluralization","title":"Pluralization","text":"<p>Handle pluralized strings that vary based on count.</p>"},{"location":"i18n/#using-tn","title":"Using tn()","text":"<pre><code>from castella.i18n import tn\n\n# Returns \"1 item\" or \"5 items\" based on count and locale\ntext = tn(\"items\", count=1)  # \"1 item\"\ntext = tn(\"items\", count=5)  # \"5 items\"\n</code></pre>"},{"location":"i18n/#using-localepluralstring","title":"Using LocalePluralString","text":"<pre><code>from castella import Text\nfrom castella.i18n import LocalePluralString\n\n# Reactive pluralized string\nText(LocalePluralString(\"items\", count=5))\n</code></pre>"},{"location":"i18n/#defining-plural-forms-in-yaml","title":"Defining Plural Forms in YAML","text":"<pre><code># locales/en.yaml\nlocale: en\nitems:\n  one: \"{count} item\"\n  other: \"{count} items\"\n</code></pre> <pre><code># locales/ja.yaml\nlocale: ja\nitems:\n  other: \"{count}\u500b\u306e\u30a2\u30a4\u30c6\u30e0\"  # Japanese doesn't distinguish singular/plural\n</code></pre>"},{"location":"i18n/#supported-plural-categories","title":"Supported Plural Categories","text":"<p>Castella follows CLDR plural rules:</p> Category Description Example Languages <code>zero</code> Zero quantity Arabic <code>one</code> Singular English, German, French <code>two</code> Dual Arabic, Welsh <code>few</code> Few Russian, Polish <code>many</code> Many Russian, Polish <code>other</code> Default/Plural All languages <p>Built-in rules for: English, Japanese, Chinese, French, German, Russian.</p>"},{"location":"i18n/#translation-file-format","title":"Translation File Format","text":""},{"location":"i18n/#yaml-format","title":"YAML Format","text":"<pre><code># locales/en.yaml\nlocale: en\n\n# Simple strings\ngreeting: \"Hello!\"\nfarewell: \"Goodbye!\"\n\n# Nested keys (accessed as \"button.save\")\nbutton:\n  save: \"Save\"\n  cancel: \"Cancel\"\n  delete: \"Delete\"\n\n# String interpolation\nwelcome: \"Welcome, {name}!\"\n\n# Plural forms\nitems:\n  one: \"{count} item\"\n  other: \"{count} items\"\n\nnotifications:\n  one: \"You have {count} notification\"\n  other: \"You have {count} notifications\"\n</code></pre>"},{"location":"i18n/#json-format","title":"JSON Format","text":"<pre><code>{\n  \"locale\": \"en\",\n  \"greeting\": \"Hello!\",\n  \"button\": {\n    \"save\": \"Save\",\n    \"cancel\": \"Cancel\"\n  },\n  \"welcome\": \"Welcome, {name}!\",\n  \"items\": {\n    \"one\": \"{count} item\",\n    \"other\": \"{count} items\"\n  }\n}\n</code></pre>"},{"location":"i18n/#accessing-nested-keys","title":"Accessing Nested Keys","text":"<p>Use dot notation to access nested translations:</p> <pre><code>manager.t(\"button.save\")        # \"Save\"\nmanager.t(\"button.cancel\")      # \"Cancel\"\n</code></pre>"},{"location":"i18n/#system-locale-detection","title":"System Locale Detection","text":"<p><code>I18nManager</code> can auto-detect the system locale:</p> <ol> <li><code>CASTELLA_LOCALE</code> environment variable (highest priority)</li> <li>System locale (<code>LC_ALL</code>, <code>LANG</code>)</li> <li>Default: <code>\"en\"</code></li> </ol> <pre><code># Force Japanese locale\nexport CASTELLA_LOCALE=ja\n</code></pre>"},{"location":"i18n/#complete-example","title":"Complete Example","text":"<pre><code>from castella import App, Button, Column, Component, Row, Text\nfrom castella.frame import Frame\nfrom castella.i18n import I18nManager, LocaleString, load_yaml_catalog\n\n\nclass I18nDemo(Component):\n    def __init__(self):\n        super().__init__()\n        self._manager = I18nManager()\n\n        # Load translations\n        self._manager.load_catalog(\"en\", load_yaml_catalog(\"locales/en.yaml\"))\n        self._manager.load_catalog(\"ja\", load_yaml_catalog(\"locales/ja.yaml\"))\n        self._manager.set_locale(\"en\")\n\n    def view(self):\n        return Column(\n            # Reactive translation - auto-updates on locale change\n            Text(LocaleString(\"greeting\")),\n            Text(LocaleString(\"welcome\", name=\"Castella\")),\n\n            Row(\n                Button(LocaleString(\"button.save\")).on_click(self._save),\n                Button(LocaleString(\"button.cancel\")),\n            ),\n\n            # Language switcher\n            Row(\n                Button(\"English\").on_click(lambda _: self._manager.set_locale(\"en\")),\n                Button(\"\u65e5\u672c\u8a9e\").on_click(lambda _: self._manager.set_locale(\"ja\")),\n            ),\n        )\n\n    def _save(self, _):\n        print(\"Saved!\")\n\n\nApp(Frame(\"I18n Demo\", 500, 300), I18nDemo()).run()\n</code></pre> <p>locales/en.yaml: <pre><code>locale: en\ngreeting: \"Hello!\"\nwelcome: \"Welcome, {name}!\"\nbutton:\n  save: \"Save\"\n  cancel: \"Cancel\"\n</code></pre></p> <p>locales/ja.yaml: <pre><code>locale: ja\ngreeting: \"\u3053\u3093\u306b\u3061\u306f\uff01\"\nwelcome: \"\u3088\u3046\u3053\u305d\u3001{name}\u3055\u3093\uff01\"\nbutton:\n  save: \"\u4fdd\u5b58\"\n  cancel: \"\u30ad\u30e3\u30f3\u30bb\u30eb\"\n</code></pre></p>"},{"location":"ios/","title":"iOS Support","text":"<p>Castella runs on iOS with full widget support, including charts, data tables, and keyboard/IME input.</p> <p>Work in Progress</p> <p>iOS support is functional on the Simulator. Physical device deployment and Android support are planned.</p>"},{"location":"ios/#overview","title":"Overview","text":"<ul> <li>Rendering: castella-skia with Metal backend</li> <li>Packaging: BeeWare Briefcase</li> <li>Python Runtime: Python XCFramework via Briefcase</li> <li>Targets: iOS Simulator (arm64), iOS Device (arm64)</li> </ul>"},{"location":"ios/#quick-start","title":"Quick Start","text":"<pre><code># Build and run the all-widgets demo on iOS Simulator\n./tools/build_ios.sh examples/ios_all_widgets_demo\n\n# Or with auto-download of dependencies\nAUTO_DOWNLOAD_DEPS=1 ./tools/build_ios.sh examples/ios_all_widgets_demo\n</code></pre>"},{"location":"ios/#demo-apps","title":"Demo Apps","text":"<p>Three demo apps showcase Castella's iOS capabilities:</p> App Location Features Counter <code>examples/ios_test_app/</code> Basic Counter with increment/decrement buttons Charts <code>examples/ios_charts_demo/</code> BarChart, LineChart, PieChart, GaugeChart All Widgets <code>examples/ios_all_widgets_demo/</code> Full widget showcase with 6 tabs"},{"location":"ios/#all-widgets-demo","title":"All Widgets Demo","text":"<p>The most comprehensive demo includes:</p> <ul> <li>Basic Tab: Text, Button, Switch, Slider</li> <li>Input Tab: Input, MultilineInput with keyboard/IME</li> <li>Layout Tab: Column, Row, Box layouts</li> <li>Data Tab: DataTable, Tree</li> <li>Media Tab: NetImage, Modal</li> <li>Charts Tab: All chart types</li> <li>Theme Toggle: Dark/Light mode switching</li> </ul>"},{"location":"ios/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Castella App (Python via Rubicon-ObjC)             \u2502\n\u2502  \u251c\u2500\u2500 PythonAppDelegate                              \u2502\n\u2502  \u251c\u2500\u2500 UIWindow + UIViewController                    \u2502\n\u2502  \u2514\u2500\u2500 UIImageView for display                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  castella-skia (Rust + PyO3)                        \u2502\n\u2502  \u251c\u2500\u2500 Surface::from_metal(device, queue, w, h)       \u2502\n\u2502  \u251c\u2500\u2500 SkiaPainter for drawing                        \u2502\n\u2502  \u2514\u2500\u2500 get_rgba_data() for pixel extraction           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  CoreGraphics (via ctypes)                          \u2502\n\u2502  \u251c\u2500\u2500 CGDataProvider \u2192 CGImage \u2192 UIImage             \u2502\n\u2502  \u2514\u2500\u2500 Display in UIImageView                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ios/#key-components","title":"Key Components","text":"<ul> <li>iOSFrame (<code>castella/ios_frame.py</code>): iOS-specific frame implementation</li> <li>castella-skia: Rust Skia bindings with Metal backend</li> <li>Rubicon-ObjC: Python-to-Objective-C bridge for UIKit access</li> </ul>"},{"location":"ios/#touch-event-mapping","title":"Touch Event Mapping","text":"iOS Event Castella Event <code>touchesBegan</code> <code>MouseEvent</code> (mouse_down) <code>touchesEnded</code> <code>MouseEvent</code> (mouse_up) <code>touchesMoved</code> <code>MouseEvent</code> (mouse_drag) Pinch gesture <code>WheelEvent</code> Soft keyboard <code>InputCharEvent</code> / <code>InputKeyEvent</code>"},{"location":"ios/#building-ios-apps","title":"Building iOS Apps","text":""},{"location":"ios/#prerequisites","title":"Prerequisites","text":"<ul> <li>macOS with Xcode installed</li> <li>Rust toolchain with iOS targets:   <pre><code>rustup target add aarch64-apple-ios-sim  # M1/M2 Simulator\nrustup target add aarch64-apple-ios      # Physical device\n</code></pre></li> <li>Briefcase: <code>pip install briefcase</code> or use <code>uvx briefcase</code></li> </ul>"},{"location":"ios/#using-the-build-script","title":"Using the Build Script","text":"<p>The unified build script handles all steps:</p> <pre><code># Basic usage\n./tools/build_ios.sh examples/ios_test_app\n\n# With auto-download of pre-built dependencies\nAUTO_DOWNLOAD_DEPS=1 ./tools/build_ios.sh examples/ios_test_app\n\n# Each demo app also has a convenience wrapper\ncd examples/ios_test_app\n./build_ios.sh\n</code></pre>"},{"location":"ios/#manual-build-steps","title":"Manual Build Steps","text":"<pre><code>cd examples/ios_test_app\n\n# Create iOS project\nuvx briefcase create iOS\n\n# Build the app\nuvx briefcase build iOS\n\n# Run on Simulator\nuvx briefcase run iOS\n</code></pre>"},{"location":"ios/#dependencies","title":"Dependencies","text":"<p>iOS apps require pre-built native libraries (pydantic-core, castella-skia) that are cross-compiled for iOS.</p>"},{"location":"ios/#auto-download-recommended","title":"Auto-Download (Recommended)","text":"<p>Dependencies are automatically downloaded when using <code>AUTO_DOWNLOAD_DEPS=1</code>:</p> <pre><code>AUTO_DOWNLOAD_DEPS=1 ./tools/build_ios.sh examples/ios_test_app\n</code></pre>"},{"location":"ios/#manual-download","title":"Manual Download","text":"<pre><code># Download iOS dependencies from GitHub Releases\n./tools/download_ios_deps.sh [version] [target]\n\n# Examples\n./tools/download_ios_deps.sh              # Latest, ios-sim-arm64\n./tools/download_ios_deps.sh latest ios-arm64   # Latest, device build\n./tools/download_ios_deps.sh v0.11.0 ios-sim-arm64  # Specific version\n</code></pre>"},{"location":"ios/#build-locally","title":"Build Locally","text":"<pre><code># Build pydantic-core for iOS\n./tools/build_pydantic_core_ios.sh        # iOS Simulator (default)\n./tools/build_pydantic_core_ios.sh device # iOS Device\n./tools/build_pydantic_core_ios.sh all    # Both targets\n\n# Build castella-skia for iOS\ncd bindings/python &amp;&amp; ./build_ios.sh\n\n# Then build any iOS app\n./tools/build_ios.sh examples/ios_test_app\n</code></pre>"},{"location":"ios/#dependency-locations","title":"Dependency Locations","text":"Variable Default Description <code>CASTELLA_IOS_DEPS</code> <code>~/castella-ios-deps</code> Base directory for iOS deps <p>Downloaded files: <pre><code>~/castella-ios-deps/\n\u251c\u2500\u2500 ios-sim-arm64/           # M1/M2 Mac Simulator\n\u2502   \u251c\u2500\u2500 pydantic_core/\n\u2502   \u2514\u2500\u2500 castella_skia.abi3.so\n\u2514\u2500\u2500 ios-arm64/               # Physical device\n    \u251c\u2500\u2500 pydantic_core/\n    \u2514\u2500\u2500 castella_skia.abi3.so\n</code></pre></p>"},{"location":"ios/#keyboard-input","title":"Keyboard Input","text":"<p>iOS keyboard input is implemented with full IME (Input Method Editor) support for Japanese, Chinese, Korean, and other languages.</p>"},{"location":"ios/#architecture_1","title":"Architecture","text":"<ol> <li>Hidden UITextField: Provides full IME support</li> <li>UITextFieldTextDidChangeNotification: Monitors text changes</li> <li>Diff computation: Calculates inserted/deleted characters</li> </ol>"},{"location":"ios/#usage","title":"Usage","text":"<ul> <li><code>Input</code> and <code>MultilineInput</code> widgets automatically show the keyboard when focused</li> <li>ASCII input uses direct character events</li> <li>IME input (e.g., Japanese) works via text field diff computation</li> </ul>"},{"location":"ios/#supported-input-methods","title":"Supported Input Methods","text":"<ul> <li>Direct ASCII input</li> <li>Japanese IME (Hiragana, Katakana, Kanji)</li> <li>Chinese IME (Pinyin, Zhuyin)</li> <li>Korean IME (Hangul)</li> <li>Any IME supported by iOS</li> </ul>"},{"location":"ios/#safe-area-handling","title":"Safe Area Handling","text":"<p>iOS devices with notches (iPhone X and later) have safe area insets. Castella handles this automatically:</p> <ul> <li>Status bar area is respected</li> <li>Home indicator area is respected</li> <li>Content is rendered within safe bounds</li> </ul>"},{"location":"ios/#limitations","title":"Limitations","text":"<ul> <li>Android: Not yet supported (planned)</li> <li>Physical devices: Requires Apple Developer account for code signing</li> <li>App Store: Not yet tested for App Store submission</li> </ul>"},{"location":"ios/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ios/#build-failures","title":"Build Failures","text":"<p>Missing dependencies: <pre><code># Ensure iOS dependencies are downloaded\n./tools/download_ios_deps.sh\n</code></pre></p> <p>Xcode command line tools: <pre><code>xcode-select --install\n</code></pre></p>"},{"location":"ios/#runtime-issues","title":"Runtime Issues","text":"<p>Black screen: Ensure castella-skia is properly installed in app_packages</p> <p>Touch not working: Check that <code>userInteractionEnabled = True</code> is set on UIImageView</p> <p>Keyboard not appearing: Ensure the Input widget has focus</p>"},{"location":"ios/#next-steps","title":"Next Steps","text":"<ul> <li>See castella-skia for details on the Rust rendering backend</li> <li>See Packaging for distribution options</li> </ul>"},{"location":"layout/","title":"Layout","text":""},{"location":"layout/#container-widget","title":"Container Widget","text":"<p>Castella has three container widgets for UI layout; Column, Row and Box.</p>"},{"location":"layout/#column","title":"Column","text":"<p>Column aligns child elements vertically like this and the code looks like this.</p> <pre><code>Column(\n  Text(\"First\", font_size=24),\n  Text(\"Second\", font_size=24),\n\u00a0 Text(\"Third\", font_size=24),\n)\n</code></pre>"},{"location":"layout/#row","title":"Row","text":"<p>Row aligns child elements horizontally like this and the code is this.</p> <pre><code>Row(\n  Text(\"First\", font_size=24),\n  Text(\"Second\", font_size=24),\n\u00a0 Text(\"Third\", font_size=24),\n)\n</code></pre>"},{"location":"layout/#box","title":"Box","text":"<p>Box can take one or more children. All children are stacked at the same position, rendered in z-index order (lower first, higher on top). This enables creating overlays, modals, and layered UIs.</p> <p>If a child's size is bigger than the parent box, the parent box provides scrollbars automatically. (By the way, if you set scrollable=True for Column or Row, a scrollbar will appear when the child elements do not fit within the view.)</p> <pre><code># Simple scrollable content\nBox(\n  Text(\"Content\", font_size=24).fixed_size(400, 400),\n)\n\n# Overlapping widgets with z-index\nBox(\n  Column(...).z_index(1),   # Background content\n  Column(...).z_index(10),  # Modal on top\n)\n</code></pre>"},{"location":"layout/#size-policy","title":"Size Policy","text":"<p>Each widget has size policies for each width and height. There are three types of policies that can be specified.</p> <ul> <li>Expanding: maximum size that will fit in the parent widget</li> <li>Fixed Size: specified size</li> <li>Content: size according to the content (e.g., for text, according to the size of that text)</li> </ul> <p>The default policy is different depending on the kind of widget, but it is basically \u201cExpanding\u201d for both width and height.</p> <p>For example, in the Row example above, the width policy of each Text widget is \u201cExpanding\" and the height policy is \"Expanding\u201d.</p> <pre><code>Row(\n  Text(\"First\", font_size=24),\n  Text(\"Second\", font_size=24),\n\u00a0 Text(\"Third\", font_size=24),\n)\n</code></pre> <p>In this case, the width of each Text widget is expanded to the width of the parent Row widget and share their width equally, and the height of each Text widget is expanded to the height of the parent Row widget.</p> <p>The code above is same with the code below written without omission of the size policy setting.</p> <pre><code>Row(\n  Text(\"First\", font_size=24).WidthPolicy(SizePolicy.Expanding)\n                             .HeightPolicy(SizePolicy.Expanding),\n  Text(\"Second\", font_size=24).WidthPolicy(SizePolicy.Expanding)\n                              .HeightPolicy(SizePolicy.Expanding),\n  Text(\"Third\", font_size=24).WidthPolicy(SizePolicy.Expanding)\n                             .HeightPolicy(SizePolicy.Expanding),\n)\n</code></pre>"},{"location":"layout/#flex","title":"Flex","text":"<p>By specifying \"flex\" you can specify each widget's occupied ratio for the overall size in the parent widget.</p> <pre><code>Row(\n  Text(\"First\", font_size=24).flex(1),\n  Text(\"Second\", font_size=24).flex(2),\n\u00a0 Text(\"Third\", font_size=24).flex(1),\n)\n</code></pre> <p>In this example above, the width of the entire row is divided in the ratio 1:2:1.</p>"},{"location":"layout/#mix-of-various-size-policies","title":"Mix of various size policies","text":"<p>Of course, you can mix multiple size policies for the children of a single parent widget.</p> <pre><code>Row(\n  Text(\"First\", font_size=24).fixed_size(100, 50),\n  Text(\"Second\", font_size=24).flex(2),\n\u00a0 Text(\"Third\", font_size=24).flex(1),\n)\n</code></pre> <p>In this example, the first element is displayed at the specified fixed size. The remaining two child elements share the remaining width in 2:1 ratio.</p>"},{"location":"layout/#z-index-stacking-order","title":"Z-Index (Stacking Order)","text":"<p>Widgets can be layered using the <code>z_index()</code> method. Higher values appear on top and receive input events first.</p> <pre><code>main_content = Column(...).z_index(1)\nmodal = Column(...).z_index(10)  # Appears on top\nreturn Box(main_content, modal)\n</code></pre> <p>For detailed information and examples, see Z-Index and Layering.</p>"},{"location":"license/","title":"License","text":"<p>MIT License</p> <p>Copyright (c) 2022 Yasushi Itoh</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"mcp/","title":"MCP (Model Context Protocol) Support","text":"<p>Castella provides built-in support for MCP (Model Context Protocol), enabling AI agents to introspect and control Castella UIs programmatically.</p>"},{"location":"mcp/#overview","title":"Overview","text":"<p>MCP is a standard protocol for AI-UI interaction. With Castella's MCP support, AI agents can:</p> <ul> <li>Introspect the UI tree to understand what elements exist</li> <li>Read element properties (labels, values, states)</li> <li>Control widgets (click buttons, type text, toggle checkboxes)</li> <li>Integrate with A2UI for bidirectional AI-generated UIs</li> </ul>"},{"location":"mcp/#installation","title":"Installation","text":"<p>Install Castella with MCP support:</p> <pre><code>uv add \"castella[mcp]\"\n# or\npip install \"castella[mcp]\"\n</code></pre>"},{"location":"mcp/#quick-start","title":"Quick Start","text":""},{"location":"mcp/#basic-mcp-server","title":"Basic MCP Server","text":"<pre><code>from castella import App, Column, Button, Input, Text\nfrom castella.frame import Frame\nfrom castella.mcp import CastellaMCPServer\n\ndef build_ui():\n    return Column(\n        Text(\"Hello MCP!\"),\n        Input(\"\").semantic_id(\"name-input\"),\n        Button(\"Submit\").semantic_id(\"submit-btn\"),\n    )\n\napp = App(Frame(\"MCP Demo\", 800, 600), build_ui())\nmcp = CastellaMCPServer(app, name=\"my-app\")\n\n# Run SSE server for HTTP clients\nmcp.run_sse_in_background(host=\"localhost\", port=8765)\n\napp.run()\n</code></pre>"},{"location":"mcp/#controlling-from-a-client","title":"Controlling from a Client","text":"<pre><code>import json\nimport urllib.request\n\ndef call_tool(name: str, **kwargs) -&gt; dict:\n    message = {\"type\": \"call_tool\", \"params\": {\"name\": name, \"arguments\": kwargs}}\n    data = json.dumps(message).encode(\"utf-8\")\n    req = urllib.request.Request(\n        \"http://localhost:8765/message\",\n        data=data,\n        headers={\"Content-Type\": \"application/json\"},\n    )\n    with urllib.request.urlopen(req) as response:\n        return json.loads(response.read())\n\n# Type into the input field\nresult = call_tool(\"type_text\", element_id=\"name-input\", text=\"Hello\", replace=True)\nprint(f\"Type result: {result}\")\n\n# Click the submit button\nresult = call_tool(\"click\", element_id=\"submit-btn\")\nprint(f\"Click result: {result}\")\n</code></pre>"},{"location":"mcp/#semantic-ids","title":"Semantic IDs","text":"<p>Widgets can be assigned stable semantic IDs that persist across UI rebuilds:</p> <pre><code># Assign semantic IDs using the fluent API\nButton(\"Submit\").semantic_id(\"submit-btn\")\nInput(\"\").semantic_id(\"name-input\")\nCheckBox(checked_state).semantic_id(\"newsletter-opt-in\")\n\n# Without semantic IDs, auto-generated IDs are used:\n# button_0, input_1, checkbox_2, etc.\n</code></pre> <p>Semantic IDs are crucial for reliable AI agent interaction - they provide stable identifiers that don't change when the UI is rebuilt.</p>"},{"location":"mcp/#transport-options","title":"Transport Options","text":""},{"location":"mcp/#sse-transport-http","title":"SSE Transport (HTTP)","text":"<p>The SSE (Server-Sent Events) transport is ideal for connecting to already-running Castella applications:</p> <pre><code>mcp = CastellaMCPServer(app, name=\"my-app\")\n\n# Run SSE server on a specific port\nmcp.run_sse_in_background(host=\"localhost\", port=8765)\n</code></pre> <p>SSE Endpoints:</p> Endpoint Method Description <code>/sse</code> GET SSE event stream <code>/message</code> POST Send MCP messages <code>/health</code> GET Health check"},{"location":"mcp/#stdio-transport","title":"stdio Transport","text":"<p>For integration with Claude Desktop or other MCP clients that use stdio:</p> <pre><code>mcp = CastellaMCPServer(app, name=\"my-app\")\n\n# Run stdio server in background thread\nmcp.run_in_background()\n</code></pre>"},{"location":"mcp/#mcp-resources","title":"MCP Resources","text":"<p>Resources provide read-only access to UI state:</p> URI Description <code>ui://tree</code> Complete UI tree with semantic IDs and properties <code>ui://focus</code> Currently focused element <code>ui://elements</code> List of all interactive elements <code>ui://element/{id}</code> Detailed information about a specific element <code>a2ui://surfaces</code> A2UI surfaces (when A2UI renderer is provided)"},{"location":"mcp/#reading-resources","title":"Reading Resources","text":"<pre><code>def read_resource(uri: str) -&gt; dict:\n    return send_message(\"read_resource\", {\"uri\": uri})\n\n# Get the complete UI tree\ntree = read_resource(\"ui://tree\")\n\n# Get all interactive elements\nelements = read_resource(\"ui://elements\")\n</code></pre>"},{"location":"mcp/#mcp-tools","title":"MCP Tools","text":"<p>Tools allow AI agents to interact with the UI:</p> Tool Parameters Description <code>click(element_id)</code> <code>element_id: str</code> Click/tap an element <code>type_text(element_id, text, replace)</code> <code>element_id: str</code>, <code>text: str</code>, <code>replace: bool = False</code> Type into an input field <code>focus(element_id)</code> <code>element_id: str</code> Set focus to an element <code>scroll(element_id, direction, amount)</code> <code>element_id: str</code>, <code>direction: str</code>, <code>amount: int = 100</code> Scroll (up/down/left/right) <code>toggle(element_id)</code> <code>element_id: str</code> Toggle a checkbox or switch <code>select(element_id, value)</code> <code>element_id: str</code>, <code>value: str</code> Select value in picker/radio/tabs <code>list_actionable()</code> (none) List all interactive elements <code>send_a2ui(message)</code> <code>message: dict</code> Send A2UI message (when A2UI renderer provided)"},{"location":"mcp/#tool-examples","title":"Tool Examples","text":"<pre><code># Click a button\ncall_tool(\"click\", element_id=\"submit-btn\")\n\n# Type text (replace existing content)\ncall_tool(\"type_text\", element_id=\"search-input\", text=\"python\", replace=True)\n\n# Type text (append to existing)\ncall_tool(\"type_text\", element_id=\"notes-input\", text=\" more text\", replace=False)\n\n# Toggle a checkbox\ncall_tool(\"toggle\", element_id=\"agree-checkbox\")\n\n# Scroll down\ncall_tool(\"scroll\", element_id=\"content-list\", direction=\"down\", amount=200)\n\n# Select a tab\ncall_tool(\"select\", element_id=\"main-tabs\", value=\"settings\")\n</code></pre>"},{"location":"mcp/#a2ui-mcp-integration","title":"A2UI + MCP Integration","text":"<p>Castella's MCP support integrates seamlessly with A2UI for bidirectional AI-UI interaction:</p> <pre><code>from castella import App\nfrom castella.a2ui import A2UIRenderer, A2UIComponent, UserAction\nfrom castella.frame import Frame\nfrom castella.mcp import CastellaMCPServer\n\n# A2UI JSON definition\nA2UI_JSON = {\n    \"components\": [\n        {\"id\": \"root\", \"component\": \"Column\", \"children\": {\"explicitList\": [\"input\", \"btn\"]}},\n        {\"id\": \"input\", \"component\": \"TextField\", \"text\": {\"path\": \"/name\"}},\n        {\"id\": \"btn\", \"component\": \"Button\", \"text\": {\"literalString\": \"Submit\"},\n         \"action\": {\"name\": \"submit\", \"context\": []}},\n    ],\n    \"rootId\": \"root\",\n}\n\n# Create A2UI renderer with action handler\ndef on_action(action: UserAction):\n    if action.name == \"submit\":\n        surface = renderer.get_surface(\"default\")\n        name = surface.data_model.get(\"name\", \"\")\n        print(f\"Submitted: {name}\")\n\nrenderer = A2UIRenderer(on_action=on_action)\nrenderer.render_json(A2UI_JSON, initial_data={\"/name\": \"\"})\n\nsurface = renderer.get_surface(\"default\")\napp = App(Frame(\"A2UI + MCP\", 800, 600), A2UIComponent(surface))\n\n# MCP server with A2UI renderer for bidirectional integration\nmcp = CastellaMCPServer(app, a2ui_renderer=renderer)\nmcp.run_sse_in_background(host=\"localhost\", port=8766)\n\napp.run()\n</code></pre> <p>Key Features:</p> <ul> <li>A2UI component IDs are automatically used as MCP semantic IDs</li> <li>MCP tools can control A2UI-generated widgets</li> <li>User actions are properly routed through A2UI's action system</li> <li>Data bindings are maintained across MCP operations</li> </ul>"},{"location":"mcp/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      AI Agent (Claude, etc.)                \u2502\n\u2502                            \u2193\u2191                               \u2502\n\u2502                         MCP Client                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2193\u2191 SSE/stdio (JSON-RPC)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Castella Application                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502        CastellaMCPServer (background thread)         \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502\n\u2502  \u2502  \u2502   Resources    \u2502  \u2502         Tools              \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  ui://tree     \u2502  \u2502  click(), type_text()      \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  ui://focus    \u2502  \u2502  scroll(), toggle()        \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502  ui://elements \u2502  \u2502  send_a2ui()               \u2502 \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                            \u2193\u2191                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  SemanticWidgetRegistry + WidgetIntrospector        \u2502   \u2502\n\u2502  \u2502  - Stable semantic ID management                     \u2502   \u2502\n\u2502  \u2502  - A2UI ID integration                               \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                            \u2193\u2191                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              Widget Tree (main thread)               \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"mcp/#examples","title":"Examples","text":"<p>Run the included examples to see MCP in action:</p> <pre><code># Basic MCP SSE server\nuv run python examples/mcp_sse_server.py\n\n# MCP SSE client (in another terminal)\nuv run python examples/mcp_sse_client.py\n\n# A2UI + MCP server\nuv run python examples/mcp_a2ui_server.py\n\n# A2UI + MCP client (in another terminal)\nuv run python examples/mcp_a2ui_client.py\n</code></pre>"},{"location":"mcp/#module-reference","title":"Module Reference","text":""},{"location":"mcp/#castellamcp","title":"<code>castella.mcp</code>","text":"Class/Function Description <code>CastellaMCPServer</code> Main MCP server class <code>SemanticWidgetRegistry</code> Widget ID registry <code>WidgetIntrospector</code> UI tree introspection <code>ElementInfo</code> Element information model <code>UITreeNode</code> Tree node model <code>ActionResult</code> Tool result model"},{"location":"mcp/#castellamcpserver-api","title":"CastellaMCPServer API","text":"<pre><code>class CastellaMCPServer:\n    def __init__(\n        self,\n        app: App,\n        name: str = \"castella-ui\",\n        a2ui_renderer: A2UIRenderer | None = None,\n    ): ...\n\n    def run(self) -&gt; None:\n        \"\"\"Run MCP server (blocking, stdio transport).\"\"\"\n\n    def run_in_background(self) -&gt; threading.Thread:\n        \"\"\"Run MCP server in background thread (stdio transport).\"\"\"\n\n    def run_sse_in_background(\n        self,\n        host: str = \"localhost\",\n        port: int = 8765,\n    ) -&gt; threading.Thread:\n        \"\"\"Run SSE server in background thread.\"\"\"\n\n    def refresh_registry(self) -&gt; None:\n        \"\"\"Refresh the widget registry from the current UI tree.\"\"\"\n</code></pre>"},{"location":"mcp/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Use Semantic IDs - Always assign meaningful semantic IDs to interactive elements for reliable AI agent interaction.</p> </li> <li> <p>Handle Actions Properly - When using A2UI integration, implement proper action handlers to respond to AI-initiated interactions.</p> </li> <li> <p>Keep UI Simple - Complex UIs with many nested elements can be harder for AI agents to navigate. Consider flattening the structure where possible.</p> </li> <li> <p>Test with Clients - Use the provided example clients to verify your MCP integration works correctly.</p> </li> <li> <p>Error Handling - Check the <code>success</code> field in tool results and handle failures gracefully.</p> </li> </ol>"},{"location":"packaging/","title":"Packaging a Castella App","text":"<p>This guide covers packaging Castella applications for distribution.</p>"},{"location":"packaging/#desktop-applications","title":"Desktop Applications","text":""},{"location":"packaging/#ux","title":"ux","text":"<p>ux is a Rust-based Python app bundler that leverages <code>uv</code> to create single distributable executables. End users don't need Python or uv installed to run the bundled app.</p> <p>Features:</p> <ul> <li>Single executable distribution</li> <li>Cross-platform compilation</li> <li>macOS app bundles with code signing and notarization</li> <li>DMG packaging for macOS distribution</li> </ul> <p>Installation:</p> <pre><code># With uv (recommended)\nuv tool install ux-py\n\n# With pip\npip install ux-py\n</code></pre> <p>Basic usage:</p> <pre><code>ux bundle --project . --output ./dist/\n</code></pre> <p>Configuration in pyproject.toml:</p> <pre><code>[tool.ux]\nentry = \"your_app\"\ninclude = [\"assets/\"]\n\n[tool.ux.macos]\nicon = \"assets/icon.png\"\nbundle_identifier = \"com.example.yourapp\"\nbundle_name = \"Your App\"\n</code></pre> <p>macOS app bundle with code signing:</p> <pre><code># Create signed .app bundle\nux bundle --format app --codesign --output ./dist/\n\n# Create signed .app and DMG\nux bundle --format app --codesign --dmg --output ./dist/\n\n# With notarization (for distribution)\nux bundle --format app --codesign --notarize --dmg --output ./dist/\n</code></pre> <p>Cross-compilation:</p> <pre><code># Build for Linux\nux bundle --target linux-x86_64 --output ./dist/\n\n# Build for Windows\nux bundle --target windows-x86_64 --output ./dist/\n</code></pre> <p>Supported targets:</p> Target PyPI Notes darwin-x86_64 Yes Intel Mac darwin-aarch64 Yes Apple Silicon Mac linux-x86_64 Yes linux-aarch64 GitHub ARM64 Linux windows-x86_64 Yes"},{"location":"packaging/#pyinstaller","title":"PyInstaller","text":"<p>PyInstaller packages your app as a standalone executable:</p> <pre><code># With uv (recommended)\nuv add --dev pyinstaller\nuv run pyinstaller --onefile --windowed your_app.py\n\n# With pip\npip install pyinstaller\npyinstaller --onefile --windowed your_app.py\n</code></pre> <p>Options:</p> <ul> <li><code>--onefile</code>: Create a single executable file</li> <li><code>--windowed</code>: Hide the console window (for GUI apps)</li> <li><code>--name</code>: Set the output executable name</li> </ul> <p>Example with custom options:</p> <pre><code>pyinstaller --onefile --windowed --name \"MyApp\" \\\n    --icon=icon.ico your_app.py\n</code></pre>"},{"location":"packaging/#nuitka","title":"Nuitka","text":"<p>Nuitka compiles Python to native code for better performance:</p> <pre><code># With uv (recommended)\nuv add --dev nuitka\nuv run nuitka --standalone --onefile your_app.py\n\n# With pip\npip install nuitka\nnuitka --standalone --onefile your_app.py\n</code></pre> <p>For GUI applications:</p> <pre><code># With uv\nuv run nuitka --standalone --onefile --disable-console your_app.py\n\n# With pip\nnuitka --standalone --onefile --disable-console your_app.py\n</code></pre>"},{"location":"packaging/#platform-specific-notes","title":"Platform-Specific Notes","text":""},{"location":"packaging/#windows","title":"Windows","text":"<ul> <li>Include SDL2/GLFW DLLs if using those backends</li> <li>Set <code>PYSDL2_DLL_PATH</code> environment variable if needed</li> <li>Consider code signing for distribution</li> </ul> <p>SDL2 DLL handling:</p> <pre><code>import os\nos.environ[\"PYSDL2_DLL_PATH\"] = \"path/to/sdl2/dlls\"\n</code></pre>"},{"location":"packaging/#macos","title":"macOS","text":"<p>For proper macOS app bundles:</p> <pre><code># Using PyInstaller\npyinstaller --onefile --windowed \\\n    --osx-bundle-identifier com.yourname.yourapp \\\n    your_app.py\n</code></pre> <p>Notes:</p> <ul> <li>Sign your app for distribution</li> <li>Create a proper <code>.app</code> bundle</li> <li>Test on different macOS versions</li> </ul>"},{"location":"packaging/#linux","title":"Linux","text":"<p>AppImage (recommended for distribution):</p> <ol> <li>Build with PyInstaller</li> <li>Package as AppImage for portable distribution</li> </ol> <p>System packages:</p> <p>Ensure system libraries are available:</p> <pre><code># Debian/Ubuntu\nsudo apt install libgl1-mesa-glx libglfw3\n\n# Fedora\nsudo dnf install mesa-libGL glfw\n</code></pre>"},{"location":"packaging/#ios-applications","title":"iOS Applications","text":"<p>Castella iOS apps are packaged using BeeWare Briefcase.</p>"},{"location":"packaging/#prerequisites","title":"Prerequisites","text":"<ul> <li>macOS with Xcode</li> <li>Rust toolchain with iOS targets</li> <li>Briefcase: <code>pip install briefcase</code></li> </ul>"},{"location":"packaging/#quick-start","title":"Quick Start","text":"<p>Use the unified build script:</p> <pre><code># Build and run on iOS Simulator\n./tools/build_ios.sh examples/ios_test_app\n\n# With auto-download of dependencies\nAUTO_DOWNLOAD_DEPS=1 ./tools/build_ios.sh examples/ios_test_app\n</code></pre>"},{"location":"packaging/#manual-process","title":"Manual Process","text":"<pre><code>cd your_ios_app\n\n# Create iOS project\nuvx briefcase create iOS\n\n# Build\nuvx briefcase build iOS\n\n# Run on Simulator\nuvx briefcase run iOS\n</code></pre>"},{"location":"packaging/#project-structure","title":"Project Structure","text":"<pre><code>your_ios_app/\n\u251c\u2500\u2500 pyproject.toml          # Briefcase configuration\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 your_app/\n\u2502       \u251c\u2500\u2500 __init__.py     # Entry point\n\u2502       \u251c\u2500\u2500 __main__.py     # Required for iOS\n\u2502       \u2514\u2500\u2500 app.py          # Your Castella app\n\u2514\u2500\u2500 build_ios.sh            # Optional convenience script\n</code></pre>"},{"location":"packaging/#dependencies","title":"Dependencies","text":"<p>iOS requires pre-built native libraries. Download them:</p> <pre><code># Auto-download during build\nAUTO_DOWNLOAD_DEPS=1 ./tools/build_ios.sh your_app\n\n# Or download manually\n./tools/download_ios_deps.sh\n</code></pre>"},{"location":"packaging/#app-store-submission","title":"App Store Submission","text":"<p>Not Yet Tested</p> <p>App Store submission has not been tested. Physical device deployment requires an Apple Developer account for code signing.</p> <p>For more details, see iOS Documentation.</p>"},{"location":"packaging/#web-deployment","title":"Web Deployment","text":"<p>For PyScript/Pyodide web applications, see Getting Started - Web Browsers.</p>"},{"location":"packaging/#basic-web-deployment","title":"Basic Web Deployment","text":"<ol> <li>Create your HTML file with PyScript setup</li> <li>Include your Python source</li> <li>Deploy to any static file server</li> </ol> <p>Example project structure:</p> <pre><code>my-web-app/\n\u251c\u2500\u2500 index.html\n\u251c\u2500\u2500 main.py\n\u2514\u2500\u2500 castella-0.11.1-py3-none-any.whl\n</code></pre>"},{"location":"packaging/#hosting-options","title":"Hosting Options","text":"<ul> <li>GitHub Pages (free)</li> <li>Netlify (free tier)</li> <li>Any static file hosting</li> </ul>"},{"location":"packaging/#handling-dependencies","title":"Handling Dependencies","text":""},{"location":"packaging/#data-files","title":"Data Files","text":"<p>Include data files (images, fonts, etc.):</p> <p>PyInstaller:</p> <pre><code>pyinstaller --add-data \"assets:assets\" your_app.py\n</code></pre> <p>In your code:</p> <pre><code>import sys\nimport os\n\nif getattr(sys, 'frozen', False):\n    # Running as compiled\n    base_path = sys._MEIPASS\nelse:\n    # Running as script\n    base_path = os.path.dirname(__file__)\n\nasset_path = os.path.join(base_path, 'assets', 'image.png')\n</code></pre>"},{"location":"packaging/#hidden-imports","title":"Hidden Imports","text":"<p>If PyInstaller misses some imports:</p> <pre><code>pyinstaller --hidden-import=castella.glfw_frame \\\n    --hidden-import=skia your_app.py\n</code></pre>"},{"location":"packaging/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Test the packaged app on a clean system without Python installed</p> </li> <li> <p>Include all backends you might use, or specify the exact one</p> </li> <li> <p>Document system requirements for your users</p> </li> <li> <p>Version your releases with clear changelogs</p> </li> <li> <p>Consider installer tools like NSIS (Windows) or create-dmg (macOS) for professional distribution</p> </li> </ol>"},{"location":"sizing/","title":"Sizing","text":"<p>Castella widgets use a SizePolicy system to control how they size themselves within their parent container. This page explains the sizing system and the convenient syntax sugar methods available.</p>"},{"location":"sizing/#sizepolicy","title":"SizePolicy","text":"<p>Every widget has independent width and height policies:</p> Policy Description <code>FIXED</code> Widget uses the exact size specified <code>EXPANDING</code> Widget expands to fill available space <code>CONTENT</code> Widget sizes itself to fit its content"},{"location":"sizing/#default-policies","title":"Default Policies","text":"<p>Most widgets default to <code>EXPANDING</code> for both dimensions, meaning they fill available space:</p> <pre><code># These two are equivalent\nText(\"Hello\")\nText(\"Hello\").width_policy(SizePolicy.EXPANDING).height_policy(SizePolicy.EXPANDING)\n</code></pre> <p>Some widgets like <code>Image</code> and <code>Markdown</code> default to <code>CONTENT</code> policy.</p>"},{"location":"sizing/#syntax-sugar-methods","title":"Syntax Sugar Methods","text":"<p>Castella provides convenient methods that combine size and policy settings:</p>"},{"location":"sizing/#fixed-sizing","title":"Fixed Sizing","text":"<pre><code># Set fixed width (100px)\nwidget.fixed_width(100)\n# Equivalent to: widget.width(100).width_policy(SizePolicy.FIXED)\n\n# Set fixed height (40px)\nwidget.fixed_height(40)\n# Equivalent to: widget.height(40).height_policy(SizePolicy.FIXED)\n\n# Set both dimensions at once\nwidget.fixed_size(200, 100)\n# Equivalent to: widget.width(200).width_policy(SizePolicy.FIXED)\n#                     .height(100).height_policy(SizePolicy.FIXED)\n</code></pre>"},{"location":"sizing/#content-sizing","title":"Content Sizing","text":"<pre><code># Size to content in both dimensions\nwidget.fit_content()\n# Equivalent to: widget.width_policy(SizePolicy.CONTENT)\n#                     .height_policy(SizePolicy.CONTENT)\n\n# Size to content width only\nwidget.fit_content_width()\n# Equivalent to: widget.width_policy(SizePolicy.CONTENT)\n\n# Size to content height only\nwidget.fit_content_height()\n# Equivalent to: widget.height_policy(SizePolicy.CONTENT)\n</code></pre>"},{"location":"sizing/#parent-filling","title":"Parent Filling","text":"<pre><code># Expand to fill parent in both dimensions\nwidget.fit_parent()\n# Equivalent to: widget.width_policy(SizePolicy.EXPANDING)\n#                     .height_policy(SizePolicy.EXPANDING)\n</code></pre>"},{"location":"sizing/#practical-examples","title":"Practical Examples","text":""},{"location":"sizing/#fixed-height-row","title":"Fixed Height Row","text":"<pre><code>Row(\n    Button(\"Save\"),\n    Button(\"Cancel\"),\n).fixed_height(50)\n</code></pre>"},{"location":"sizing/#scrollable-list-with-fixed-item-heights","title":"Scrollable List with Fixed Item Heights","text":"<pre><code>Column(\n    *[Text(item).fixed_height(30) for item in items],\n    scrollable=True,\n)\n</code></pre>"},{"location":"sizing/#fixed-width-sidebar","title":"Fixed Width Sidebar","text":"<pre><code>Row(\n    Column(\n        Text(\"Sidebar\"),\n        # sidebar content...\n    ).fixed_width(200),\n    Column(\n        Text(\"Main Content\"),\n        # main content...\n    ),  # Expands to fill remaining space\n)\n</code></pre>"},{"location":"sizing/#input-with-fixed-height","title":"Input with Fixed Height","text":"<pre><code>MultilineInput(state, font_size=14, wrap=True).fixed_height(200)\n</code></pre>"},{"location":"sizing/#chart-with-fixed-height","title":"Chart with Fixed Height","text":"<pre><code>Row(\n    GaugeChart(data),\n    Button(\"Update\"),\n).fixed_height(200)\n</code></pre>"},{"location":"sizing/#comparison-before-and-after","title":"Comparison: Before and After","text":"<p>Using syntax sugar methods makes code more readable and concise:</p> Before (verbose)After (syntax sugar) <pre><code>from castella import Column, Text, Button, SizePolicy\n\nColumn(\n    Text(\"Title\")\n        .height(40)\n        .height_policy(SizePolicy.FIXED),\n    Text(\"Content\"),\n    Button(\"Submit\")\n        .width(100)\n        .width_policy(SizePolicy.FIXED)\n        .height(40)\n        .height_policy(SizePolicy.FIXED),\n)\n</code></pre> <pre><code>from castella import Column, Text, Button\n\nColumn(\n    Text(\"Title\").fixed_height(40),\n    Text(\"Content\"),\n    Button(\"Submit\").fixed_size(100, 40),\n)\n</code></pre> <p>Benefits: - No need to import <code>SizePolicy</code> - Single method call instead of two - Code is more readable and self-documenting</p>"},{"location":"sizing/#scrollable-container-auto-downgrade","title":"Scrollable Container Auto-Downgrade","text":"<p>Scrollable <code>Column</code> and <code>Row</code> automatically downgrade <code>EXPANDING</code> children to <code>CONTENT</code> policy. You don't need to set size policies manually:</p> <pre><code># Just works! Text's EXPANDING height is auto-downgraded to CONTENT.\nColumn(Text(\"hello\"), scrollable=True)\n\n# Also works with the fluent API:\ncol = Column(Text(\"hello\"))\ncol.scrollable()  # Existing children are downgraded too\n</code></pre>"},{"location":"sizing/#content-policy-constraint","title":"CONTENT Policy Constraint","text":"<p>When using <code>CONTENT</code> height policy on a layout container, all children must also have <code>CONTENT</code> or <code>FIXED</code> height policy:</p> <pre><code># This will raise RuntimeError:\nColumn(\n    Text(\"Hello\"),  # Text defaults to EXPANDING height\n).fit_content_height()\n\n# Fix by setting children to FIXED:\nColumn(\n    Text(\"Hello\").fixed_height(24),\n).fit_content_height()\n\n# Or use widgets that default to CONTENT:\nColumn(\n    Markdown(\"# Hello\"),  # Markdown defaults to CONTENT\n).fit_content_height()\n</code></pre>"},{"location":"sizing/#method-reference","title":"Method Reference","text":"Method Description <code>fixed_width(w)</code> Set fixed width <code>fixed_height(h)</code> Set fixed height <code>fixed_size(w, h)</code> Set fixed width and height <code>fit_content()</code> Size to content (both dimensions) <code>fit_content_width()</code> Size to content width <code>fit_content_height()</code> Size to content height <code>fit_parent()</code> Expand to fill parent (both dimensions) <code>width(w)</code> Set width value <code>height(h)</code> Set height value <code>width_policy(p)</code> Set width policy <code>height_policy(p)</code> Set height policy <code>flex(n)</code> Set flex ratio in layouts"},{"location":"skills/","title":"Agent Skills","text":"<p>Castella includes Agent Skills to help AI coding agents effectively use the framework. These skills follow the agentskills.io specification and are located in the <code>skills/</code> directory.</p>"},{"location":"skills/#available-skills","title":"Available Skills","text":"Skill Description <code>castella-core</code> Core UI development - widgets, components, state, layouts, themes <code>castella-a2ui</code> A2UI JSON rendering - parse messages, data binding, progressive rendering <code>castella-a2a</code> A2A protocol - connect to agents, agent cards, streaming responses <code>castella-mcp</code> MCP integration - servers, resources, tools, semantic IDs <code>castella-agent-ui</code> Agent UI components - AgentChat, MultiAgentChat, AgentHub"},{"location":"skills/#skill-structure","title":"Skill Structure","text":"<p>Each skill follows a consistent structure:</p> <pre><code>skills/\n\u2514\u2500\u2500 castella-core/\n    \u251c\u2500\u2500 SKILL.md           # Main skill document\n    \u251c\u2500\u2500 references/        # Detailed API documentation\n    \u2502   \u251c\u2500\u2500 widgets.md\n    \u2502   \u251c\u2500\u2500 theme.md\n    \u2502   \u2514\u2500\u2500 ...\n    \u2514\u2500\u2500 scripts/           # Executable examples\n        \u251c\u2500\u2500 counter.py\n        \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"skills/#skillmd","title":"SKILL.md","text":"<p>The main skill document contains:</p> <ul> <li>YAML frontmatter with <code>name</code> and <code>description</code></li> <li>Quick Start - Minimal code to get started</li> <li>Core Concepts - Key patterns and APIs</li> <li>Best Practices - Recommended usage patterns</li> <li>Reference links - Pointers to detailed documentation</li> </ul>"},{"location":"skills/#references","title":"references/","text":"<p>Detailed API documentation for specific topics. These are loaded on-demand when the AI agent needs deeper information.</p>"},{"location":"skills/#scripts","title":"scripts/","text":"<p>Executable Python examples that demonstrate the skill's features. These can be run directly:</p> <pre><code>uv run python skills/castella-core/scripts/counter.py\n</code></pre>"},{"location":"skills/#skill-descriptions","title":"Skill Descriptions","text":""},{"location":"skills/#castella-core","title":"castella-core","text":"<p>Core UI development with Castella. Covers:</p> <ul> <li>App and Frame setup</li> <li>Widgets (Text, Button, Input, etc.)</li> <li>Layout containers (Column, Row, Box)</li> <li>Component pattern with State and ListState</li> <li>Size policies (FIXED, EXPANDING, CONTENT)</li> <li>Theme system and styling</li> <li>Event handling</li> <li>Animation</li> </ul> <p>When to use: Creating Castella apps, building UIs, working with widgets, managing state, handling events.</p>"},{"location":"skills/#castella-a2ui","title":"castella-a2ui","text":"<p>A2UI (Agent-to-User Interface) JSON rendering. Covers:</p> <ul> <li>A2UIRenderer for parsing A2UI JSON</li> <li>Value types (literal vs binding)</li> <li>Supported components (17 total)</li> <li>Data binding with JSON Pointers</li> <li>Actions and event handling</li> <li>updateDataModel for dynamic updates</li> <li>TemplateChildren for dynamic lists</li> <li>Progressive rendering (JSONL streaming)</li> <li>A2UIClient for connecting to agents</li> </ul> <p>When to use: Rendering A2UI JSON, connecting to A2UI-enabled agents, handling A2UI actions.</p>"},{"location":"skills/#castella-a2a","title":"castella-a2a","text":"<p>A2A (Agent-to-Agent) protocol integration. Covers:</p> <ul> <li>A2AClient for connecting to agents</li> <li>Agent cards and skills</li> <li>Synchronous and asynchronous messaging</li> <li>Streaming responses</li> <li>Error handling</li> <li>AgentCardView widget</li> </ul> <p>When to use: Connecting to A2A agents, displaying agent information, sending messages.</p>"},{"location":"skills/#castella-mcp","title":"castella-mcp","text":"<p>MCP (Model Context Protocol) integration. Covers:</p> <ul> <li>CastellaMCPServer setup</li> <li>Semantic IDs for widgets</li> <li>MCP Resources (ui://tree, ui://elements, etc.)</li> <li>MCP Tools (click, type_text, toggle, etc.)</li> <li>Transports (stdio, SSE)</li> <li>A2UI + MCP integration</li> </ul> <p>When to use: Enabling AI agents to control Castella UIs, creating MCP servers.</p>"},{"location":"skills/#castella-agent-ui","title":"castella-agent-ui","text":"<p>High-level components for agent UIs. Covers:</p> <ul> <li>AgentChat for quick chat UIs</li> <li>Chat components (ChatContainer, ChatMessage, ChatInput, ChatView)</li> <li>Tool call visualization</li> <li>Agent card display</li> <li>MultiAgentChat for tabbed interfaces</li> <li>AgentHub for agent management</li> <li>Scroll position patterns</li> </ul> <p>When to use: Building chat interfaces, displaying tool calls, managing multiple agents.</p>"},{"location":"skills/#using-skills-with-ai-agents","title":"Using Skills with AI Agents","text":"<p>AI coding agents (like Claude Code) can use these skills to:</p> <ol> <li>Learn Castella patterns - Quick start guides show idiomatic usage</li> <li>Find API details - References provide comprehensive documentation</li> <li>See working examples - Scripts demonstrate real implementations</li> <li>Follow best practices - Each skill includes recommended patterns</li> </ol> <p>The skills use progressive disclosure:</p> <ul> <li>Metadata (~100 tokens) - Name and description for skill selection</li> <li>Instructions (&lt;5000 tokens) - Main SKILL.md content</li> <li>Resources (on-demand) - References and scripts loaded as needed</li> </ul>"},{"location":"state/","title":"State Management","text":"<p>Castella uses reactive state management. When state changes, the UI automatically updates.</p>"},{"location":"state/#statet","title":"State[T]","text":"<p><code>State[T]</code> wraps a value and notifies observers when it changes.</p>"},{"location":"state/#basic-usage","title":"Basic Usage","text":"<pre><code>from castella import State\n\n# Create state\ncount = State(0)\n\n# Get current value (two ways)\nprint(count())      # Using __call__\nprint(count.value())  # Using value() method\n\n# Set new value\ncount.set(5)\n</code></pre>"},{"location":"state/#operator-support","title":"Operator Support","text":"<p>State supports augmented assignment operators that automatically trigger UI updates:</p> <pre><code>count = State(0)\ncount += 1  # Adds and notifies observers\ncount -= 1  # Subtracts and notifies observers\ncount *= 2  # Multiplies and notifies observers\ncount /= 2  # Divides and notifies observers\n</code></pre>"},{"location":"state/#binding-state-to-components","title":"Binding State to Components","text":"<p>Use <code>model()</code> to bind a single state to a component. When the state changes, <code>view()</code> is automatically called:</p> <pre><code>from castella import App, Button, Column, Component, State, Text\nfrom castella.frame import Frame\n\n\nclass Counter(Component):\n    def __init__(self):\n        super().__init__()\n        self._count = State(0)\n        self.model(self._count)  # Bind state to component\n\n    def view(self):\n        return Column(\n            Text(f\"Count: {self._count()}\"),\n            Button(\"+1\").on_click(lambda _: self._count.set(self._count() + 1)),\n            Button(\"-1\").on_click(lambda _: self._count.set(self._count() - 1)),\n        )\n\n\nApp(Frame(\"Counter\", 300, 200), Counter()).run()\n</code></pre>"},{"location":"state/#multiple-states","title":"Multiple States","text":"<p>When a component has multiple states that should trigger <code>view()</code> rebuild, use <code>attach()</code> instead of <code>model()</code>:</p> <pre><code>class MultiStateComponent(Component):\n    def __init__(self):\n        super().__init__()\n        self._tab = State(\"tab1\")\n        self._counter = State(0)\n        # Use attach() for multiple states\n        self._tab.attach(self)\n        self._counter.attach(self)\n\n    def view(self):\n        # Both states trigger view() when changed\n        return Column(\n            Text(f\"Tab: {self._tab()}\"),\n            Text(f\"Count: {self._counter()}\"),\n        )\n</code></pre> <p>model() only keeps one state</p> <p>Calling <code>model()</code> multiple times replaces the previous state. Use <code>attach()</code> when you need multiple states to trigger rebuilds.</p>"},{"location":"state/#on_update-callback","title":"on_update Callback","text":"<p>You can register a callback that runs whenever a state changes:</p> <pre><code>my_state = State(0)\nmy_state.on_update(lambda ev: print(f\"State changed to: {my_state()}\"))\n\nmy_state.set(5)  # Prints: \"State changed to: 5\"\n</code></pre>"},{"location":"state/#liststate","title":"ListState","text":"<p><code>ListState</code> is a reactive list. All mutations automatically notify observers and trigger UI updates.</p>"},{"location":"state/#basic-usage_1","title":"Basic Usage","text":"<pre><code>from castella import ListState\n\nitems = ListState([\"a\", \"b\", \"c\"])\nprint(items[0])  # \"a\"\nprint(len(items))  # 3\n</code></pre>"},{"location":"state/#reactive-mutations","title":"Reactive Mutations","text":"<p>All standard list operations notify observers:</p> <pre><code>items = ListState([1, 2, 3])\n\n# Adding items\nitems.append(4)        # Notifies observers\nitems.extend([5, 6])   # Notifies observers\nitems.insert(0, 0)     # Notifies observers\n\n# Removing items\nitems.pop()            # Notifies observers\nitems.remove(0)        # Notifies observers\nitems.clear()          # Notifies observers\n\n# Modifying items\nitems[0] = 100         # Notifies observers\ndel items[0]           # Notifies observers\n\n# Sorting\nitems.sort()           # Notifies observers\nitems.reverse()        # Notifies observers\n</code></pre>"},{"location":"state/#example-dynamic-list","title":"Example: Dynamic List","text":"<pre><code>from castella import App, Button, Column, Component, ListState, Row, Text\nfrom castella.frame import Frame\n\n\nclass TodoList(Component):\n    def __init__(self):\n        super().__init__()\n        self._items = ListState([\"Task 1\", \"Task 2\"])\n        self.model(self._items)\n\n    def view(self):\n        item_widgets = [Text(item) for item in self._items]\n        return Column(\n            *item_widgets,\n            Row(\n                Button(\"Add\").on_click(\n                    lambda _: self._items.append(f\"Task {len(self._items) + 1}\")\n                ),\n                Button(\"Remove Last\").on_click(\n                    lambda _: self._items.pop() if self._items else None\n                ),\n            ).fixed_height(40),\n        )\n\n\nApp(Frame(\"Todo\", 300, 300), TodoList()).run()\n</code></pre>"},{"location":"state/#scrollstate","title":"ScrollState","text":"<p><code>ScrollState</code> preserves scroll position across view rebuilds. When a component's <code>view()</code> method is called, normally the scroll position would reset. <code>ScrollState</code> solves this by storing the position outside the widget tree.</p>"},{"location":"state/#basic-usage_2","title":"Basic Usage","text":"<pre><code>from castella import ScrollState, Column, Component, ListState, Text\n\nclass MessageList(Component):\n    def __init__(self):\n        super().__init__()\n        self._messages = ListState([\"Message 1\", \"Message 2\", \"Message 3\"])\n        self._messages.attach(self)\n        self._scroll = ScrollState()  # Survives view rebuilds\n\n    def view(self):\n        return Column(\n            *[Text(msg).fixed_height(30) for msg in self._messages],\n            scrollable=True,\n            scroll_state=self._scroll,  # Scroll position preserved!\n        )\n</code></pre>"},{"location":"state/#when-to-use-scrollstate","title":"When to Use ScrollState","text":"<ul> <li>Dynamic lists: Lists that update frequently (chat messages, feeds)</li> <li>Form views: Long forms where users scroll while filling fields</li> <li>Any scrollable container: When scroll position should persist across state changes</li> </ul>"},{"location":"state/#api","title":"API","text":"<pre><code>scroll = ScrollState()        # Create with position (0, 0)\nscroll = ScrollState(x=0, y=100)  # Create with specific position\n\n# Get current position\nx = scroll.x\ny = scroll.y\n\n# Set position\nscroll.set(x=0, y=200)\nscroll.set(y=50)  # Only change y\n</code></pre>"},{"location":"state/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Use <code>model()</code> for single state: Simple components with one state source.</p> </li> <li> <p>Use <code>attach()</code> for multiple states: When multiple states should trigger rebuilds.</p> </li> <li> <p>Avoid attaching Input's state: Don't attach states managed by Input widget - it causes focus loss on every keystroke:</p> <pre><code># DON'T do this - causes focus issues\nself._text = State(\"\")\nself._text.attach(self)  # Bad!\n\n# DO this instead - let Input manage internally\ndef view(self):\n    return Input(self._text()).on_change(lambda t: self._text.set(t))\n</code></pre> </li> <li> <p>Use operators for numeric states: <code>count += 1</code> is cleaner than <code>count.set(count() + 1)</code>.</p> </li> <li> <p>Use <code>set()</code> for atomic list updates: When shuffling or replacing all items, use <code>set()</code> instead of <code>clear()</code> + multiple <code>append()</code>:</p> <pre><code># DON'T do this - triggers multiple rebuilds\nitems.clear()\nfor item in new_items:\n    items.append(item)\n\n# DO this instead - single rebuild\nitems.set(new_items)\n</code></pre> </li> </ol>"},{"location":"state/#widget-lifecycle-hooks","title":"Widget Lifecycle Hooks","text":"<p>Widgets can override <code>on_mount()</code> and <code>on_unmount()</code> to perform setup and cleanup when added to or removed from the widget tree.</p>"},{"location":"state/#on_mount-on_unmount","title":"on_mount / on_unmount","text":"<pre><code>from castella import Widget\n\nclass TimerWidget(Widget):\n    def on_mount(self):\n        \"\"\"Called when widget is added to the tree.\"\"\"\n        self._timer = start_timer(self._tick)\n\n    def on_unmount(self):\n        \"\"\"Called when widget is removed from the tree.\"\"\"\n        self._timer.stop()\n\n    def is_mounted(self) -&gt; bool:\n        \"\"\"Check if currently in the tree.\"\"\"\n        return self._mounted\n</code></pre>"},{"location":"state/#use-cases","title":"Use Cases","text":"<ul> <li>Starting/stopping timers: Begin background tasks when mounted, stop when unmounted</li> <li>Subscribing to events: Subscribe on mount, unsubscribe on unmount</li> <li>Resource management: Acquire resources on mount, release on unmount</li> </ul>"},{"location":"state/#state-preservation-with-caching","title":"State Preservation with Caching","text":"<p>When a <code>Component.view()</code> is called, widgets are normally recreated. This can cause loss of internal state like timer counts, scroll positions, or animation progress. Castella provides caching APIs to preserve widget state across rebuilds.</p>"},{"location":"state/#liststatemap_cached","title":"ListState.map_cached()","text":"<p>Use <code>map_cached()</code> to create widgets from list items while preserving their state:</p> <pre><code>from castella import Column, Component, ListState\n\nclass TodoList(Component):\n    def __init__(self):\n        super().__init__()\n        self._items = ListState([...])\n        self._items.attach(self)\n\n    def view(self):\n        # Widgets are cached by item.id - state is preserved!\n        timer_widgets = self._items.map_cached(\n            lambda item: TimerWidget(item.id, item.name)\n        )\n        return Column(*timer_widgets)\n</code></pre> <p>Key features:</p> <ul> <li>Widgets are cached by <code>item.id</code> (or hash, or <code>id()</code>)</li> <li>Reused widgets keep their internal state (timers, counts, etc.)</li> <li>Removed items automatically trigger <code>on_unmount()</code></li> <li>New items create new widgets with <code>on_mount()</code> called</li> </ul> <p>Custom key function:</p> <pre><code># Use a custom key extraction function\nwidgets = self._items.map_cached(\n    factory=lambda item: MyWidget(item),\n    key_fn=lambda item: item.uuid,  # Use custom key\n)\n</code></pre>"},{"location":"state/#componentcache","title":"Component.cache()","text":"<p>Alternative API that identifies caches by source code location:</p> <pre><code>class MyComponent(Component):\n    def view(self):\n        # Cache identified by file + line number\n        widgets = self.cache(\n            self._items,\n            lambda item: TimerWidget(item.id, item.name),\n        )\n        return Column(*widgets)\n</code></pre> <p>When to use which:</p> <ul> <li><code>ListState.map_cached()</code>: Simpler API, cache lives on the ListState</li> <li><code>Component.cache()</code>: Allows multiple caches in same view(), cache lives on Component</li> </ul>"},{"location":"state/#example-shuffle-with-state-preservation","title":"Example: Shuffle with State Preservation","text":"<pre><code>from dataclasses import dataclass\nfrom castella import App, Button, Column, Component, ListState, Row\nfrom castella.frame import Frame\n\n@dataclass\nclass Item:\n    id: int\n    name: str\n\nclass ShuffleDemo(Component):\n    def __init__(self):\n        super().__init__()\n        self._items = ListState([Item(1, \"A\"), Item(2, \"B\"), Item(3, \"C\")])\n        self._items.attach(self)\n\n    def _shuffle(self, _):\n        import random\n        items = list(self._items)\n        random.shuffle(items)\n        self._items.set(items)  # Atomic update\n\n    def view(self):\n        widgets = self._items.map_cached(lambda i: TimerWidget(i.id, i.name))\n        return Column(\n            Button(\"Shuffle\").on_click(self._shuffle),\n            *[Row(w) for w in widgets],\n        )\n\nApp(Frame(\"Demo\", 400, 300), ShuffleDemo()).run()\n</code></pre> <p>When shuffled, timer widgets maintain their counts because the same widget instances are reused.</p>"},{"location":"studio/","title":"Workflow Studio Samples","text":"<p>Castella includes sample applications demonstrating visual development environments for popular AI workflow frameworks. These serve as references for building your own workflow visualization tools.</p> <p>Sample Applications</p> <p>These are demonstration applications located in <code>examples/</code>. They showcase what's possible with Castella's graph visualization capabilities and can serve as a starting point for your own tools.</p>"},{"location":"studio/#available-samples","title":"Available Samples","text":"Sample Framework Description <code>langgraph_studio/</code> LangGraph Visual development environment for LangGraph <code>llamaindex_studio/</code> LlamaIndex Workflows Workflow visualization and execution <code>pydantic_graph_studio/</code> pydantic-graph Graph visualization and step-by-step execution <code>edda_workflow_manager/</code> Edda + LlamaIndex Workflows Workflow management with execution history"},{"location":"studio/#langgraph-studio","title":"LangGraph Studio","text":"<p>A visual development environment for LangGraph.</p> <p>Features:</p> <ul> <li>Graph structure visualization with automatic layout</li> <li>Step-by-step execution with state inspection</li> <li>File browser for loading graph definitions</li> <li>Zoom and pan controls</li> </ul> <p>Usage:</p> <pre><code># Run with file browser\nuv run python -m examples.langgraph_studio.main\n\n# Load a specific file on startup\nuv run python -m examples.langgraph_studio.main path/to/graph.py\n\n# Browse a specific directory\nuv run python -m examples.langgraph_studio.main ./my_graphs/\n</code></pre>"},{"location":"studio/#llamaindex-workflow-studio","title":"LlamaIndex Workflow Studio","text":"<p>A visual studio for LlamaIndex Workflows.</p> <p>Features:</p> <ul> <li>Workflow structure visualization</li> <li>Breakpoint support</li> <li>Execution history tracking</li> <li>Step details modal</li> </ul> <p>Usage:</p> <pre><code># Run with sample workflows\nuv run python examples/llamaindex_studio/main.py\n\n# Load a specific workflow file\nuv run python examples/llamaindex_studio/main.py path/to/workflow.py\n</code></pre>"},{"location":"studio/#pydantic-graph-studio","title":"pydantic-graph Studio","text":"<p>A visual studio for pydantic-graph.</p> <p>Features:</p> <ul> <li>Graph structure visualization from Python files</li> <li>Step-by-step graph execution</li> <li>Breakpoints and state inspection</li> <li>Execution history view</li> <li>Mock graph for testing without dependencies</li> </ul> <p>Usage:</p> <pre><code># Run with mock graph (no pydantic-graph required)\nuv run python -m examples.pydantic_graph_studio.main\n\n# Load a specific Python file\nuv run python -m examples.pydantic_graph_studio.main path/to/graph.py\n\n# Browse a specific directory\nuv run python -m examples.pydantic_graph_studio.main --path ./my_graphs/\n</code></pre>"},{"location":"studio/#edda-workflow-manager","title":"Edda Workflow Manager","text":"<p>A management GUI for Edda with LlamaIndex Workflows integration.</p> <p>Features:</p> <ul> <li>Workflow visualization</li> <li>Execution history browsing</li> <li>Live execution monitoring</li> <li>Multiple execution modes (direct, CloudEvent)</li> </ul> <p>Usage:</p> <pre><code># Read-only mode (view execution history)\nuv run python examples/edda_workflow_manager/main.py \\\n    --db sqlite+aiosqlite:///path/to/edda.db\n\n# Direct execution mode (import and run workflows)\nuv run python examples/edda_workflow_manager/main.py \\\n    --db sqlite+aiosqlite:///path/to/edda.db \\\n    --import-module my_app.workflows\n\n# CloudEvent mode (send to external Edda server)\nuv run python examples/edda_workflow_manager/main.py \\\n    --db sqlite+aiosqlite:///path/to/edda.db \\\n    --edda-url http://localhost:8001\n\n# Both modes (user can choose)\nuv run python examples/edda_workflow_manager/main.py \\\n    --db sqlite+aiosqlite:///path/to/edda.db \\\n    --import-module my_app.workflows \\\n    --edda-url http://localhost:8001\n</code></pre>"},{"location":"studio/#shared-infrastructure","title":"Shared Infrastructure","text":"<p>These samples share common infrastructure from <code>castella/studio/</code>:</p> <ul> <li><code>BaseWorkflowExecutor</code> - Abstract executor with threading support</li> <li><code>Toolbar</code> - Run/pause/step/zoom controls</li> <li><code>StatusBar</code> - Execution status display</li> <li><code>FilePanel</code> - File browser panel</li> <li><code>ContentViewerModal</code> - Docstring/source code viewer</li> </ul> <p>You can use these components to build your own workflow visualization tools.</p>"},{"location":"studio/#graph-visualization","title":"Graph Visualization","text":"<p>The samples use Castella's graph visualization system (<code>castella/graph/</code>):</p> <ul> <li><code>GraphModel</code> - Data model for nodes and edges</li> <li><code>GraphCanvas</code> - Interactive canvas with zoom/pan</li> <li><code>SugiyamaLayout</code> - Automatic layered graph layout</li> <li><code>GraphTheme</code> - Visual styling (dark/light themes)</li> </ul>"},{"location":"style/","title":"Styling","text":"<p>Castella provides a comprehensive theming system with design tokens (colors, typography, spacing) and per-widget styling options.</p>"},{"location":"style/#theme-system","title":"Theme System","text":"<p>The theme system is located in <code>castella.theme</code> and provides:</p> <ul> <li>ColorPalette: All color definitions (backgrounds, text, borders)</li> <li>Typography: Font settings (family, size, scale)</li> <li>Spacing: Layout measurements (padding, margin, border radius)</li> <li>ThemeManager: Singleton for dynamic theme switching</li> </ul>"},{"location":"style/#automatic-theming","title":"Automatic Theming","text":"<p>Castella automatically detects dark/light mode from the operating system and applies appropriate colors.</p>"},{"location":"style/#built-in-themes","title":"Built-in Themes","text":"<p>Castella includes several professionally designed themes:</p> Theme Style Border Radius Font Tokyo Night (default) Purple/blue aesthetic 6px JetBrains Mono Cupertino Apple-inspired design 8px SF Pro / Helvetica Neue Material Design 3 Google's Material design 12px Roboto Castella Dark Neon colors on dark 0px System default Castella Light Soft pastels on light 0px System default"},{"location":"style/#environment-variables","title":"Environment Variables","text":"<p>Override the automatic theme detection:</p> Variable Values Description <code>CASTELLA_DARK_MODE</code> <code>true</code> / <code>false</code> Force dark or light mode <code>CASTELLA_FONT_SIZE</code> Integer (e.g., <code>14</code>) Override default font size <pre><code># Force dark mode\nCASTELLA_DARK_MODE=true python my_app.py\n\n# Use larger font\nCASTELLA_FONT_SIZE=18 python my_app.py\n</code></pre>"},{"location":"style/#using-thememanager","title":"Using ThemeManager","text":""},{"location":"style/#get-current-theme","title":"Get Current Theme","text":"<pre><code>from castella.theme import ThemeManager\n\nmanager = ThemeManager()\ntheme = manager.current\n\nprint(f\"Theme: {theme.name}\")\nprint(f\"Is dark: {theme.is_dark}\")\nprint(f\"Background: {theme.colors.bg_canvas}\")\n</code></pre>"},{"location":"style/#toggle-darklight-mode","title":"Toggle Dark/Light Mode","text":"<pre><code>from castella import Button\nfrom castella.theme import ThemeManager\n\nmanager = ThemeManager()\n\n# Toggle button\nButton(\"Toggle Theme\").on_click(lambda _: manager.toggle_dark_mode())\n</code></pre>"},{"location":"style/#force-dark-or-light-mode","title":"Force Dark or Light Mode","text":"<pre><code># Force dark mode\nmanager.prefer_dark(True)\n\n# Force light mode\nmanager.prefer_dark(False)\n\n# Return to automatic detection\nmanager.prefer_dark(None)\n</code></pre>"},{"location":"style/#using-different-built-in-themes","title":"Using Different Built-in Themes","text":"<pre><code>from castella.theme import (\n    ThemeManager,\n    CUPERTINO_DARK_THEME, CUPERTINO_LIGHT_THEME,\n    MATERIAL_DARK_THEME, MATERIAL_LIGHT_THEME,\n    TOKYO_NIGHT_DARK_THEME, TOKYO_NIGHT_LIGHT_THEME,\n    DARK_THEME, LIGHT_THEME,  # Classic Castella themes\n)\n\nmanager = ThemeManager()\n\n# Use Material Design theme\nmanager.set_dark_theme(MATERIAL_DARK_THEME)\nmanager.set_light_theme(MATERIAL_LIGHT_THEME)\n\n# Or Cupertino (Apple-style) theme\nmanager.set_dark_theme(CUPERTINO_DARK_THEME)\nmanager.set_light_theme(CUPERTINO_LIGHT_THEME)\n</code></pre>"},{"location":"style/#custom-themes","title":"Custom Themes","text":""},{"location":"style/#derive-from-existing-theme","title":"Derive from Existing Theme","text":"<p>The easiest way to customize is using <code>Theme.derive()</code> for partial overrides:</p> <pre><code>from castella.theme import ThemeManager, DARK_THEME\n\n# Override just a few colors\ncustom = DARK_THEME.derive(\n    colors={\n        \"border_primary\": \"#00ff00\",  # Green borders\n        \"text_info\": \"#00ffff\",       # Cyan info text\n        \"bg_overlay\": \"#ff6b6b\",      # Custom hover color\n    },\n    typography={\n        \"base_size\": 16,              # Larger font\n    },\n)\n\nmanager = ThemeManager()\nmanager.set_dark_theme(custom)\n</code></pre>"},{"location":"style/#create-complete-custom-theme","title":"Create Complete Custom Theme","text":"<p>For full control, create a new <code>ColorPalette</code>:</p> <pre><code>from castella.theme import (\n    Theme,\n    ColorPalette,\n    Typography,\n    Spacing,\n    ThemeManager,\n)\n\n# Cyberpunk theme\ncyberpunk_palette = ColorPalette(\n    # Backgrounds\n    bg_canvas=\"#0a0a0a\",\n    bg_primary=\"#0a0a0a\",\n    bg_secondary=\"#121212\",\n    bg_tertiary=\"#1a1a2e\",\n    bg_overlay=\"#00ff41\",\n    bg_info=\"#0a0a0a\",\n    bg_danger=\"#0a0a0a\",\n    bg_success=\"#0a0a0a\",\n    bg_warning=\"#0a0a0a\",\n    bg_pushed=\"#1a1a2e\",\n    bg_selected=\"#00ff41\",\n    # Text\n    fg=\"#00ff41\",\n    text_primary=\"#00ff41\",\n    text_info=\"#00d4ff\",\n    text_danger=\"#ff0055\",\n    text_success=\"#00ff41\",\n    text_warning=\"#ffff00\",\n    # Borders\n    border_primary=\"#00ff41\",\n    border_secondary=\"#00d4ff\",\n    border_info=\"#00d4ff\",\n    border_danger=\"#ff0055\",\n    border_success=\"#00ff41\",\n    border_warning=\"#ffff00\",\n)\n\ncyberpunk_theme = Theme(\n    name=\"cyberpunk\",\n    is_dark=True,\n    colors=cyberpunk_palette,\n    typography=Typography(base_size=14),\n    spacing=Spacing(),\n    code_pygments_style=\"monokai\",\n)\n\nmanager = ThemeManager()\nmanager.set_dark_theme(cyberpunk_theme)\nmanager.prefer_dark(True)\n</code></pre>"},{"location":"style/#widget-kinds","title":"Widget Kinds","text":"<p>Many widgets support the <code>kind</code> parameter for semantic coloring:</p> <pre><code>from castella import Text, Button, Kind\n\n# Text with different kinds\nText(\"Normal text\", kind=Kind.NORMAL)   # Default styling\nText(\"Info message\", kind=Kind.INFO)    # Cyan/blue tones\nText(\"Success!\", kind=Kind.SUCCESS)     # Green tones\nText(\"Warning!\", kind=Kind.WARNING)     # Yellow/amber tones\nText(\"Error!\", kind=Kind.DANGER)        # Red/pink tones\n\n# Buttons with different kinds\nButton(\"Normal\", kind=Kind.NORMAL)      # Default button\nButton(\"Info\", kind=Kind.INFO)          # Info-styled button\nButton(\"Success\", kind=Kind.SUCCESS)    # Success-styled button\nButton(\"Warning\", kind=Kind.WARNING)    # Warning-styled button\nButton(\"Danger\", kind=Kind.DANGER)      # Danger-styled button\n\n# Fluent API also works\nButton(\"Delete\").kind(Kind.DANGER)\n</code></pre>"},{"location":"style/#available-kinds","title":"Available Kinds","text":"Kind Use Case Dark Theme Colors <code>Kind.NORMAL</code> Default content Light gray text <code>Kind.INFO</code> Informational messages Neon cyan <code>Kind.SUCCESS</code> Success states Neon green <code>Kind.WARNING</code> Warnings, caution Neon yellow <code>Kind.DANGER</code> Errors, destructive actions Neon red"},{"location":"style/#per-widget-styling","title":"Per-Widget Styling","text":""},{"location":"style/#background-and-text-colors","title":"Background and Text Colors","text":"<p>Override colors on individual widgets:</p> <pre><code># Custom background color\nText(\"Custom\").bg_color(\"#ff0000\")\n\n# Custom text color\nText(\"Custom\").text_color(\"#ffffff\")\n\n# Both\nText(\"Custom\").bg_color(\"#1a1a2e\").text_color(\"#eee\")\n</code></pre>"},{"location":"style/#border-styling","title":"Border Styling","text":"<pre><code># Set border color\nwidget.border_color(\"#ff00ff\")\n\n# Show border with theme's default color (or custom color)\nwidget.show_border()              # Use theme's default border color\nwidget.show_border(\"#ff00ff\")     # Use custom color\n\n# Make border match background (effectively hides it)\nwidget.erase_border()\n</code></pre>"},{"location":"style/#text-alignment","title":"Text Alignment","text":"<p>Control text alignment within widgets:</p> <pre><code>from castella import Text\nfrom castella.models.style import TextAlign\n\nText(\"Left aligned\", align=TextAlign.LEFT)\nText(\"Centered\", align=TextAlign.CENTER)   # Default\nText(\"Right aligned\", align=TextAlign.RIGHT)\n</code></pre>"},{"location":"style/#design-tokens-reference","title":"Design Tokens Reference","text":""},{"location":"style/#colorpalette-properties","title":"ColorPalette Properties","text":"Property Description <code>bg_canvas</code> Main application background <code>bg_primary</code> Primary widget background <code>bg_secondary</code> Secondary widget background <code>bg_tertiary</code> Tertiary/accent background <code>bg_overlay</code> Overlay/hover background <code>bg_pushed</code> Button pressed state <code>bg_selected</code> Selected item background <code>bg_info</code> Info kind background <code>bg_danger</code> Danger kind background <code>bg_success</code> Success kind background <code>bg_warning</code> Warning kind background <code>fg</code> Default foreground <code>text_primary</code> Primary text <code>text_info</code> Info kind text <code>text_danger</code> Danger kind text <code>text_success</code> Success kind text <code>text_warning</code> Warning kind text <code>border_primary</code> Primary border <code>border_secondary</code> Secondary border <code>border_info</code> Info kind border <code>border_danger</code> Danger kind border <code>border_success</code> Success kind border <code>border_warning</code> Warning kind border"},{"location":"style/#typography-properties","title":"Typography Properties","text":"Property Default Description <code>font_family</code> <code>\"\"</code> (system) Font family name <code>font_family_mono</code> <code>\"monospace\"</code> Monospace font for code <code>base_size</code> <code>14</code> Base font size in pixels <code>scale_ratio</code> <code>1.25</code> Ratio for heading size calculation <p>Use <code>typography.heading_size(level)</code> to get computed heading sizes.</p>"},{"location":"style/#spacing-properties","title":"Spacing Properties","text":"Property Default Description <code>padding_sm</code> <code>4</code> Small padding <code>padding_md</code> <code>8</code> Medium padding <code>padding_lg</code> <code>16</code> Large padding <code>margin_sm</code> <code>4</code> Small margin <code>margin_md</code> <code>8</code> Medium margin <code>margin_lg</code> <code>16</code> Large margin <code>border_radius</code> <code>4</code> Border corner radius <code>border_width</code> <code>1.0</code> Border line width"},{"location":"style/#built-in-theme-colors","title":"Built-in Theme Colors","text":""},{"location":"style/#tokyo-night-default","title":"Tokyo Night (Default)","text":"<pre><code># Dark variant\n{\n    \"bg_canvas\": \"#1a1b26\",      # Deep blue-black\n    \"fg\": \"#c0caf5\",             # Light purple-white\n    \"text_info\": \"#7dcfff\",      # Cyan\n    \"text_danger\": \"#f7768e\",    # Red\n    \"text_success\": \"#9ece6a\",   # Green\n    \"text_warning\": \"#e0af68\",   # Yellow\n    \"border_primary\": \"#565f89\", # Muted purple\n}\n</code></pre>"},{"location":"style/#material-design-3","title":"Material Design 3","text":"<pre><code># Dark variant\n{\n    \"bg_canvas\": \"#121212\",      # Material dark surface\n    \"fg\": \"#e1e1e1\",             # On-surface\n    \"text_info\": \"#82b1ff\",      # Light blue\n    \"text_danger\": \"#cf6679\",    # Error\n    \"text_success\": \"#81c784\",   # Light green\n    \"text_warning\": \"#ffb74d\",   # Orange\n    \"border_primary\": \"#444444\", # Outline\n}\n</code></pre>"},{"location":"style/#cupertino-apple-style","title":"Cupertino (Apple-style)","text":"<pre><code># Dark variant\n{\n    \"bg_canvas\": \"#1e1e1e\",      # Window background\n    \"fg\": \"#ffffff\",             # Primary label\n    \"text_info\": \"#64d2ff\",      # System Cyan\n    \"text_danger\": \"#ff6961\",    # System Red\n    \"text_success\": \"#30d158\",   # System Green\n    \"text_warning\": \"#ffd60a\",   # System Yellow\n    \"border_primary\": \"#48484a\", # Separator\n}\n</code></pre>"},{"location":"style/#example-theme-demos","title":"Example: Theme Demos","text":"<p>Run the theme demos to see all features in action:</p> <pre><code># Tokyo Night theme demo (default)\nuv run python examples/tokyo_night_theme_demo.py\n\n# Cupertino (Apple-style) theme demo\nuv run python examples/cupertino_theme_demo.py\n\n# Material Design 3 theme demo\nuv run python examples/material_theme_demo.py\n</code></pre> <p>These examples demonstrate:</p> <ul> <li>Dark/light mode toggle</li> <li>Theme switching between different styles</li> <li>Button Kind variants (Normal, Info, Success, Warning, Danger)</li> <li>Rounded corners and modern UI aesthetics</li> <li>Typography and spacing information display</li> </ul>"},{"location":"widgets/","title":"Built-in Widgets","text":"<p>Castella provides a variety of built-in widgets for creating user interfaces.</p>"},{"location":"widgets/#common-widget-methods","title":"Common Widget Methods","text":"<p>All widgets support these common methods for customization:</p>"},{"location":"widgets/#sizing","title":"Sizing","text":"<pre><code>widget.fixed_size(width, height)  # Fixed dimensions\nwidget.fixed_width(width)         # Fixed width only\nwidget.fixed_height(height)       # Fixed height only\nwidget.flex(n)                    # Flex ratio in layouts\nwidget.fit_content()              # Size to content\nwidget.fit_parent()               # Fill parent\n</code></pre>"},{"location":"widgets/#styling","title":"Styling","text":"<pre><code>widget.bg_color(\"#ff0000\")        # Background color\nwidget.text_color(\"#ffffff\")      # Text color\nwidget.border_color(\"#000000\")    # Border color\nwidget.show_border()              # Show border with theme's default color\nwidget.erase_border()             # Hide border\n</code></pre>"},{"location":"widgets/#layering","title":"Layering","text":"<pre><code>widget.z_index(n)                 # Stacking order (default: 1)\n</code></pre> <p>See Z-Index and Layering for details.</p>"},{"location":"widgets/#button","title":"Button","text":"<p>Interactive button widget with click handling.</p> <pre><code>App(\n    Frame(\"Button\"),\n    Row(\n        Column(\n            Button(\"First\"),\n            Button(\"Second\", align=TextAlign.CENTER),\n            Button(\"Third\", align=TextAlign.RIGHT),\n            Button(\"Fourth\", align=TextAlign.LEFT),\n        ).spacing(10)\n    ).spacing(10),\n).run()\n</code></pre>"},{"location":"widgets/#click-handling","title":"Click Handling","text":"<pre><code>Button(\"Click me\").on_click(lambda event: print(\"Clicked!\"))\n</code></pre>"},{"location":"widgets/#text","title":"Text","text":"<p>Display text with various styles and alignments.</p> <pre><code>App(\n    Frame(\"Text\"),\n    Row(\n        Column(\n            Text(\"First\", kind=Kind.NORMAL),\n            Text(\"Second\", kind=Kind.INFO, align=TextAlign.CENTER),\n            Text(\"Third\", kind=Kind.SUCCESS, align=TextAlign.RIGHT),\n            Text(\"Fourth\", kind=Kind.WARNING, align=TextAlign.LEFT),\n            Text(\"Fifth\", kind=Kind.DANGER, align=TextAlign.LEFT),\n        ).spacing(10)\n    ).spacing(10),\n).run()\n</code></pre>"},{"location":"widgets/#font-size","title":"Font Size","text":"<pre><code>Text(\"Large text\", font_size=24)\nText(\"Small text\", font_size=12)\n</code></pre>"},{"location":"widgets/#multilinetext","title":"MultilineText","text":"<p>Display multi-line text content with text selection support.</p> <pre><code>MultilineText(\n    \"Line 1\\nLine 2\\nLine 3\",\n    font_size=16,\n    wrap=True  # Enable text wrapping\n)\n</code></pre>"},{"location":"widgets/#features","title":"Features","text":"<ul> <li>Line wrapping with <code>wrap=True</code></li> <li>Mouse drag to select text</li> <li>Cmd+C / Ctrl+C to copy selected text</li> <li>Cmd+A / Ctrl+A to select all</li> </ul>"},{"location":"widgets/#input","title":"Input","text":"<p>Text input field for user input.</p> <pre><code>from castella import Input, State\n\ntext = State(\"\")\n\nInput(text()).on_change(lambda t: text.set(t))\n</code></pre> <p>Input and State</p> <p>Don't attach Input's state to the component - it causes focus loss on every keystroke. See State Management for details.</p>"},{"location":"widgets/#multilineinput","title":"MultilineInput","text":"<p>Multi-line text editor with scrolling support.</p> <pre><code>from castella import MultilineInput, MultilineInputState\n\n# Basic usage\neditor = MultilineInput(\"Initial text\", font_size=14)\n\n# With state for reactive updates\nstate = MultilineInputState(\"Hello\\nWorld\")\neditor = MultilineInput(state, font_size=14, wrap=True)\n\n# With change callback\neditor = MultilineInput(\"\", font_size=14).on_change(lambda text: print(text))\n\n# With fixed height (enables vertical scrolling)\neditor = MultilineInput(state, font_size=14, wrap=True).fixed_height(200)\n</code></pre>"},{"location":"widgets/#features_1","title":"Features","text":"<ul> <li>Line wrapping with <code>wrap=True</code></li> <li>Vertical scrolling when content exceeds height</li> <li>Mouse wheel scrolling</li> <li>Click to position cursor</li> <li>Scrollbar thumb dragging</li> <li>Auto-scroll to keep cursor visible</li> <li>Mouse drag to select text</li> <li>Cmd+C / Ctrl+C to copy selected text</li> <li>Cmd+X / Ctrl+X to cut selected text</li> <li>Cmd+V / Ctrl+V to paste from clipboard</li> <li>Cmd+A / Ctrl+A to select all</li> </ul> <p>MultilineInput and State</p> <p>Don't attach MultilineInput's state to the component - it causes focus loss on every keystroke. See State Management for details.</p>"},{"location":"widgets/#markdown","title":"Markdown","text":"<p>Rich markdown text rendering with syntax highlighting.</p> <pre><code>from castella import Markdown\n\nmd = Markdown(\"\"\"\n# Heading\n\n**Bold** and *italic* text.\n\n```python\ndef hello():\n    print(\"Hello!\")\n```\n\"\"\", base_font_size=14)\n\n# With link click handler\nimport webbrowser\nmd = Markdown(content, on_link_click=lambda url: webbrowser.open(url))\n</code></pre>"},{"location":"widgets/#supported-features","title":"Supported Features","text":"<ul> <li>Headings (H1-H6)</li> <li>Text formatting: bold, italic, strikethrough</li> <li>Ordered and unordered lists</li> <li>Code blocks with syntax highlighting</li> <li>Inline code</li> <li>Tables</li> <li>Blockquotes</li> <li>Links with click handling</li> <li>LaTeX math expressions (<code>$E=mc^2$</code>)</li> <li>Horizontal rules</li> </ul>"},{"location":"widgets/#parameters","title":"Parameters","text":"Parameter Type Default Description <code>content</code> str required Markdown content <code>base_font_size</code> int 14 Base font size <code>code_theme</code> str \"monokai\" Pygments theme for code <code>enable_math</code> bool True Enable LaTeX math <code>on_link_click</code> callable None Link click callback"},{"location":"widgets/#switch","title":"Switch","text":"<p>Toggle switch for boolean values.</p> <pre><code>App(\n    Frame(\"Switch\"),\n    Switch(True),\n).run()\n</code></pre>"},{"location":"widgets/#state-binding","title":"State Binding","text":"<pre><code>enabled = State(False)\n\nSwitch(enabled()).on_change(lambda v: enabled.set(v))\n</code></pre>"},{"location":"widgets/#checkbox","title":"CheckBox","text":"<p>Checkbox for boolean selections.</p> <pre><code>from castella import CheckBox, State\n\nchecked = State(False)\n\nCheckBox(\"Enable feature\", checked()).on_change(lambda v: checked.set(v))\n</code></pre>"},{"location":"widgets/#radiobuttons","title":"RadioButtons","text":"<p>Radio button group for single selection from multiple options.</p> <pre><code>from castella import RadioButtons, State\n\nselected = State(0)\n\nRadioButtons(\n    [\"Option A\", \"Option B\", \"Option C\"],\n    selected()\n).on_change(lambda i: selected.set(i))\n</code></pre>"},{"location":"widgets/#slider","title":"Slider","text":"<p>Range input widget for numeric values.</p> <pre><code>from castella import Slider, SliderState\n\n# Basic usage\nslider = Slider(value=50, min_val=0, max_val=100)\nslider.on_change(lambda v: print(f\"Value: {v}\"))\n\n# With state for reactive updates\nstate = SliderState(value=25, min_val=0, max_val=100)\nslider = Slider(state)\n\n# Access value\nprint(state.value())   # 25\nprint(state.ratio())   # 0.25 (normalized 0-1)\nstate.set(75)          # Set new value\n</code></pre>"},{"location":"widgets/#parameters_1","title":"Parameters","text":"Parameter Type Default Description <code>value</code> or <code>state</code> int/float or SliderState required Initial value or state <code>min_val</code> int/float 0 Minimum value <code>max_val</code> int/float 100 Maximum value <code>kind</code> Kind NORMAL Visual style"},{"location":"widgets/#progressbar","title":"ProgressBar","text":"<p>Animated progress indicator for displaying progress values.</p> <pre><code>from castella import ProgressBar, ProgressBarState\n\n# Basic usage\nprogress = ProgressBar(value=50, min_val=0, max_val=100)\n\n# With state for dynamic updates\nstate = ProgressBarState(value=0, min_val=0, max_val=100)\nprogress = ProgressBar(state)\n\n# Custom colors\nprogress = (\n    ProgressBar(state)\n    .track_color(\"#1a1b26\")\n    .fill_color(\"#9ece6a\")\n    .border_radius(4)\n    .fixed_height(24)\n)\n\n# Update progress\nstate.set(75)\n</code></pre>"},{"location":"widgets/#animation-example","title":"Animation Example","text":"<pre><code>from castella.animation import ValueTween, AnimationScheduler, EasingFunction\n\ndef animate_progress(state):\n    state.set(0)\n    AnimationScheduler.get().add(\n        ValueTween(\n            from_value=0,\n            to_value=100,\n            duration_ms=1000,\n            easing=EasingFunction.EASE_OUT_CUBIC,\n            on_update=lambda v: state.set(v),\n        )\n    )\n</code></pre>"},{"location":"widgets/#parameters_2","title":"Parameters","text":"Parameter Type Default Description <code>value</code> or <code>state</code> float or ProgressBarState required Initial value or state <code>min_val</code> float 0 Minimum value <code>max_val</code> float 100 Maximum value <code>show_text</code> bool False Show percentage text"},{"location":"widgets/#customization-methods","title":"Customization Methods","text":"Method Description <code>.track_color(color)</code> Set background track color <code>.fill_color(color)</code> Set fill (progress) color <code>.border_radius(radius)</code> Set corner radius <code>.show_text(bool)</code> Show/hide percentage text"},{"location":"widgets/#tabs","title":"Tabs","text":"<p>Tabbed navigation widget for organizing content.</p> <pre><code>from castella import Tabs, TabsState, TabItem, Text\n\n# Create tabs with TabsState\ntabs_state = TabsState([\n    TabItem(id=\"home\", label=\"Home\", content=Text(\"Home content\")),\n    TabItem(id=\"settings\", label=\"Settings\", content=Text(\"Settings content\")),\n], selected_id=\"home\")\n\ntabs = Tabs(tabs_state).on_change(lambda id: print(f\"Tab: {id}\"))\n\n# Or use fluent API\ntabs = (\n    Tabs()\n    .add_tab(\"home\", \"Home\", Text(\"Home content\"))\n    .add_tab(\"settings\", \"Settings\", Text(\"Settings content\"))\n)\n\n# Programmatic selection\ntabs_state.select(\"settings\")\n</code></pre>"},{"location":"widgets/#parameters_3","title":"Parameters","text":"Parameter Type Default Description <code>state</code> TabsState None Tabs state with items <code>tab_height</code> int 40 Height of tab bar"},{"location":"widgets/#tabitem-fields","title":"TabItem Fields","text":"Field Type Description <code>id</code> str Unique tab identifier <code>label</code> str Tab button label <code>content</code> Widget Content widget"},{"location":"widgets/#tree","title":"Tree","text":"<p>Hierarchical tree widget for displaying nested data structures.</p> <pre><code>from castella import Tree, TreeState, TreeNode\n\n# Create tree data\nnodes = [\n    TreeNode(id=\"docs\", label=\"Documents\", icon=\"\ud83d\udcc1\", children=[\n        TreeNode(id=\"readme\", label=\"README.md\", icon=\"\ud83d\udcc4\"),\n        TreeNode(id=\"license\", label=\"LICENSE\", icon=\"\ud83d\udcc4\"),\n    ]),\n    TreeNode(id=\"src\", label=\"Source\", icon=\"\ud83d\udcc1\", children=[\n        TreeNode(id=\"main\", label=\"main.py\", icon=\"\ud83d\udc0d\"),\n    ]),\n]\n\n# Create tree widget\nstate = TreeState(nodes, multi_select=False)\ntree = Tree(state).on_select(lambda node: print(f\"Selected: {node.label}\"))\n\n# Programmatic control\ntree.expand_all()\ntree.collapse_all()\nstate.expand_to(\"main\")  # Expand ancestors to reveal node\nstate.select(\"main\")\n</code></pre>"},{"location":"widgets/#treenode-fields","title":"TreeNode Fields","text":"Field Type Description <code>id</code> str Unique node identifier <code>label</code> str Display text <code>children</code> list[TreeNode] Child nodes <code>icon</code> str | None Custom icon (emoji) <code>data</code> Any Optional user data"},{"location":"widgets/#treestate-methods","title":"TreeState Methods","text":"Method Description <code>expand(node_id)</code> Expand a node <code>collapse(node_id)</code> Collapse a node <code>toggle_expanded(node_id)</code> Toggle expand/collapse <code>expand_all()</code> Expand all nodes <code>collapse_all()</code> Collapse all nodes <code>expand_to(node_id)</code> Expand ancestors to reveal node <code>select(node_id)</code> Select a node <code>deselect(node_id)</code> Deselect a node <code>clear_selection()</code> Clear all selections <code>get_selected()</code> Get selected nodes <code>set_multi_select(bool)</code> Enable/disable multi-select"},{"location":"widgets/#tree-callbacks","title":"Tree Callbacks","text":"Method Description <code>on_select(callback)</code> Called when node is selected <code>on_expand(callback)</code> Called when node is expanded <code>on_collapse(callback)</code> Called when node is collapsed"},{"location":"widgets/#filetree","title":"FileTree","text":"<p>File system browser widget built on Tree.</p> <pre><code>from castella import FileTree, FileTreeState\nfrom pathlib import Path\n\n# Create file tree from directory\nstate = FileTreeState(\n    root_path=\".\",\n    show_hidden=False,\n    dirs_first=True\n)\n\nfile_tree = (\n    FileTree(state)\n    .on_file_select(lambda path: print(f\"File: {path}\"))\n    .on_dir_select(lambda path: print(f\"Dir: {path}\"))\n)\n\n# Toggle hidden files\nstate.set_show_hidden(True)\n\n# Refresh from file system\nstate.refresh()\n\n# Get selected paths\npaths = file_tree.get_selected_paths()\n</code></pre>"},{"location":"widgets/#filetreestate-parameters","title":"FileTreeState Parameters","text":"Parameter Type Default Description <code>root_path</code> str | Path None Root directory <code>show_hidden</code> bool False Show hidden files <code>dirs_first</code> bool True Sort directories before files <code>multi_select</code> bool False Allow multiple selection"},{"location":"widgets/#filetree-callbacks","title":"FileTree Callbacks","text":"Method Description <code>on_file_select(callback)</code> Called with Path when file selected <code>on_dir_select(callback)</code> Called with Path when directory selected"},{"location":"widgets/#automatic-file-icons","title":"Automatic File Icons","text":"<p>FileTree automatically assigns icons based on file extension:</p> <ul> <li>Programming: <code>.py</code> \ud83d\udc0d, <code>.js</code> \ud83d\udcdc, <code>.rs</code> \ud83e\udd80, <code>.go</code> \ud83d\udc39</li> <li>Documents: <code>.md</code> \ud83d\udcdd, <code>.pdf</code> \ud83d\udcd5, <code>.txt</code> \ud83d\udcc4</li> <li>Images: <code>.png</code> \ud83d\uddbc\ufe0f, <code>.jpg</code> \ud83d\uddbc\ufe0f, <code>.svg</code> \ud83d\uddbc\ufe0f</li> <li>Config: <code>.json</code> \ud83d\udccb, <code>.yaml</code> \ud83d\udccb, <code>.env</code> \ud83d\udd10</li> <li>Special files: <code>Dockerfile</code> \ud83d\udc33, <code>README</code> \ud83d\udcd6, <code>LICENSE</code> \u2696\ufe0f</li> </ul>"},{"location":"widgets/#modal","title":"Modal","text":"<p>Modal dialog overlay for focused interactions.</p> <pre><code>from castella import Modal, ModalState, Column, Button, Text\n\n# Create modal state\nmodal_state = ModalState()\n\n# Create modal with content\nmodal = Modal(\n    content=Column(\n        Text(\"Modal Title\", font_size=18),\n        Text(\"This is the modal content.\"),\n        Button(\"Close\").on_click(lambda _: modal_state.close()),\n    ),\n    state=modal_state,\n    title=\"My Modal\",\n)\n\n# Include modal in your view (uses z-index for overlay)\ndef view(self):\n    return Box(\n        main_content.z_index(1),\n        modal,  # Rendered on top when open\n    )\n\n# Open/close programmatically\nmodal_state.open()\nmodal_state.close()\n</code></pre>"},{"location":"widgets/#parameters_4","title":"Parameters","text":"Parameter Type Default Description <code>content</code> Widget required Modal content widget <code>state</code> ModalState required Modal state (open/close) <code>title</code> str None Optional title bar <code>width</code> int 400 Modal width <code>height</code> int 300 Modal height <code>close_on_backdrop_click</code> bool True Close when clicking backdrop <code>show_close_button</code> bool True Show X button in title bar"},{"location":"widgets/#modalstate-methods","title":"ModalState Methods","text":"Method Description <code>open()</code> Open the modal <code>close()</code> Close the modal <code>is_open</code> Property: current state"},{"location":"widgets/#datetimeinput","title":"DateTimeInput","text":"<p>Date and/or time picker widget with visual calendar grid and dropdown time selection.</p>"},{"location":"widgets/#features_2","title":"Features","text":"<ul> <li>Visual calendar grid for date selection (7x6 grid)</li> <li>Month/year quick navigation with picker views</li> <li>Time picker with hour/minute dropdowns</li> <li>\"Today\" and preset time buttons</li> <li>Locale support (English, Japanese)</li> <li>Min/max date constraints</li> </ul> <pre><code>from castella import DateTimeInput, DateTimeInputState\n\n# Date only with calendar picker\nstate = DateTimeInputState(\n    value=\"2024-12-25\",\n    enable_date=True,\n    enable_time=False\n)\ndate_input = DateTimeInput(state=state, label=\"Birthday\")\n\n# Date and time\nstate = DateTimeInputState(\n    value=\"2024-12-25T14:30:00\",\n    enable_date=True,\n    enable_time=True\n)\ndatetime_input = DateTimeInput(state=state, label=\"Appointment\")\n\n# Time only\nstate = DateTimeInputState(\n    value=\"14:30:00\",\n    enable_date=False,\n    enable_time=True\n)\ntime_input = DateTimeInput(state=state, label=\"Start Time\")\n\n# With constraints and locale\nfrom datetime import date\nfrom castella.calendar.locale import JA\n\ndate_input = DateTimeInput(\n    state=state,\n    label=\"\u4e88\u7d04\u65e5\",\n    min_date=date.today(),\n    max_date=date(2025, 12, 31),\n    first_day_of_week=0,  # 0=Sunday, 1=Monday (default)\n    locale=JA,  # Japanese locale\n)\n</code></pre>"},{"location":"widgets/#datetimeinputstate-methods","title":"DateTimeInputState Methods","text":"Method Description <code>set(value)</code> Set the value (ISO format string) <code>to_iso()</code> Get value as ISO format string <code>to_display_string()</code> Get human-readable string <code>open_picker()</code> Open the picker popup <code>close_picker()</code> Close the picker popup"},{"location":"widgets/#parameters_5","title":"Parameters","text":"Parameter Type Default Description <code>state</code> DateTimeInputState None State object <code>label</code> str None Field label <code>value</code> str None Initial value (ISO format) <code>enable_date</code> bool True Show date picker <code>enable_time</code> bool False Show time picker <code>min_date</code> date None Minimum selectable date <code>max_date</code> date None Maximum selectable date <code>first_day_of_week</code> int 1 0=Sunday, 1=Monday <code>locale</code> CalendarLocale EN Locale for labels"},{"location":"widgets/#locale-support","title":"Locale Support","text":"<pre><code>from castella.calendar.locale import EN, JA, CalendarLocale\n\n# Use built-in locales\nDateTimeInput(state, locale=EN)  # English (default)\nDateTimeInput(state, locale=JA)  # Japanese\n\n# Create custom locale\ncustom = CalendarLocale(\n    weekday_names=[\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\n    month_names=[\"Jan\", \"Feb\", \"Mar\", ...],\n    today_button=\"Today\",\n    done_button=\"Done\",\n    now_button=\"Now\",\n    time_label=\"Time:\",\n    placeholder=\"Select date\",\n)\n</code></pre>"},{"location":"widgets/#image","title":"Image","text":"<p>Display images from files.</p> <pre><code>from castella import Image\n\nImage(\"path/to/image.png\")\n</code></pre>"},{"location":"widgets/#netimage","title":"NetImage","text":"<p>Display images from URLs with caching and fit mode support.</p> <pre><code>from castella import NetImage, ImageFit\n\n# Basic usage\nimg = NetImage(\"https://example.com/image.png\")\n\n# Disable cache\nimg = NetImage(\"https://example.com/image.png\", use_cache=False)\n\n# With ImageFit modes (aspect ratio preservation)\nimg = NetImage(\"https://example.com/image.png\", fit=ImageFit.CONTAIN)  # Fit within bounds\nimg = NetImage(\"https://example.com/image.png\", fit=ImageFit.COVER)    # Cover bounds (may crop)\nimg = NetImage(\"https://example.com/image.png\", fit=ImageFit.FILL)     # Stretch to fill (default)\n\n# Chain with fit() method\nimg = NetImage(url).fit(ImageFit.CONTAIN)\n\n# With reactive URL\nfrom castella import State\nurl = State(\"https://example.com/image.png\")\nimg = NetImage(url)\n</code></pre>"},{"location":"widgets/#imagefit-modes","title":"ImageFit Modes","text":"Mode Description <code>FILL</code> Stretch to fill bounds (may distort aspect ratio) - default <code>CONTAIN</code> Scale to fit within bounds, maintaining aspect ratio (letterbox) <code>COVER</code> Scale to cover bounds, maintaining aspect ratio (may crop)"},{"location":"widgets/#parameters_6","title":"Parameters","text":"Parameter Type Default Description <code>url</code> str or State[str] required Image URL <code>use_cache</code> bool True Cache downloaded images <code>fit</code> ImageFit FILL How image fits within bounds <p>Uses CONTENT size policy by default (sizes to image dimensions).</p>"},{"location":"widgets/#asyncnetimage","title":"AsyncNetImage","text":"<p>Asynchronously load and display images from URLs. Unlike NetImage, this widget renders immediately and updates when the image loads.</p> <pre><code>from castella import AsyncNetImage\n\n# Must specify dimensions (CONTENT size policy not supported)\nimg = (\n    AsyncNetImage(\"https://example.com/image.png\")\n    .fixed_size(200, 150)\n)\n\n# With reactive URL\nfrom castella import State\nurl = State(\"https://example.com/image.png\")\nimg = AsyncNetImage(url).fixed_size(200, 150)\n</code></pre> <p>Size Policy Restriction</p> <p>AsyncNetImage does not support <code>SizePolicy.CONTENT</code>. You must use <code>fixed_size()</code>, <code>fixed_width()</code>, or <code>fixed_height()</code> to set dimensions.</p>"},{"location":"widgets/#spacer","title":"Spacer","text":"<p>Flexible space widget for layouts.</p> <pre><code>Column(\n    Text(\"Top\"),\n    Spacer(),      # Takes remaining space\n    Text(\"Bottom\"),\n)\n</code></pre>"},{"location":"widgets/#datatable","title":"DataTable","text":"<p>High-performance data table with sorting, filtering, row selection, and column resize.</p> <pre><code>from castella import (\n    DataTable, DataTableState, ColumnConfig,\n    SortDirection, SelectionMode,\n)\n\n# Create table state with column configs\nstate = DataTableState(\n    columns=[\n        ColumnConfig(name=\"Name\", width=150, sortable=True),\n        ColumnConfig(name=\"Age\", width=80, sortable=True),\n        ColumnConfig(name=\"City\", width=120, sortable=True),\n    ],\n    rows=[\n        [\"Alice\", 30, \"Tokyo\"],\n        [\"Bob\", 25, \"Osaka\"],\n        [\"Charlie\", 35, \"Kyoto\"],\n    ],\n    selection_mode=SelectionMode.MULTI,  # NONE, SINGLE, or MULTI\n)\n\n# Create table with event handlers\ntable = (\n    DataTable(state)\n    .on_sort(lambda ev: print(f\"Sorted column {ev.column}\"))\n    .on_selection_change(lambda ev: print(f\"Selected: {ev.selected_rows}\"))\n    .on_cell_click(lambda ev: print(f\"Clicked: {ev.value}\"))\n)\n</code></pre>"},{"location":"widgets/#from-pydantic-models","title":"From Pydantic Models","text":"<p><code>from_pydantic()</code> automatically extracts metadata from Pydantic fields:</p> <ul> <li><code>Field.title</code> \u2192 Column header name</li> <li><code>Field.description</code> \u2192 Column tooltip (shown on header hover)</li> <li><code>Field.annotation</code> \u2192 Column width inference by type</li> </ul> <pre><code>from pydantic import BaseModel, Field\n\nclass Person(BaseModel):\n    name: str = Field(title=\"Name\", description=\"Full name\")\n    age: int = Field(title=\"Age\", description=\"Age in years\")\n    city: str = Field(title=\"City\", description=\"City of residence\")\n\npeople = [\n    Person(name=\"Alice\", age=30, city=\"Tokyo\"),\n    Person(name=\"Bob\", age=25, city=\"Osaka\"),\n]\n\nstate = DataTableState.from_pydantic(people)\ntable = DataTable(state)\n# Columns: Name (150px), Age (80px), City (150px)\n# Hover headers to see tooltips from Field.description\n</code></pre> <p>Type-based width inference:</p> Type Width <code>int</code> 80px <code>float</code> 100px <code>str</code> 150px <code>bool</code> 60px <code>date</code>/<code>datetime</code> 120px"},{"location":"widgets/#style-customization","title":"Style Customization","text":"<p>Customize table colors with fluent API:</p> <pre><code>DataTable(state)\n    .header_bg_color(\"#3d5a80\")      # Header background\n    .header_text_color(\"#ffffff\")    # Header text\n    .alt_row_bg_color(\"#293241\")     # Alternating row background\n    .hover_bg_color(\"#415a77\")       # Hover row background\n    .selected_bg_color(\"#ee6c4d\")    # Selected row background\n    .grid_color(\"#4a5568\")           # Grid line color\n</code></pre>"},{"location":"widgets/#features_3","title":"Features","text":"<ul> <li>Sorting: Click column headers to sort (ASC \u2192 DESC \u2192 NONE)</li> <li>Filtering: Global and per-column text filtering</li> <li>Selection: Single or multi-row selection with Shift/Ctrl</li> <li>Column Resize: Drag column borders to resize</li> <li>Virtual Scrolling: Efficient handling of 1000+ rows</li> <li>Keyboard Navigation: Arrow keys, Enter, Home/End, PageUp/PageDown</li> </ul>"},{"location":"widgets/#datatablestate-methods","title":"DataTableState Methods","text":"Method Description <code>from_pydantic(models)</code> Create from Pydantic model list <code>set_rows(rows)</code> Replace all rows <code>set_filter(text)</code> Set global filter <code>set_column_filter(col, text)</code> Set per-column filter <code>clear_filters()</code> Clear all filters <code>set_sort(column, direction)</code> Set sort column and direction <code>clear_selection()</code> Clear row selection"},{"location":"widgets/#events","title":"Events","text":"Event Description <code>on_sort(callback)</code> Called when sort changes <code>on_selection_change(callback)</code> Called when selection changes <code>on_cell_click(callback)</code> Called when a cell is clicked <code>on_filter_change(callback)</code> Called when filter changes"},{"location":"widgets/#legacy-tablemodel-backward-compatible","title":"Legacy TableModel (Backward Compatible)","text":"<p>The legacy <code>TableModel</code> API is still supported:</p> <pre><code>from castella import DataTable, TableModel\n\nmodel = TableModel.from_pydantic_model(people)\ntable = DataTable(model)  # Automatically converted to DataTableState\n</code></pre>"},{"location":"widgets/#additional-widgets","title":"Additional Widgets","text":"<p>For more widgets and examples, see:</p> <ul> <li>Charts - BarChart, LineChart, PieChart</li> <li>Examples directory</li> </ul>"},{"location":"widgets/#available-widgets","title":"Available Widgets","text":"Widget Description <code>Text</code> Single-line text display <code>MultilineText</code> Multi-line text with wrapping <code>SimpleText</code> Lightweight text widget <code>Button</code> Clickable button <code>Input</code> Text input field <code>MultilineInput</code> Multi-line text editor <code>Markdown</code> Rich markdown rendering <code>Switch</code> Toggle switch <code>CheckBox</code> Checkbox <code>RadioButtons</code> Radio button group <code>Slider</code> Range input slider <code>Tabs</code> Tabbed navigation <code>Tree</code> Hierarchical tree view <code>FileTree</code> File system browser <code>Modal</code> Modal dialog overlay <code>DateTimeInput</code> Date/time picker <code>Image</code> Image display <code>NetImage</code> Image from URL <code>AsyncNetImage</code> Async image loading <code>NumpyImage</code> Image from numpy array <code>DataTable</code> Tabular data display <code>Column</code> Vertical layout <code>Row</code> Horizontal layout <code>Box</code> Stacking layout <code>Spacer</code> Flexible space"},{"location":"z-index/","title":"Z-Index and Widget Layering","text":""},{"location":"z-index/#overview","title":"Overview","text":"<p>Z-index controls the stacking order of widgets when they overlap. Higher z-index values appear visually \"on top\" of lower ones and receive user input (mouse events, clicks) before widgets with lower z-index values.</p> <p>This feature enables common UI patterns like:</p> <ul> <li>Modal dialogs</li> <li>Popup menus and tooltips</li> <li>Floating windows</li> <li>Overlay panels</li> </ul>"},{"location":"z-index/#the-z_index-method","title":"The z_index() Method","text":"<p>Every widget has a <code>z_index</code> property (default: 1). Use the <code>.z_index(n)</code> method to set it:</p> <pre><code>widget = Column(...).z_index(10)\n</code></pre> <p>Requirements:</p> <ul> <li>Values must be positive integers (&gt;= 1)</li> <li>Passing a value less than 1 raises a <code>ValueError</code></li> </ul> <p>The method returns <code>self</code>, allowing fluent method chaining:</p> <pre><code>dialog = Column(\n    Text(\"Title\"),\n    content,\n).fixed_size(300, 200).z_index(10)\n</code></pre>"},{"location":"z-index/#how-z-index-works","title":"How Z-Index Works","text":""},{"location":"z-index/#rendering-order","title":"Rendering Order","text":"<p>Widgets are rendered in ascending z-index order (lower values first):</p> <ol> <li>z-index 1 widgets are rendered first (at the back)</li> <li>z-index 10 widgets are rendered on top of z-index 1 widgets</li> <li>Higher z-index widgets appear visually in front</li> </ol>"},{"location":"z-index/#event-handling-order","title":"Event Handling Order","text":"<p>Events are dispatched in descending z-index order (higher values first):</p> <ol> <li>z-index 10 widgets receive click events first</li> <li>If not handled, z-index 1 widgets receive the event</li> <li>This ensures higher z-index widgets can block clicks to lower ones</li> </ol>"},{"location":"z-index/#using-box-for-overlapping-widgets","title":"Using Box for Overlapping Widgets","text":"<p>The <code>Box</code> container is designed for stacking widgets at the same position. When combined with z-index, it enables layered UIs:</p> <pre><code>from castella import Box, Column\n\nmain_content = Column(...).z_index(1)\nmodal_dialog = Column(...).z_index(10)\n\n# Both widgets overlap - modal appears on top\nreturn Box(main_content, modal_dialog)\n</code></pre>"},{"location":"z-index/#modal-dialog-pattern","title":"Modal Dialog Pattern","text":"<p>A common pattern for modal dialogs:</p> <pre><code>from castella import (\n    App, Box, Button, Column, Component,\n    MultilineText, Row, Spacer, State, Text, Kind\n)\nfrom castella.frame import Frame\n\n\nclass ModalDemo(Component):\n    def __init__(self):\n        super().__init__()\n        self._show_modal = State(False)\n        self.model(self._show_modal)\n\n    def view(self):\n        # Main content with low z-index\n        main_content = Column(\n            Text(\"Main Content\", font_size=24),\n            Spacer(),\n            Row(\n                Spacer(),\n                Button(\"Open Modal\").on_click(\n                    lambda _: self._show_modal.set(True)\n                ),\n                Spacer(),\n            ).fixed_height(50),\n            Spacer(),\n        ).z_index(1)\n\n        if self._show_modal():\n            # Modal with high z-index\n            modal = Column(\n                MultilineText(\n                    \"Modal Dialog\\n\\nThis appears on top!\",\n                    font_size=16,\n                    kind=Kind.WARNING,\n                ),\n                Spacer(),\n                Button(\"Close\").on_click(\n                    lambda _: self._show_modal.set(False)\n                ),\n            ).fixed_size(300, 200).z_index(10)\n\n            return Box(main_content, modal)\n\n        return main_content\n\n\nApp(\n    Frame(\"Modal Demo\", width=600, height=400),\n    ModalDemo(),\n).run()\n</code></pre>"},{"location":"z-index/#stacked-windows-example","title":"Stacked Windows Example","text":"<p>For multiple overlapping widgets with dynamic stacking order:</p> <pre><code>from castella import (\n    App, Box, Button, Column, Component,\n    MultilineText, Row, Spacer, State, Text, Kind\n)\nfrom castella.frame import Frame\n\n\nclass StackedDialogs(Component):\n    def __init__(self):\n        super().__init__()\n        # Track order: [back, ..., front]\n        self._order = State([1, 2, 3])\n        self.model(self._order)\n\n    def _bring_to_front(self, dialog_num):\n        order = list(self._order())\n        order.remove(dialog_num)\n        order.append(dialog_num)\n        self._order.set(order)\n\n    def view(self):\n        order = self._order()\n        # Calculate z-index from position in order\n        z1 = order.index(1) + 1\n        z2 = order.index(2) + 1\n        z3 = order.index(3) + 1\n\n        dialog1 = Column(\n            Text(f\"Dialog 1 (z: {z1})\"),\n            Button(\"Bring to Front\").on_click(\n                lambda _: self._bring_to_front(1)\n            ),\n        ).fixed_size(200, 150).z_index(z1)\n\n        dialog2 = Column(\n            Text(f\"Dialog 2 (z: {z2})\"),\n            Button(\"Bring to Front\").on_click(\n                lambda _: self._bring_to_front(2)\n            ),\n        ).fixed_size(180, 130).z_index(z2)\n\n        dialog3 = Column(\n            Text(f\"Dialog 3 (z: {z3})\"),\n            Button(\"Bring to Front\").on_click(\n                lambda _: self._bring_to_front(3)\n            ),\n        ).fixed_size(160, 110).z_index(z3)\n\n        return Box(dialog1, dialog2, dialog3)\n\n\nApp(\n    Frame(\"Stacked Dialogs\", width=400, height=300),\n    StackedDialogs(),\n).run()\n</code></pre>"},{"location":"z-index/#best-practices","title":"Best Practices","text":"<ol> <li>Use consistent z-index values: Keep a simple layering system</li> <li><code>1</code> for normal content</li> <li><code>10</code> for modals and popups</li> <li> <p><code>100</code> for critical overlays (rare)</p> </li> <li> <p>Always use Box for overlapping widgets: Box properly handles z-index stacking and ensures correct redraw behavior</p> </li> <li> <p>Keep z-index values simple: Avoid complex z-index hierarchies. Most apps only need 2-3 layers.</p> </li> <li> <p>Consider event blocking: Higher z-index widgets will intercept clicks. Ensure your modal/popup can be dismissed.</p> </li> </ol>"}]}